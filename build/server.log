--- Début du log : 1746135133 ---
[2025-05-01 23:32:13][DEBUG] TransactionQueue créée.
[2025-05-01 23:32:13][INFO] Main_Serv INFO : Démarrage du programme serveur.
[2025-05-01 23:32:13][ERROR] Main_Serv ERROR : Nombre d'arguments incorrect. Attendu 7, reçu 0.
[2025-05-01 23:32:13][DEBUG] Destructeur TransactionQueue appelé. Arrêt du thread de traitement...
[2025-05-01 23:32:13][WARNING] TransactionQueue::stop Thread de traitement déjà arrêté ou non démarré.
[2025-05-01 23:32:13][DEBUG] Destructeur TransactionQueue terminé.
--- Fin du log : 1746135133 ---
--- Début du log : 1746135346 ---
[2025-05-01 23:35:46][DEBUG] TransactionQueue créée.
[2025-05-01 23:35:46][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-01 23:35:46][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: cert.pem, Key: key.pem, Users: users.txt, Counter: counter.txt, History: history.txt, Wallets Dir: wallets/
[2025-05-01 23:35:46][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-01 23:35:46][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-01 23:35:46][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-01 23:35:46][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-01 23:35:46][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-01 23:35:46][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-01 23:35:46][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-01 23:35:46][ERROR] Server::InitServerCTX ERROR : Échec chargement certificat serveur : cert.pem
[2025-05-01 23:35:46][ERROR] Server::StartServer ERROR : Échec de l'initialisation du contexte SSL serveur. Arrêt.
[2025-05-01 23:35:46][INFO] Main_Serv INFO : Programme serveur terminé normalement.
[2025-05-01 23:35:46][DEBUG] Main_Serv DEBUG : Nettoyage global OpenSSL...
[2025-05-01 23:35:46][DEBUG] Main_Serv DEBUG : Nettoyage global OpenSSL terminé.
[2025-05-01 23:35:46][INFO] Server::~Server INFO : Destructeur appelé. Début de l'arrêt propre...
[2025-05-01 23:35:46][INFO] Server::StopServer INFO : Arrêt ordonné du serveur demandé...
[2025-05-01 23:35:46][DEBUG] Server::StopServer DEBUG : acceptingConnections flag positionné à false.
[2025-05-01 23:35:46][DEBUG] Server::StopServer DEBUG : Socket d'écoute déjà fermé (-1).
[2025-05-01 23:35:46][WARNING] Server::StopServer WARNING : Thread d'acceptation non joignable lors de l'arrêt.
[2025-05-01 23:35:46][DEBUG] Server::StopServer DEBUG : Copie de 0 sessions actives pour arrêt.
[2025-05-01 23:35:46][INFO] Server::StopServer INFO : Signal d'arrêt envoyé à 0 sessions clientes actives. Attente de leur fin...
[2025-05-01 23:35:46][DEBUG] Server::StopServer DEBUG : Appel stop() terminé pour toutes les sessions copiées.
[2025-05-01 23:35:46][INFO] Server::SaveUsersInternal INFO : Sauvegarde de 0 utilisateurs dans users.txt
[2025-05-01 23:35:46][INFO] Server::StopServer INFO : Liste des utilisateurs sauvegardée.
[2025-05-01 23:35:46][INFO] Transaction::saveCounter Compteur sauvegardé: 0 vers counter.txt
[2025-05-01 23:35:46][INFO] Server::StopServer INFO : Compteur de transactions sauvegardé.
[2025-05-01 23:35:46][INFO] Global Demande d'arrêt du thread de génération de prix.
[2025-05-01 23:35:46][WARNING] Global Thread de génération de prix non joignable ou déjà terminé lors de la demande d'arrêt.
[2025-05-01 23:35:46][INFO] Server::StopServer INFO : Thread de génération des prix arrêté.
[2025-05-01 23:35:46][WARNING] TransactionQueue::stop Thread de traitement déjà arrêté ou non démarré.
[2025-05-01 23:35:46][INFO] Server::StopServer INFO : Thread de traitement de la TransactionQueue arrêté.
[2025-05-01 23:35:46][INFO] Server::StopServer INFO : Arrêt ordonné du serveur terminé.
[2025-05-01 23:35:46][INFO] Server::~Server INFO : Destructeur terminé.
[2025-05-01 23:35:46][DEBUG] Destructeur TransactionQueue appelé. Arrêt du thread de traitement...
[2025-05-01 23:35:46][WARNING] TransactionQueue::stop Thread de traitement déjà arrêté ou non démarré.
[2025-05-01 23:35:46][DEBUG] Destructeur TransactionQueue terminé.
--- Fin du log : 1746135346 ---
--- Début du log : 1746136193 ---
[2025-05-01 23:49:53][DEBUG] TransactionQueue créée.
[2025-05-01 23:49:53][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-01 23:49:53][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../cert.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: wallets/
[2025-05-01 23:49:53][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-01 23:49:53][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-01 23:49:53][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-01 23:49:53][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-01 23:49:53][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-01 23:49:53][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-01 23:49:53][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-01 23:49:53][ERROR] Server::InitServerCTX ERROR : Échec chargement certificat serveur : ../cert.crt
[2025-05-01 23:49:53][ERROR] Server::StartServer ERROR : Échec de l'initialisation du contexte SSL serveur. Arrêt.
[2025-05-01 23:49:53][INFO] Main_Serv INFO : Programme serveur terminé normalement.
[2025-05-01 23:49:53][DEBUG] Main_Serv DEBUG : Nettoyage global OpenSSL...
[2025-05-01 23:49:53][DEBUG] Main_Serv DEBUG : Nettoyage global OpenSSL terminé.
[2025-05-01 23:49:53][INFO] Server::~Server INFO : Destructeur appelé. Début de l'arrêt propre...
[2025-05-01 23:49:53][INFO] Server::StopServer INFO : Arrêt ordonné du serveur demandé...
[2025-05-01 23:49:53][DEBUG] Server::StopServer DEBUG : acceptingConnections flag positionné à false.
[2025-05-01 23:49:53][DEBUG] Server::StopServer DEBUG : Socket d'écoute déjà fermé (-1).
[2025-05-01 23:49:53][WARNING] Server::StopServer WARNING : Thread d'acceptation non joignable lors de l'arrêt.
[2025-05-01 23:49:53][DEBUG] Server::StopServer DEBUG : Copie de 0 sessions actives pour arrêt.
[2025-05-01 23:49:53][INFO] Server::StopServer INFO : Signal d'arrêt envoyé à 0 sessions clientes actives. Attente de leur fin...
[2025-05-01 23:49:53][DEBUG] Server::StopServer DEBUG : Appel stop() terminé pour toutes les sessions copiées.
[2025-05-01 23:49:53][INFO] Server::SaveUsersInternal INFO : Sauvegarde de 0 utilisateurs dans users.txt
[2025-05-01 23:49:53][INFO] Server::StopServer INFO : Liste des utilisateurs sauvegardée.
[2025-05-01 23:49:53][INFO] Transaction::saveCounter Compteur sauvegardé: 0 vers counter.txt
[2025-05-01 23:49:53][INFO] Server::StopServer INFO : Compteur de transactions sauvegardé.
[2025-05-01 23:49:53][INFO] Global Demande d'arrêt du thread de génération de prix.
[2025-05-01 23:49:53][WARNING] Global Thread de génération de prix non joignable ou déjà terminé lors de la demande d'arrêt.
[2025-05-01 23:49:53][INFO] Server::StopServer INFO : Thread de génération des prix arrêté.
[2025-05-01 23:49:53][WARNING] TransactionQueue::stop Thread de traitement déjà arrêté ou non démarré.
[2025-05-01 23:49:53][INFO] Server::StopServer INFO : Thread de traitement de la TransactionQueue arrêté.
[2025-05-01 23:49:53][INFO] Server::StopServer INFO : Arrêt ordonné du serveur terminé.
[2025-05-01 23:49:53][INFO] Server::~Server INFO : Destructeur terminé.
[2025-05-01 23:49:53][DEBUG] Destructeur TransactionQueue appelé. Arrêt du thread de traitement...
[2025-05-01 23:49:53][WARNING] TransactionQueue::stop Thread de traitement déjà arrêté ou non démarré.
[2025-05-01 23:49:53][DEBUG] Destructeur TransactionQueue terminé.
--- Fin du log : 1746136193 ---
--- Début du log : 1746136262 ---
[2025-05-01 23:51:02][DEBUG] TransactionQueue créée.
[2025-05-01 23:51:02][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-01 23:51:02][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: wallets/
[2025-05-01 23:51:02][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-01 23:51:02][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-01 23:51:02][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-01 23:51:02][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-01 23:51:02][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-01 23:51:02][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-01 23:51:02][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-01 23:51:02][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-01 23:51:02][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-01 23:51:02][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-01 23:51:02][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-01 23:51:02][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 0 entrées chargées depuis users.txt
[2025-05-01 23:51:02][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-01 23:51:02][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-01 23:51:02][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-01 23:51:02][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-01 23:51:02][INFO] Global Thread de génération de prix initié.
[2025-05-01 23:51:02][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-01 23:51:02][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-01 23:51:02][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-01 23:51:02][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-01 23:51:02][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-01 23:51:02][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-01 23:51:02][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-01 23:51:02][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-01 23:51:02][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-01 23:51:02][INFO] Global Thread de génération de prix démarré.
[2025-05-01 23:51:02][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-01 23:51:02][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-01 23:51:02][INFO] Global Nouveau prix SRD-BTC simulé : 96648.4164046483
[2025-05-01 23:51:18][INFO] Global Nouveau prix SRD-BTC simulé : 96161.5515805778
[2025-05-01 23:51:33][INFO] Global Nouveau prix SRD-BTC simulé : 98017.5407404625
[2025-05-01 23:51:48][INFO] Global Nouveau prix SRD-BTC simulé : 98300.5953645451
[2025-05-01 23:51:54][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 6, IP: 10.188.240.101
[2025-05-01 23:51:54][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 6
[2025-05-01 23:51:54][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 6
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-01 23:51:54][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-01 23:51:54][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-01 23:51:54][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-01 23:51:54][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 6
[2025-05-01 23:51:54][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 6
[2025-05-01 23:51:54][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (6) et SSL existants.
[2025-05-01 23:51:54][DEBUG] Server::HandleClient DEBUG : Objet ServerConnection créé et connecté pour socket FD: 6
[2025-05-01 23:51:54][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-01 23:51:54][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 6
[2025-05-01 23:51:54][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 6 : 'ID:mon_client_id_depuis_script,TOKEN:mon_token_depuis_script
'
[2025-05-01 23:51:54][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'mon_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 6
[2025-05-01 23:51:54][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'mon_client_id_depuis_script'...
[2025-05-01 23:51:54][DEBUG] Server::processAuthRequest DEBUG : ID non trouvé : 'mon_client_id_depuis_script'. Tentative d'enregistrement...
[2025-05-01 23:51:54][WARNING] SecurityUtils WARNING : HashPasswordSecure est un placeholder. REMPLACER PAR UN VRAI HACHAGE SECURISÉ (bcrypt, Argon2) !
[2025-05-01 23:51:54][DEBUG] Server::processAuthRequest DEBUG : Nouvel utilisateur 'mon_client_id_depuis_script' ajouté à map en mémoire.
[2025-05-01 23:51:54][INFO] Server::SaveUsersInternal INFO : Sauvegarde de 1 utilisateurs dans users.txt
[2025-05-01 23:51:54][INFO] Server::processAuthRequest INFO : Liste utilisateurs sauvegardée sur disque après ajout ID: 'mon_client_id_depuis_script'.
[2025-05-01 23:51:54][DEBUG] Server::CreateWalletFile DEBUG : Tentative création fichier portefeuille: wallets//mon_client_id_depuis_script.wallet
[2025-05-01 23:51:54][DEBUG] Server::CreateWalletFile DEBUG : Répertoire portefeuilles vérifié/créé : wallets/
[2025-05-01 23:51:54][DEBUG] Server::CreateWalletFile DEBUG : Fichier portefeuille ouvert/créé : wallets//mon_client_id_depuis_script.wallet
[2025-05-01 23:51:54][INFO] Server::CreateWalletFile INFO : Fichier portefeuille vierge créé et initialisé : wallets//mon_client_id_depuis_script.wallet
[2025-05-01 23:51:54][INFO] Server::processAuthRequest INFO : Fichier portefeuille créé avec succès pour ID: 'mon_client_id_depuis_script'.
[2025-05-01 23:51:54][INFO] Server::processAuthRequest INFO : Enregistrement nouvel utilisateur 'mon_client_id_depuis_script' réussi.
[2025-05-01 23:51:54][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification/enregistrement réussi pour ID: 'mon_client_id_depuis_script'. Résultat Server: NEW. Token de session généré. Socket FD: 6
[2025-05-01 23:51:54][DEBUG] Server::HandleClient DEBUG : Client ID authentifié: 'mon_client_id_depuis_script' (NEW). Socket FD: 6
[2025-05-01 23:51:54][INFO] ClientSession
[2025-05-01 23:51:54][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire : wallets
[2025-05-01 23:51:54][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 2, strerror(errno) : 'No such file or directory'
[2025-05-01 23:51:54][WARNING] Wallet Avertissement: create_directories retour false pour wallets mais ec vide. Comportement inhabituel, traité comme succès pour l'existence.
[2025-05-01 23:51:54][DEBUG] Wallet Lecture du fichier portefeuille : wallets/mon_client_id_depuis_script.wallet
[2025-05-01 23:51:54][INFO] Wallet Portefeuille (mon_client_id_depuis_script) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-01 23:51:54][INFO] Wallet Portefeuille chargé avec succès pour client ID: mon_client_id_depuis_script depuis wallets/mon_client_id_depuis_script.wallet
[2025-05-01 23:51:54][DEBUG] Wallet Objet Wallet créé pour client ID: mon_client_id_depuis_script. Chemin du fichier: wallets/mon_client_id_depuis_script.wallet
[2025-05-01 23:51:54][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire : wallets
[2025-05-01 23:51:54][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 2, strerror(errno) : 'No such file or directory'
[2025-05-01 23:51:54][WARNING] Wallet Avertissement: create_directories retour false pour wallets mais ec vide. Comportement inhabituel, traité comme succès pour l'existence.
[2025-05-01 23:51:54][DEBUG] Wallet Lecture du fichier portefeuille : wallets/mon_client_id_depuis_script.wallet
[2025-05-01 23:51:54][INFO] Wallet Portefeuille (mon_client_id_depuis_script) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-01 23:51:54][INFO] ClientSession
[2025-05-01 23:51:54][ERROR] Server::HandleClient ERROR : Impossible créer/initialiser ClientSession ou Wallet pour client ID: mon_client_id_depuis_script. Socket FD: 6. Arrêt du thread.
[2025-05-01 23:51:54][INFO] ServerConnection::closeConnection INFO : Fermeture de la connexion pour socket FD: 6
[2025-05-01 23:51:54][DEBUG] OpenSSL Callback: SSL3 alert write:warning:close notify
[2025-05-01 23:51:54][DEBUG] ServerConnection::closeConnection DEBUG : SSL_shutdown étape 1/2 terminée. Tentative étape 2 (peut bloquer).
[2025-05-01 23:51:54][DEBUG] ServerConnection::closeConnection DEBUG : Objet SSL libéré.
[2025-05-01 23:51:54][DEBUG] ServerConnection::closeConnection DEBUG : Fermeture du socket FD: 6
[2025-05-01 23:51:54][INFO] ServerConnection::closeConnection INFO : Socket FD: 6 fermé.
[2025-05-01 23:51:54][DEBUG] ServerConnection::closeConnection DEBUG : Nettoyage de connexion terminé.
[2025-05-01 23:51:54][INFO] ClientSession
[2025-05-01 23:51:54][INFO] ClientSession
[2025-05-01 23:51:54][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire : wallets
[2025-05-01 23:51:54][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-01 23:51:54][WARNING] Wallet Avertissement: create_directories retour false pour wallets mais ec vide. Comportement inhabituel, traité comme succès pour l'existence.
[2025-05-01 23:51:54][DEBUG] Wallet Sauvegarde du portefeuille : wallets/mon_client_id_depuis_script.wallet
[2025-05-01 23:51:54][INFO] Wallet Portefeuille (mon_client_id_depuis_script) sauvegardé : USD=10000.0000000000, SRD-BTC=0.0000000000.
[2025-05-01 23:51:54][INFO] ClientSession
[2025-05-01 23:51:54][DEBUG] Wallet Objet Wallet détruit pour client ID: mon_client_id_depuis_script. Sauvegarde finale en cours...
[2025-05-01 23:51:54][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire : wallets
[2025-05-01 23:51:54][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-01 23:51:54][WARNING] Wallet Avertissement: create_directories retour false pour wallets mais ec vide. Comportement inhabituel, traité comme succès pour l'existence.
[2025-05-01 23:51:54][DEBUG] Wallet Sauvegarde du portefeuille : wallets/mon_client_id_depuis_script.wallet
[2025-05-01 23:51:54][INFO] Wallet Portefeuille (mon_client_id_depuis_script) sauvegardé : USD=10000.0000000000, SRD-BTC=0.0000000000.
[2025-05-01 23:51:54][INFO] Wallet Portefeuille pour client ID: mon_client_id_depuis_script sauvegardé avec succès vers wallets/mon_client_id_depuis_script.wallet avant destruction.
[2025-05-01 23:51:54][DEBUG] Wallet Objet Wallet détruit pour client ID: mon_client_id_depuis_script. Sauvegarde finale terminée.
[2025-05-01 23:51:54][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur appelé. Socket FD final: -1
[2025-05-01 23:51:54][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur terminé.
--- Début du log : 1746136844 ---
[2025-05-02 00:00:44][DEBUG] TransactionQueue créée.
[2025-05-02 00:00:44][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 00:00:44][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: wallets/
[2025-05-02 00:00:44][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 00:00:44][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 00:00:44][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 00:00:44][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 00:00:44][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 00:00:44][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 00:00:44][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 00:00:44][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 00:00:44][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 00:00:44][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 00:00:44][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 00:00:44][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 1 entrées chargées depuis users.txt
[2025-05-02 00:00:44][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 00:00:44][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 00:00:44][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 00:00:44][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 00:00:44][INFO] Global Thread de génération de prix initié.
[2025-05-02 00:00:44][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 00:00:44][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 00:00:44][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 00:00:44][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 00:00:44][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 00:00:44][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 00:00:44][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 00:00:44][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 00:00:44][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 00:00:44][INFO] Global Thread de génération de prix démarré.
[2025-05-02 00:00:44][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 00:00:44][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 00:00:44][INFO] Global Nouveau prix SRD-BTC simulé : 96549.5645330726
[2025-05-02 00:00:51][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 6, IP: 10.188.240.101
[2025-05-02 00:00:51][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 6
[2025-05-02 00:00:51][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 6
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 00:00:51][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 00:00:51][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 00:00:51][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 00:00:51][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 6
[2025-05-02 00:00:51][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 6
[2025-05-02 00:00:51][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (6) et SSL existants.
[2025-05-02 00:00:51][DEBUG] Server::HandleClient DEBUG : Objet ServerConnection créé et connecté pour socket FD: 6
[2025-05-02 00:00:51][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 00:00:51][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 6
[2025-05-02 00:00:51][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 6 : 'ID:mon_client_id_depuis_script,TOKEN:mon_token_depuis_script
'
[2025-05-02 00:00:51][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'mon_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 6
[2025-05-02 00:00:51][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'mon_client_id_depuis_script'...
[2025-05-02 00:00:51][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'mon_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 00:00:51][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 00:00:51][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'mon_client_id_depuis_script'.
[2025-05-02 00:00:51][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification/enregistrement réussi pour ID: 'mon_client_id_depuis_script'. Résultat Server: SUCCESS. Token de session généré. Socket FD: 6
[2025-05-02 00:00:51][DEBUG] Server::HandleClient DEBUG : Client ID authentifié: 'mon_client_id_depuis_script' (SUCCESS). Socket FD: 6
[2025-05-02 00:00:51][INFO] ClientSession
[2025-05-02 00:00:51][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 00:00:51][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 00:00:51][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 00:00:51][WARNING] Wallet Impossible de charger le portefeuille pour client ID: mon_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : wallets/mon_client_id_depuis_script.wallet
[2025-05-02 00:00:51][DEBUG] Wallet Objet Wallet créé pour client ID: mon_client_id_depuis_script. Chemin du fichier: wallets/mon_client_id_depuis_script.wallet
[2025-05-02 00:00:51][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 00:00:51][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 00:00:51][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 00:00:51][INFO] ClientSession
[2025-05-02 00:00:51][ERROR] Server::HandleClient ERROR : Impossible créer/initialiser ClientSession ou Wallet pour client ID: mon_client_id_depuis_script. Socket FD: 6. Arrêt du thread.
[2025-05-02 00:00:51][INFO] ServerConnection::closeConnection INFO : Fermeture de la connexion pour socket FD: 6
[2025-05-02 00:00:51][DEBUG] OpenSSL Callback: SSL3 alert write:warning:close notify
[2025-05-02 00:00:51][DEBUG] ServerConnection::closeConnection DEBUG : SSL_shutdown étape 1/2 terminée. Tentative étape 2 (peut bloquer).
[2025-05-02 00:00:51][DEBUG] ServerConnection::closeConnection DEBUG : Objet SSL libéré.
[2025-05-02 00:00:51][DEBUG] ServerConnection::closeConnection DEBUG : Fermeture du socket FD: 6
[2025-05-02 00:00:51][INFO] ServerConnection::closeConnection INFO : Socket FD: 6 fermé.
[2025-05-02 00:00:51][DEBUG] ServerConnection::closeConnection DEBUG : Nettoyage de connexion terminé.
[2025-05-02 00:00:51][INFO] ClientSession
[2025-05-02 00:00:51][INFO] ClientSession
[2025-05-02 00:00:51][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 00:00:51][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 00:00:51][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 00:00:51][INFO] ClientSession
[2025-05-02 00:00:51][DEBUG] Wallet Objet Wallet détruit pour client ID: mon_client_id_depuis_script. Sauvegarde finale en cours...
[2025-05-02 00:00:51][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 00:00:51][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 00:00:51][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 00:00:51][ERROR] Wallet Échec de la sauvegarde finale du portefeuille pour client ID: mon_client_id_depuis_script vers wallets/mon_client_id_depuis_script.wallet.
[2025-05-02 00:00:51][DEBUG] Wallet Objet Wallet détruit pour client ID: mon_client_id_depuis_script. Sauvegarde finale terminée.
[2025-05-02 00:00:51][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur appelé. Socket FD final: -1
[2025-05-02 00:00:51][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur terminé.
--- Début du log : 1746137806 ---
[2025-05-02 00:16:46][DEBUG] TransactionQueue créée.
[2025-05-02 00:16:46][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 00:16:46][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: wallets/
[2025-05-02 00:16:46][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 00:16:46][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 00:16:46][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 00:16:46][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 00:16:46][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 00:16:46][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 00:16:46][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 00:16:46][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 00:16:46][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 00:16:46][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 00:16:46][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 00:16:46][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 1 entrées chargées depuis users.txt
[2025-05-02 00:16:46][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 00:16:46][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 00:16:46][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 00:16:46][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 00:16:46][INFO] Global Thread de génération de prix initié.
[2025-05-02 00:16:46][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 00:16:46][INFO] Global Thread de génération de prix démarré.
[2025-05-02 00:16:46][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 00:16:46][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 00:16:46][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 00:16:46][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 00:16:46][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 5
[2025-05-02 00:16:46][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 00:16:46][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 00:16:46][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 00:16:46][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 00:16:46][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 00:16:46][INFO] Global Nouveau prix SRD-BTC simulé : 94227.2784703450
[2025-05-02 00:16:51][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 11, IP: 10.188.240.101
[2025-05-02 00:16:51][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 11
[2025-05-02 00:16:51][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 11
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 00:16:51][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 00:16:51][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 00:16:51][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 00:16:51][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 00:16:51][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 11
[2025-05-02 00:16:51][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 11
[2025-05-02 00:16:51][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 11
[2025-05-02 00:16:51][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (11) et SSL existants.
[2025-05-02 00:16:51][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 11
[2025-05-02 00:16:51][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 00:16:51][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 00:16:51][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 11
[2025-05-02 00:16:51][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 11 : 'ID:mon_client_id_depuis_script,TOKEN:mon_token_depuis_script
'
[2025-05-02 00:16:51][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'mon_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 11
[2025-05-02 00:16:51][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'mon_client_id_depuis_script'...
[2025-05-02 00:16:51][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'mon_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 00:16:51][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 00:16:51][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'mon_client_id_depuis_script'.
[2025-05-02 00:16:51][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification/enregistrement réussi pour ID: 'mon_client_id_depuis_script'. Résultat Server: SUCCESS. Token de session généré. Socket FD: 11
[2025-05-02 00:16:51][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'mon_client_id_depuis_script' (SUCCESS). Socket FD: 11
[2025-05-02 00:16:51][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: mon_client_id_depuis_script...
[2025-05-02 00:16:51][INFO] ClientSession INFO : Initialisation pour client mon_client_id_depuis_script
[2025-05-02 00:16:51][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 00:16:51][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 00:16:51][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 00:16:51][WARNING] Wallet Impossible de charger le portefeuille pour client ID: mon_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : wallets/mon_client_id_depuis_script.wallet
[2025-05-02 00:16:51][DEBUG] Wallet Objet Wallet créé pour client ID: mon_client_id_depuis_script. Chemin du fichier: wallets/mon_client_id_depuis_script.wallet
[2025-05-02 00:16:51][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'mon_client_id_depuis_script'. Socket FD: 11
[2025-05-02 00:16:51][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 00:16:51][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: mon_client_id_depuis_script. Total sessions actives: 1.
[2025-05-02 00:16:51][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 00:16:51][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: mon_client_id_depuis_script
[2025-05-02 00:16:51][INFO] Server::HandleClient INFO : ClientSession pour client ID: mon_client_id_depuis_script enregistrée auprès de la TransactionQueue.
[2025-05-02 00:16:51][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 00:16:51][INFO] ClientSession
[2025-05-02 00:16:51][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: mon_client_id_depuis_script
[2025-05-02 00:16:51][INFO] ClientSession
[2025-05-02 00:16:51][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: mon_client_id_depuis_script. Le thread HandleClient va se terminer normalement.
[2025-05-02 00:16:51][INFO] ClientSession
[2025-05-02 00:17:01][INFO] Global Nouveau prix SRD-BTC simulé : 97433.6425022957
--- Début du log : 1746138003 ---
[2025-05-02 00:20:03][DEBUG] TransactionQueue créée.
[2025-05-02 00:20:03][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 00:20:03][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: wallets/
[2025-05-02 00:20:03][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 00:20:03][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 00:20:03][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 00:20:03][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 00:20:03][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 00:20:03][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 00:20:03][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 00:20:03][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 00:20:03][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 00:20:03][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 00:20:03][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 00:20:03][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 1 entrées chargées depuis users.txt
[2025-05-02 00:20:03][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 00:20:03][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 00:20:03][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 00:20:03][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 00:20:03][INFO] Global Thread de génération de prix initié.
[2025-05-02 00:20:03][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 00:20:03][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 00:20:03][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 00:20:03][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 00:20:03][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 00:20:03][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 00:20:03][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 00:20:03][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 00:20:03][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 00:20:03][INFO] Global Thread de génération de prix démarré.
[2025-05-02 00:20:03][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 00:20:03][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 00:20:03][INFO] Global Nouveau prix SRD-BTC simulé : 96088.5156968244
[2025-05-02 00:20:07][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 5, IP: 10.188.240.101
[2025-05-02 00:20:07][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 5
[2025-05-02 00:20:07][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 5
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 00:20:07][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 00:20:07][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 00:20:07][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 00:20:07][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 00:20:07][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 5
[2025-05-02 00:20:07][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 5
[2025-05-02 00:20:07][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 5
[2025-05-02 00:20:07][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (5) et SSL existants.
[2025-05-02 00:20:07][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 5
[2025-05-02 00:20:07][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 00:20:07][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 00:20:07][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 5
[2025-05-02 00:20:07][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 5 : 'ID:mon_client_id_depuis_script,TOKEN:mon_token_depuis_script
'
[2025-05-02 00:20:07][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'mon_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 5
[2025-05-02 00:20:07][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'mon_client_id_depuis_script'...
[2025-05-02 00:20:07][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'mon_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 00:20:07][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 00:20:07][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'mon_client_id_depuis_script'.
[2025-05-02 00:20:07][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification/enregistrement réussi pour ID: 'mon_client_id_depuis_script'. Résultat Server: SUCCESS. Token de session généré. Socket FD: 5
[2025-05-02 00:20:07][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'mon_client_id_depuis_script' (SUCCESS). Socket FD: 5
[2025-05-02 00:20:07][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: mon_client_id_depuis_script...
[2025-05-02 00:20:07][INFO] ClientSession INFO : Initialisation pour client mon_client_id_depuis_script
[2025-05-02 00:20:07][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 00:20:07][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 00:20:07][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 00:20:07][WARNING] Wallet Impossible de charger le portefeuille pour client ID: mon_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : wallets/mon_client_id_depuis_script.wallet
[2025-05-02 00:20:07][DEBUG] Wallet Objet Wallet créé pour client ID: mon_client_id_depuis_script. Chemin du fichier: wallets/mon_client_id_depuis_script.wallet
[2025-05-02 00:20:07][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'mon_client_id_depuis_script'. Socket FD: 5
[2025-05-02 00:20:07][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 00:20:07][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: mon_client_id_depuis_script. Total sessions actives: 1.
[2025-05-02 00:20:07][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 00:20:07][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: mon_client_id_depuis_script
[2025-05-02 00:20:07][INFO] Server::HandleClient INFO : ClientSession pour client ID: mon_client_id_depuis_script enregistrée auprès de la TransactionQueue.
[2025-05-02 00:20:07][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 00:20:07][INFO] ClientSession
[2025-05-02 00:20:07][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: mon_client_id_depuis_script
[2025-05-02 00:20:07][INFO] ClientSession
[2025-05-02 00:20:07][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: mon_client_id_depuis_script. Le thread HandleClient va se terminer normalement.
[2025-05-02 00:20:07][INFO] ClientSession
[2025-05-02 00:20:18][INFO] Global Nouveau prix SRD-BTC simulé : 97759.5517492053
[2025-05-02 00:20:34][INFO] Global Nouveau prix SRD-BTC simulé : 97675.0039995843
[2025-05-02 00:20:49][INFO] Global Nouveau prix SRD-BTC simulé : 98546.3228684424
[2025-05-02 00:21:04][INFO] Global Nouveau prix SRD-BTC simulé : 97735.9989862405
[2025-05-02 00:21:19][INFO] Global Nouveau prix SRD-BTC simulé : 94539.2120377614
[2025-05-02 00:21:34][INFO] Global Nouveau prix SRD-BTC simulé : 95941.6289372133
[2025-05-02 00:21:49][INFO] Global Nouveau prix SRD-BTC simulé : 95455.6742694028
[2025-05-02 00:22:04][INFO] Global Nouveau prix SRD-BTC simulé : 99167.8742797292
--- Début du log : 1746138222 ---
[2025-05-02 00:23:42][DEBUG] TransactionQueue créée.
[2025-05-02 00:23:42][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 00:23:42][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: wallets/
[2025-05-02 00:23:42][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 00:23:42][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 00:23:42][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 00:23:42][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 00:23:42][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 00:23:42][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 00:23:42][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 00:23:42][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 00:23:42][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 00:23:42][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 00:23:42][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 00:23:42][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 1 entrées chargées depuis users.txt
[2025-05-02 00:23:42][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 00:23:42][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 00:23:42][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 00:23:42][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 00:23:42][INFO] Global Thread de génération de prix initié.
[2025-05-02 00:23:42][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 00:23:42][INFO] Global Thread de génération de prix démarré.
[2025-05-02 00:23:42][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 00:23:42][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 00:23:42][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 00:23:42][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 5
[2025-05-02 00:23:42][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 00:23:42][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 00:23:42][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 00:23:42][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 00:23:42][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 00:23:42][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 00:23:42][INFO] Global Nouveau prix SRD-BTC simulé : 97585.1662369285
[2025-05-02 00:23:53][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 00:23:53][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 00:23:53][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 00:23:53][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 00:23:53][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 00:23:53][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 00:23:53][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 00:23:53][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 00:23:53][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 00:23:53][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 00:23:53][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 00:23:53][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 00:23:53][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 00:23:53][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 00:23:53][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 00:23:53][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:mon_client_id_depuis_script,TOKEN:mon_token_depuis_script
'
[2025-05-02 00:23:53][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'mon_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 00:23:53][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: mon_client_id_depuis_script...
[2025-05-02 00:23:53][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'mon_client_id_depuis_script'...
[2025-05-02 00:23:53][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'mon_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 00:23:53][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 00:23:53][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'mon_client_id_depuis_script'.
[2025-05-02 00:23:53][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'mon_client_id_depuis_script'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 00:23:53][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'mon_client_id_depuis_script' (SUCCESS). Socket FD: 10
[2025-05-02 00:23:53][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: mon_client_id_depuis_script...
[2025-05-02 00:23:53][INFO] ClientSession INFO : Initialisation pour client mon_client_id_depuis_script
[2025-05-02 00:23:53][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 00:23:53][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 00:23:53][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 00:23:53][WARNING] Wallet Impossible de charger le portefeuille pour client ID: mon_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : wallets/mon_client_id_depuis_script.wallet
[2025-05-02 00:23:53][DEBUG] Wallet Objet Wallet créé pour client ID: mon_client_id_depuis_script. Chemin du fichier: wallets/mon_client_id_depuis_script.wallet
[2025-05-02 00:23:53][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'mon_client_id_depuis_script'. Socket FD: 10
[2025-05-02 00:23:53][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 00:23:53][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: mon_client_id_depuis_script. Total sessions actives: 1.
[2025-05-02 00:23:53][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 00:23:53][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: mon_client_id_depuis_script
[2025-05-02 00:23:53][INFO] Server::HandleClient INFO : ClientSession pour client ID: mon_client_id_depuis_script enregistrée auprès de la TransactionQueue.
[2025-05-02 00:23:53][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 00:23:53][INFO] ClientSession
[2025-05-02 00:23:53][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: mon_client_id_depuis_script
[2025-05-02 00:23:53][INFO] ClientSession
[2025-05-02 00:23:53][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: mon_client_id_depuis_script. Le thread HandleClient va se terminer normalement.
[2025-05-02 00:23:53][INFO] ClientSession
[2025-05-02 00:23:56][INFO] ClientSession
[2025-05-02 00:23:56][INFO] ClientSession
[2025-05-02 00:23:57][INFO] Global Nouveau prix SRD-BTC simulé : 96763.4718994716
[2025-05-02 00:24:03][INFO] ClientSession
[2025-05-02 00:24:03][INFO] ClientSession
[2025-05-02 00:24:11][INFO] ClientSession
[2025-05-02 00:24:11][INFO] ClientSession
[2025-05-02 00:24:12][INFO] Global Nouveau prix SRD-BTC simulé : 94543.2089177479
[2025-05-02 00:24:27][INFO] Global Nouveau prix SRD-BTC simulé : 98230.5605202932
[2025-05-02 00:24:30][INFO] ClientSession
[2025-05-02 00:24:30][INFO] ClientSession
[2025-05-02 00:24:41][DEBUG] OpenSSL Callback: SSL3 alert write:fatal:decode error
[2025-05-02 00:24:41][WARNING] ServerConnection::receive WARNING : SSL_read retourné 0. Erreur code: 1. Socket FD: 10
[2025-05-02 00:24:41][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 10
[2025-05-02 00:24:41][INFO] ClientSession
[2025-05-02 00:24:41][INFO] ClientSession
[2025-05-02 00:24:42][INFO] Global Nouveau prix SRD-BTC simulé : 99522.9674553628
--- Début du log : 1746168701 ---
[2025-05-02 08:51:41][DEBUG] TransactionQueue créée.
[2025-05-02 08:51:41][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 08:51:41][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: wallets/
[2025-05-02 08:51:41][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 08:51:41][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 08:51:41][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 08:51:41][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 08:51:41][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 08:51:41][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 08:51:41][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 08:51:41][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 08:51:41][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 08:51:41][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 08:51:41][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 08:51:41][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 1 entrées chargées depuis users.txt
[2025-05-02 08:51:41][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 08:51:41][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 08:51:41][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 08:51:41][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 08:51:41][INFO] Global Thread de génération de prix initié.
[2025-05-02 08:51:41][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 08:51:41][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 08:51:41][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 08:51:41][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 08:51:41][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 08:51:41][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 08:51:41][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 08:51:41][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 08:51:41][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 08:51:41][INFO] Global Thread de génération de prix démarré.
[2025-05-02 08:51:41][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 08:51:41][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 08:51:41][INFO] Global Nouveau prix SRD-BTC simulé : 98292.2818145430
[2025-05-02 08:51:52][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 5, IP: 10.188.240.101
[2025-05-02 08:51:52][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 5
[2025-05-02 08:51:52][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 5
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 08:51:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 08:51:52][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 08:51:52][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 08:51:52][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 08:51:52][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 5
[2025-05-02 08:51:52][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 5
[2025-05-02 08:51:52][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 5
[2025-05-02 08:51:52][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (5) et SSL existants.
[2025-05-02 08:51:52][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 5
[2025-05-02 08:51:52][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 08:51:52][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 08:51:52][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 5
[2025-05-02 08:51:52][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 5 : 'ID:nouveau_client_id_depuis_script,TOKEN:nouveau_token_depuis_script
'
[2025-05-02 08:51:52][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'nouveau_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 5
[2025-05-02 08:51:52][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: nouveau_client_id_depuis_script...
[2025-05-02 08:51:52][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'nouveau_client_id_depuis_script'...
[2025-05-02 08:51:52][DEBUG] Server::processAuthRequest DEBUG : ID non trouvé : 'nouveau_client_id_depuis_script'. Tentative d'enregistrement...
[2025-05-02 08:51:52][WARNING] SecurityUtils WARNING : HashPasswordSecure est un placeholder. REMPLACER PAR UN VRAI HACHAGE SECURISÉ (bcrypt, Argon2) !
[2025-05-02 08:51:52][DEBUG] Server::processAuthRequest DEBUG : Nouvel utilisateur 'nouveau_client_id_depuis_script' ajouté à map en mémoire.
[2025-05-02 08:51:52][INFO] Server::SaveUsersInternal INFO : Sauvegarde de 2 utilisateurs dans users.txt
[2025-05-02 08:51:52][INFO] Server::processAuthRequest INFO : Liste utilisateurs sauvegardée sur disque après ajout ID: 'nouveau_client_id_depuis_script'.
[2025-05-02 08:51:52][DEBUG] Server::CreateWalletFile DEBUG : Tentative création fichier portefeuille: wallets//nouveau_client_id_depuis_script.wallet
[2025-05-02 08:51:52][WARNING] Server::CreateWalletFile WARNING : std::filesystem::create_directories retourné false mais ec non set. État inconnu répertoire.
[2025-05-02 08:51:52][DEBUG] Server::CreateWalletFile DEBUG : Fichier portefeuille ouvert/créé : wallets//nouveau_client_id_depuis_script.wallet
[2025-05-02 08:51:52][INFO] Server::CreateWalletFile INFO : Fichier portefeuille vierge créé et initialisé : wallets//nouveau_client_id_depuis_script.wallet
[2025-05-02 08:51:52][INFO] Server::processAuthRequest INFO : Fichier portefeuille créé avec succès pour ID: 'nouveau_client_id_depuis_script'.
[2025-05-02 08:51:52][INFO] Server::processAuthRequest INFO : Enregistrement nouvel utilisateur 'nouveau_client_id_depuis_script' réussi.
[2025-05-02 08:51:52][INFO] ClientAuthenticator::AuthenticateClient INFO : Enregistrement nouvel utilisateur et authentification réussie pour ID: 'nouveau_client_id_depuis_script'. Envoi réponse AUTH NEW au client.
[2025-05-02 08:51:52][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'nouveau_client_id_depuis_script' (NEW). Socket FD: 5
[2025-05-02 08:51:52][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: nouveau_client_id_depuis_script...
[2025-05-02 08:51:52][INFO] ClientSession INFO : Initialisation pour client nouveau_client_id_depuis_script
[2025-05-02 08:51:52][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 08:51:52][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 08:51:52][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 08:51:52][WARNING] Wallet Impossible de charger le portefeuille pour client ID: nouveau_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 08:51:52][DEBUG] Wallet Objet Wallet créé pour client ID: nouveau_client_id_depuis_script. Chemin du fichier: wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 08:51:52][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'nouveau_client_id_depuis_script'. Socket FD: 5
[2025-05-02 08:51:52][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 08:51:52][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: nouveau_client_id_depuis_script. Total sessions actives: 1.
[2025-05-02 08:51:52][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 08:51:52][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: nouveau_client_id_depuis_script
[2025-05-02 08:51:52][INFO] Server::HandleClient INFO : ClientSession pour client ID: nouveau_client_id_depuis_script enregistrée auprès de la TransactionQueue.
[2025-05-02 08:51:52][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 08:51:52][INFO] ClientSession
[2025-05-02 08:51:52][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: nouveau_client_id_depuis_script
[2025-05-02 08:51:52][INFO] ClientSession
[2025-05-02 08:51:52][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: nouveau_client_id_depuis_script. Le thread HandleClient va se terminer normalement.
[2025-05-02 08:51:52][INFO] ClientSession
[2025-05-02 08:51:56][INFO] Global Nouveau prix SRD-BTC simulé : 99513.5644849188
[2025-05-02 08:52:12][INFO] Global Nouveau prix SRD-BTC simulé : 95575.0684677334
[2025-05-02 08:52:27][INFO] Global Nouveau prix SRD-BTC simulé : 93839.3388973463
[2025-05-02 08:52:42][INFO] Global Nouveau prix SRD-BTC simulé : 96851.2570759012
[2025-05-02 08:52:57][INFO] Global Nouveau prix SRD-BTC simulé : 97547.7906969332
[2025-05-02 08:53:12][INFO] Global Nouveau prix SRD-BTC simulé : 95337.2220285376
[2025-05-02 08:53:16][DEBUG] OpenSSL Callback: SSL3 alert read:warning:close notify
[2025-05-02 08:53:16][INFO] ServerConnection::receive INFO : Connexion fermée proprement par le pair (SSL_ERROR_ZERO_RETURN). Socket FD: 5
[2025-05-02 08:53:16][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 5
[2025-05-02 08:53:16][INFO] ClientSession
[2025-05-02 08:53:16][INFO] ClientSession
[2025-05-02 08:53:27][INFO] Global Nouveau prix SRD-BTC simulé : 98586.0514819567
[2025-05-02 08:53:31][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 08:53:31][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 08:53:31][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 08:53:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 08:53:31][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 08:53:31][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 08:53:31][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 08:53:31][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 08:53:31][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 08:53:31][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 08:53:31][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 08:53:31][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 08:53:31][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 08:53:31][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 08:53:31][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 08:53:31][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:nouveau_client_id_depuis_script,TOKEN:nouveau_token_depuis_script
'
[2025-05-02 08:53:31][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'nouveau_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 08:53:31][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: nouveau_client_id_depuis_script...
[2025-05-02 08:53:31][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'nouveau_client_id_depuis_script'...
[2025-05-02 08:53:31][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'nouveau_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 08:53:31][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 08:53:31][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'nouveau_client_id_depuis_script'.
[2025-05-02 08:53:31][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'nouveau_client_id_depuis_script'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 08:53:31][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'nouveau_client_id_depuis_script' (SUCCESS). Socket FD: 10
[2025-05-02 08:53:31][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: nouveau_client_id_depuis_script...
[2025-05-02 08:53:31][INFO] ClientSession INFO : Initialisation pour client nouveau_client_id_depuis_script
[2025-05-02 08:53:31][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 08:53:31][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 08:53:31][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 08:53:31][WARNING] Wallet Impossible de charger le portefeuille pour client ID: nouveau_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 08:53:31][DEBUG] Wallet Objet Wallet créé pour client ID: nouveau_client_id_depuis_script. Chemin du fichier: wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 08:53:31][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'nouveau_client_id_depuis_script'. Socket FD: 10
[2025-05-02 08:53:31][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 08:53:31][INFO] ClientSession
[2025-05-02 08:53:31][INFO] ClientSession
[2025-05-02 08:53:31][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 08:53:31][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 08:53:31][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 08:53:31][INFO] ClientSession
--- Début du log : 1746169739 ---
[2025-05-02 09:08:59][DEBUG] TransactionQueue créée.
[2025-05-02 09:08:59][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 09:08:59][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: wallets/
[2025-05-02 09:08:59][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 09:08:59][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 09:08:59][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 09:08:59][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 09:08:59][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 09:08:59][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 09:08:59][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 09:08:59][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 09:08:59][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 09:08:59][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 09:08:59][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 09:08:59][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 2 entrées chargées depuis users.txt
[2025-05-02 09:08:59][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 09:08:59][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 09:08:59][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 09:08:59][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 09:08:59][INFO] Global Thread de génération de prix initié.
[2025-05-02 09:08:59][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 09:08:59][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 09:08:59][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 09:08:59][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 09:08:59][INFO] Global Thread de génération de prix démarré.
[2025-05-02 09:08:59][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 09:08:59][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 09:08:59][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 09:08:59][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 09:08:59][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 09:08:59][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 09:08:59][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 09:09:00][INFO] Global Nouveau prix SRD-BTC simulé : 95421.5563161594
[2025-05-02 09:09:08][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 6, IP: 10.188.240.101
[2025-05-02 09:09:08][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 6
[2025-05-02 09:09:08][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 6
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:09:08][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:09:08][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 09:09:08][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 09:09:08][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 09:09:08][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 6
[2025-05-02 09:09:08][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 6
[2025-05-02 09:09:08][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 6
[2025-05-02 09:09:08][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (6) et SSL existants.
[2025-05-02 09:09:08][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 6
[2025-05-02 09:09:08][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 09:09:08][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 09:09:08][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 6
[2025-05-02 09:09:08][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 6 : 'ID:nouveau_client_id_depuis_script,TOKEN:nouveau_token_depuis_script
'
[2025-05-02 09:09:08][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'nouveau_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 6
[2025-05-02 09:09:08][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: nouveau_client_id_depuis_script...
[2025-05-02 09:09:08][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'nouveau_client_id_depuis_script'...
[2025-05-02 09:09:08][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'nouveau_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 09:09:08][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 09:09:08][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'nouveau_client_id_depuis_script'.
[2025-05-02 09:09:08][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'nouveau_client_id_depuis_script'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 09:09:08][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'nouveau_client_id_depuis_script' (SUCCESS). Socket FD: 6
[2025-05-02 09:09:08][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: nouveau_client_id_depuis_script...
[2025-05-02 09:09:08][INFO] ClientSession INFO : Initialisation pour client nouveau_client_id_depuis_script
[2025-05-02 09:09:08][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 09:09:08][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 09:09:08][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 09:09:08][WARNING] Wallet Impossible de charger le portefeuille pour client ID: nouveau_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:09:08][DEBUG] Wallet Objet Wallet créé pour client ID: nouveau_client_id_depuis_script. Chemin du fichier: wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:09:08][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'nouveau_client_id_depuis_script'. Socket FD: 6
[2025-05-02 09:09:08][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 09:09:08][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: nouveau_client_id_depuis_script. Total sessions actives: 1.
[2025-05-02 09:09:08][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 09:09:08][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: nouveau_client_id_depuis_script
[2025-05-02 09:09:08][INFO] Server::HandleClient INFO : ClientSession pour client ID: nouveau_client_id_depuis_script enregistrée auprès de la TransactionQueue.
[2025-05-02 09:09:08][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 09:09:08][INFO] ClientSession INFO : Démarrage du thread de session pour client nouveau_client_id_depuis_script
[2025-05-02 09:09:08][INFO] ClientSession INFO : Thread de session démarré et joignable pour client nouveau_client_id_depuis_script
[2025-05-02 09:09:08][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: nouveau_client_id_depuis_script. Le thread HandleClient va se terminer normalement.
[2025-05-02 09:09:08][INFO] ClientSession
[2025-05-02 09:09:15][INFO] Global Nouveau prix SRD-BTC simulé : 97114.5647697309
[2025-05-02 09:09:28][DEBUG] OpenSSL Callback: SSL3 alert read:warning:close notify
[2025-05-02 09:09:28][INFO] ServerConnection::receive INFO : Connexion fermée proprement par le pair (SSL_ERROR_ZERO_RETURN). Socket FD: 6
[2025-05-02 09:09:28][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 6
[2025-05-02 09:09:28][INFO] ClientSession
[2025-05-02 09:09:28][INFO] ClientSession
[2025-05-02 09:09:30][INFO] Global Nouveau prix SRD-BTC simulé : 99086.1256911345
[2025-05-02 09:09:32][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 09:09:32][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 09:09:32][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:09:32][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:09:32][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 09:09:32][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 09:09:32][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 09:09:32][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 09:09:32][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 09:09:32][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 09:09:32][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 09:09:32][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 09:09:32][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 09:09:32][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 09:09:32][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 09:09:32][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:nouveau_client_id_depuis_script,TOKEN:nouveau_token_depuis_script
'
[2025-05-02 09:09:32][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'nouveau_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 09:09:32][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: nouveau_client_id_depuis_script...
[2025-05-02 09:09:32][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'nouveau_client_id_depuis_script'...
[2025-05-02 09:09:32][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'nouveau_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 09:09:32][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 09:09:32][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'nouveau_client_id_depuis_script'.
[2025-05-02 09:09:32][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'nouveau_client_id_depuis_script'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 09:09:32][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'nouveau_client_id_depuis_script' (SUCCESS). Socket FD: 10
[2025-05-02 09:09:32][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: nouveau_client_id_depuis_script...
[2025-05-02 09:09:32][INFO] ClientSession INFO : Initialisation pour client nouveau_client_id_depuis_script
[2025-05-02 09:09:32][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 09:09:32][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 09:09:32][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 09:09:32][WARNING] Wallet Impossible de charger le portefeuille pour client ID: nouveau_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:09:32][DEBUG] Wallet Objet Wallet créé pour client ID: nouveau_client_id_depuis_script. Chemin du fichier: wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:09:32][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'nouveau_client_id_depuis_script'. Socket FD: 10
[2025-05-02 09:09:32][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 09:09:32][INFO] ClientSession INFO : Destruction de la session pour client nouveau_client_id_depuis_script
[2025-05-02 09:09:32][WARNING] ClientSession WARNING : La session nouveau_client_id_depuis_script n'était pas en cours d'exécution lors de la demande d'arrêt.
[2025-05-02 09:09:32][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 09:09:32][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 09:09:32][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 09:09:32][INFO] ClientSession INFO : Portefeuille sauvegardé pour nouveau_client_id_depuis_script avant destruction.
--- Début du log : 1746171382 ---
[2025-05-02 09:36:22][DEBUG] TransactionQueue créée.
[2025-05-02 09:36:22][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 09:36:22][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: wallets/
[2025-05-02 09:36:22][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 09:36:22][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 09:36:22][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 09:36:22][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 09:36:22][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 09:36:22][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 09:36:22][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 09:36:22][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 09:36:22][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 09:36:22][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 09:36:22][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 09:36:22][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 2 entrées chargées depuis users.txt
[2025-05-02 09:36:22][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 09:36:22][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 09:36:22][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 09:36:22][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 09:36:22][INFO] Global Thread de génération de prix initié.
[2025-05-02 09:36:22][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 09:36:22][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 09:36:22][INFO] Global Thread de génération de prix démarré.
[2025-05-02 09:36:22][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 09:36:22][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 09:36:22][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 09:36:22][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 10
[2025-05-02 09:36:22][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 09:36:22][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 09:36:22][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 09:36:22][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 09:36:22][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 09:36:23][INFO] Global Nouveau prix SRD-BTC simulé : 97183.5087644283
[2025-05-02 09:36:31][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 11, IP: 10.188.240.101
[2025-05-02 09:36:31][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 11
[2025-05-02 09:36:31][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 11
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:36:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:36:31][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 09:36:31][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 09:36:31][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 09:36:31][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 11
[2025-05-02 09:36:31][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 11
[2025-05-02 09:36:31][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 11
[2025-05-02 09:36:31][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (11) et SSL existants.
[2025-05-02 09:36:31][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 11
[2025-05-02 09:36:31][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 09:36:31][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 09:36:31][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 11
[2025-05-02 09:36:31][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 11 : 'ID:nouveau_client_id_depuis_script,TOKEN:nouveau_token_depuis_script
'
[2025-05-02 09:36:31][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'nouveau_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 11
[2025-05-02 09:36:31][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: nouveau_client_id_depuis_script...
[2025-05-02 09:36:31][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'nouveau_client_id_depuis_script'...
[2025-05-02 09:36:31][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'nouveau_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 09:36:31][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 09:36:31][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'nouveau_client_id_depuis_script'.
[2025-05-02 09:36:31][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'nouveau_client_id_depuis_script'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 09:36:31][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'nouveau_client_id_depuis_script' (SUCCESS). Socket FD: 11
[2025-05-02 09:36:31][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: nouveau_client_id_depuis_script...
[2025-05-02 09:36:31][INFO] ClientSession INFO : Initialisation pour client nouveau_client_id_depuis_script
[2025-05-02 09:36:31][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 09:36:31][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 09:36:31][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 09:36:31][WARNING] Wallet Impossible de charger le portefeuille pour client ID: nouveau_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:36:31][DEBUG] Wallet Objet Wallet créé pour client ID: nouveau_client_id_depuis_script. Chemin du fichier: wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:36:31][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'nouveau_client_id_depuis_script'. Socket FD: 11
[2025-05-02 09:36:31][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 09:36:31][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: nouveau_client_id_depuis_script. Total sessions actives: 1.
[2025-05-02 09:36:31][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 09:36:31][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: nouveau_client_id_depuis_script
[2025-05-02 09:36:31][INFO] Server::HandleClient INFO : ClientSession pour client ID: nouveau_client_id_depuis_script enregistrée auprès de la TransactionQueue.
[2025-05-02 09:36:31][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 09:36:31][INFO] ClientSession INFO : Démarrage du thread de session pour client nouveau_client_id_depuis_script
[2025-05-02 09:36:31][INFO] ClientSession INFO : Thread de session démarré et joignable pour client nouveau_client_id_depuis_script
[2025-05-02 09:36:31][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: nouveau_client_id_depuis_script. Le thread HandleClient va se terminer normalement.
[2025-05-02 09:36:31][INFO] ClientSession INFO : Thread de session démarré pour client nouveau_client_id_depuis_script
[2025-05-02 09:36:38][INFO] Global Nouveau prix SRD-BTC simulé : 96390.5045006881
[2025-05-02 09:36:45][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 09:36:53][INFO] Global Nouveau prix SRD-BTC simulé : 98278.9043114237
[2025-05-02 09:37:08][INFO] Global Nouveau prix SRD-BTC simulé : 94644.1375508814
[2025-05-02 09:37:23][INFO] Global Nouveau prix SRD-BTC simulé : 95158.3970875284
[2025-05-02 09:37:38][INFO] Global Nouveau prix SRD-BTC simulé : 99151.0391364146
[2025-05-02 09:37:41][DEBUG] OpenSSL Callback: SSL3 alert write:fatal:decode error
[2025-05-02 09:37:41][WARNING] ServerConnection::receive WARNING : SSL_read retourné 0. Erreur code: 1. Socket FD: 11
[2025-05-02 09:37:41][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 11
[2025-05-02 09:37:41][INFO] ClientSession INFO : Déconnexion propre détectée pour client nouveau_client_id_depuis_script. Socket FD: 11
[2025-05-02 09:37:41][INFO] ClientSession INFO : Sortie de la boucle de session pour client nouveau_client_id_depuis_script. Raison: running=0, client_connected=0
[2025-05-02 09:37:53][INFO] Global Nouveau prix SRD-BTC simulé : 97549.3107278046
[2025-05-02 09:38:08][INFO] Global Nouveau prix SRD-BTC simulé : 94668.0925120381
[2025-05-02 09:38:23][INFO] Global Nouveau prix SRD-BTC simulé : 97433.4420788197
[2025-05-02 09:38:38][INFO] Global Nouveau prix SRD-BTC simulé : 96584.4853517615
[2025-05-02 09:38:53][INFO] Global Nouveau prix SRD-BTC simulé : 98923.7334553923
[2025-05-02 09:39:08][INFO] Global Nouveau prix SRD-BTC simulé : 96220.9112897938
[2025-05-02 09:39:23][INFO] Global Nouveau prix SRD-BTC simulé : 98379.8500958209
[2025-05-02 09:39:38][INFO] Global Nouveau prix SRD-BTC simulé : 93975.0224759572
[2025-05-02 09:39:53][INFO] Global Nouveau prix SRD-BTC simulé : 94029.9983984385
[2025-05-02 09:40:08][INFO] Global Nouveau prix SRD-BTC simulé : 97593.4108245993
[2025-05-02 09:40:23][INFO] Global Nouveau prix SRD-BTC simulé : 96526.1676723935
[2025-05-02 09:40:38][INFO] Global Nouveau prix SRD-BTC simulé : 94687.9161577033
[2025-05-02 09:40:53][INFO] Global Nouveau prix SRD-BTC simulé : 99305.1599717626
[2025-05-02 09:41:09][INFO] Global Nouveau prix SRD-BTC simulé : 98328.5075828029
[2025-05-02 09:41:24][INFO] Global Nouveau prix SRD-BTC simulé : 96413.4431584449
[2025-05-02 09:41:39][INFO] Global Nouveau prix SRD-BTC simulé : 97521.9777443051
[2025-05-02 09:41:54][INFO] Global Nouveau prix SRD-BTC simulé : 96521.3600458801
[2025-05-02 09:42:09][INFO] Global Nouveau prix SRD-BTC simulé : 95386.4964061300
[2025-05-02 09:42:24][INFO] Global Nouveau prix SRD-BTC simulé : 99096.4938025312
[2025-05-02 09:42:39][INFO] Global Nouveau prix SRD-BTC simulé : 98339.0568715352
[2025-05-02 09:42:54][INFO] Global Nouveau prix SRD-BTC simulé : 96546.6074666697
[2025-05-02 09:43:09][INFO] Global Nouveau prix SRD-BTC simulé : 97491.1934876602
[2025-05-02 09:43:24][INFO] Global Nouveau prix SRD-BTC simulé : 96948.3198372616
[2025-05-02 09:43:39][INFO] Global Nouveau prix SRD-BTC simulé : 98727.1892458265
--- Début du log : 1746171852 ---
[2025-05-02 09:44:12][DEBUG] TransactionQueue créée.
[2025-05-02 09:44:12][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 09:44:12][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: wallets/
[2025-05-02 09:44:12][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 09:44:12][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 09:44:12][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 09:44:12][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 09:44:12][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 09:44:12][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 09:44:12][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 09:44:12][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 09:44:12][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 09:44:12][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 09:44:12][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 09:44:12][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 2 entrées chargées depuis users.txt
[2025-05-02 09:44:12][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 09:44:12][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 09:44:12][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 09:44:12][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 09:44:12][INFO] Global Thread de génération de prix initié.
[2025-05-02 09:44:12][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 09:44:12][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 09:44:12][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 09:44:12][INFO] Global Thread de génération de prix démarré.
[2025-05-02 09:44:12][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 09:44:12][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 09:44:12][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 09:44:12][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 09:44:12][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 09:44:12][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 09:44:12][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 09:44:12][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 09:44:12][INFO] Global Nouveau prix SRD-BTC simulé : 97891.3819161745
[2025-05-02 09:44:18][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 8, IP: 10.188.240.101
[2025-05-02 09:44:18][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 8
[2025-05-02 09:44:18][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 8
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:44:18][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:44:18][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 09:44:18][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 8
[2025-05-02 09:44:18][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 8
[2025-05-02 09:44:18][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 8
[2025-05-02 09:44:18][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 8
[2025-05-02 09:44:18][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 8
[2025-05-02 09:44:18][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (8) et SSL existants.
[2025-05-02 09:44:18][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 8
[2025-05-02 09:44:18][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 09:44:18][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 09:44:18][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 8
[2025-05-02 09:44:18][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 8 : 'ID:nouveau_client_id_depuis_script,TOKEN:nouveau_token_depuis_script
'
[2025-05-02 09:44:18][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'nouveau_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 8
[2025-05-02 09:44:18][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: nouveau_client_id_depuis_script...
[2025-05-02 09:44:18][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'nouveau_client_id_depuis_script'...
[2025-05-02 09:44:18][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'nouveau_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 09:44:18][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 09:44:18][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'nouveau_client_id_depuis_script'.
[2025-05-02 09:44:18][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'nouveau_client_id_depuis_script'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 09:44:18][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'nouveau_client_id_depuis_script' (SUCCESS). Socket FD: 8
[2025-05-02 09:44:18][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: nouveau_client_id_depuis_script...
[2025-05-02 09:44:18][INFO] ClientSession INFO : Initialisation pour client nouveau_client_id_depuis_script
[2025-05-02 09:44:18][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 09:44:18][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 09:44:18][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 09:44:18][WARNING] Wallet Impossible de charger le portefeuille pour client ID: nouveau_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:44:18][DEBUG] Wallet Objet Wallet créé pour client ID: nouveau_client_id_depuis_script. Chemin du fichier: wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:44:18][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'nouveau_client_id_depuis_script'. Socket FD: 8
[2025-05-02 09:44:18][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 09:44:18][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: nouveau_client_id_depuis_script. Total sessions actives: 1.
[2025-05-02 09:44:18][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 09:44:18][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: nouveau_client_id_depuis_script
[2025-05-02 09:44:18][INFO] Server::HandleClient INFO : ClientSession pour client ID: nouveau_client_id_depuis_script enregistrée auprès de la TransactionQueue.
[2025-05-02 09:44:18][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 09:44:18][INFO] ClientSession INFO : Démarrage du thread de session pour client nouveau_client_id_depuis_script
[2025-05-02 09:44:18][INFO] ClientSession INFO : Thread de session démarré et joignable pour client nouveau_client_id_depuis_script
[2025-05-02 09:44:18][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: nouveau_client_id_depuis_script. Le thread HandleClient va se terminer normalement.
[2025-05-02 09:44:18][INFO] ClientSession INFO : Thread de session démarré pour client nouveau_client_id_depuis_script
[2025-05-02 09:44:26][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 09:44:26][INFO] ClientSession
[2025-05-02 09:44:27][INFO] Global Nouveau prix SRD-BTC simulé : 96227.4784538853
[2025-05-02 09:44:42][INFO] Global Nouveau prix SRD-BTC simulé : 95624.2395230851
[2025-05-02 09:44:43][DEBUG] ClientSession DEBUG : Reçu 4 octets. Buffer d'accumulation: 4 octets.
[2025-05-02 09:44:43][INFO] ClientSession
[2025-05-02 09:44:57][INFO] Global Nouveau prix SRD-BTC simulé : 95661.7159755733
[2025-05-02 09:45:00][DEBUG] ClientSession DEBUG : Reçu 16 octets. Buffer d'accumulation: 16 octets.
[2025-05-02 09:45:00][INFO] ClientSession
[2025-05-02 09:45:12][INFO] Global Nouveau prix SRD-BTC simulé : 97404.6280573144
[2025-05-02 09:45:20][DEBUG] OpenSSL Callback: SSL3 alert read:warning:close notify
[2025-05-02 09:45:20][INFO] ServerConnection::receive INFO : Connexion fermée proprement par le pair (SSL_ERROR_ZERO_RETURN). Socket FD: 8
[2025-05-02 09:45:20][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 8
[2025-05-02 09:45:20][INFO] ClientSession INFO : Déconnexion propre détectée pour client nouveau_client_id_depuis_script. Socket FD: 8
[2025-05-02 09:45:20][INFO] ClientSession INFO : Sortie de la boucle de session pour client nouveau_client_id_depuis_script. Raison: running=0, client_connected=0
[2025-05-02 09:45:23][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 09:45:23][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 09:45:23][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:45:23][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 09:45:23][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 09:45:23][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 09:45:23][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 09:45:23][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 09:45:23][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 09:45:23][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 09:45:23][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 09:45:23][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 09:45:23][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 09:45:23][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 09:45:23][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:nouveau_client_id_depuis_script,TOKEN:nouveau_token_depuis_script
'
[2025-05-02 09:45:23][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'nouveau_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 09:45:23][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: nouveau_client_id_depuis_script...
[2025-05-02 09:45:23][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'nouveau_client_id_depuis_script'...
[2025-05-02 09:45:23][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'nouveau_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 09:45:23][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 09:45:23][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'nouveau_client_id_depuis_script'.
[2025-05-02 09:45:23][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'nouveau_client_id_depuis_script'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 09:45:23][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'nouveau_client_id_depuis_script' (SUCCESS). Socket FD: 10
[2025-05-02 09:45:23][WARNING] Server::HandleClient WARNING : Connexion refusée. Une session pour client ID: 'nouveau_client_id_depuis_script' est déjà active. Socket FD: 10
[2025-05-02 09:45:23][INFO] ServerConnection::closeConnection INFO : Fermeture de la connexion pour socket FD: 10
[2025-05-02 09:45:23][DEBUG] OpenSSL Callback: SSL3 alert write:warning:close notify
[2025-05-02 09:45:23][DEBUG] ServerConnection::closeConnection DEBUG : SSL_shutdown étape 1/2 terminée. Tentative étape 2 (peut bloquer).
[2025-05-02 09:45:23][DEBUG] ServerConnection::closeConnection DEBUG : Objet SSL libéré.
[2025-05-02 09:45:23][DEBUG] ServerConnection::closeConnection DEBUG : Fermeture du socket FD: 10
[2025-05-02 09:45:23][INFO] ServerConnection::closeConnection INFO : Socket FD: 10 fermé.
[2025-05-02 09:45:23][DEBUG] ServerConnection::closeConnection DEBUG : Nettoyage de connexion terminé.
[2025-05-02 09:45:23][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur appelé. Socket FD final: -1
[2025-05-02 09:45:23][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur terminé.
[2025-05-02 09:45:28][INFO] Global Nouveau prix SRD-BTC simulé : 97338.5616457559
[2025-05-02 09:45:43][INFO] Global Nouveau prix SRD-BTC simulé : 97463.8826400240
[2025-05-02 09:45:58][INFO] Global Nouveau prix SRD-BTC simulé : 96701.9202116663
[2025-05-02 09:46:13][INFO] Global Nouveau prix SRD-BTC simulé : 96878.1646677292
[2025-05-02 09:46:28][INFO] Global Nouveau prix SRD-BTC simulé : 96691.1614175291
[2025-05-02 09:46:43][INFO] Global Nouveau prix SRD-BTC simulé : 97809.9866754583
--- Début du log : 1746172279 ---
[2025-05-02 09:51:19][DEBUG] TransactionQueue créée.
[2025-05-02 09:51:19][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 09:51:19][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: wallets/
[2025-05-02 09:51:19][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 09:51:19][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 09:51:19][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 09:51:19][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 09:51:19][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 09:51:19][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 09:51:19][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 09:51:19][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 09:51:19][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 09:51:19][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 09:51:19][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 09:51:19][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 2 entrées chargées depuis users.txt
[2025-05-02 09:51:19][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 09:51:19][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 09:51:19][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 09:51:19][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 09:51:19][INFO] Global Thread de génération de prix initié.
[2025-05-02 09:51:19][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 09:51:19][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 09:51:19][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 09:51:19][INFO] Global Thread de génération de prix démarré.
[2025-05-02 09:51:19][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 09:51:19][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 09:51:19][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 09:51:19][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 09:51:19][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 09:51:19][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 09:51:19][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 09:51:19][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 09:51:20][INFO] Global Nouveau prix SRD-BTC simulé : 95578.0073694584
[2025-05-02 09:51:27][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 6, IP: 10.188.240.101
[2025-05-02 09:51:27][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 6
[2025-05-02 09:51:27][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 6
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 09:51:27][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:51:28][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:51:28][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 09:51:28][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 09:51:28][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 09:51:28][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 6
[2025-05-02 09:51:28][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 6
[2025-05-02 09:51:28][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 6
[2025-05-02 09:51:28][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (6) et SSL existants.
[2025-05-02 09:51:28][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 6
[2025-05-02 09:51:28][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 09:51:28][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 09:51:28][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 6
[2025-05-02 09:51:28][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 6 : 'ID:nouveau_client_id_depuis_script,TOKEN:nouveau_token_depuis_script
'
[2025-05-02 09:51:28][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'nouveau_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 6
[2025-05-02 09:51:28][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: nouveau_client_id_depuis_script...
[2025-05-02 09:51:28][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'nouveau_client_id_depuis_script'...
[2025-05-02 09:51:28][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'nouveau_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 09:51:28][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 09:51:28][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'nouveau_client_id_depuis_script'.
[2025-05-02 09:51:28][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'nouveau_client_id_depuis_script'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 09:51:28][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'nouveau_client_id_depuis_script' (SUCCESS). Socket FD: 6
[2025-05-02 09:51:28][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: nouveau_client_id_depuis_script...
[2025-05-02 09:51:28][INFO] ClientSession INFO : Initialisation pour client nouveau_client_id_depuis_script
[2025-05-02 09:51:28][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : wallets
[2025-05-02 09:51:28][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 09:51:28][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire 'wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 09:51:28][WARNING] Wallet Impossible de charger le portefeuille pour client ID: nouveau_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:51:28][DEBUG] Wallet Objet Wallet créé pour client ID: nouveau_client_id_depuis_script. Chemin du fichier: wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:51:28][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'nouveau_client_id_depuis_script'. Socket FD: 6
[2025-05-02 09:51:28][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 09:51:28][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: nouveau_client_id_depuis_script. Total sessions actives: 1.
[2025-05-02 09:51:28][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 09:51:28][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: nouveau_client_id_depuis_script
[2025-05-02 09:51:28][INFO] Server::HandleClient INFO : ClientSession pour client ID: nouveau_client_id_depuis_script enregistrée auprès de la TransactionQueue.
[2025-05-02 09:51:28][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 09:51:28][INFO] ClientSession INFO : Démarrage du thread de session pour client nouveau_client_id_depuis_script
[2025-05-02 09:51:28][INFO] ClientSession INFO : Thread de session démarré et joignable pour client nouveau_client_id_depuis_script
[2025-05-02 09:51:28][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: nouveau_client_id_depuis_script. Le thread HandleClient va se terminer normalement.
[2025-05-02 09:51:28][INFO] ClientSession INFO : Thread de session démarré pour client nouveau_client_id_depuis_script
[2025-05-02 09:51:35][INFO] Global Nouveau prix SRD-BTC simulé : 96425.2772384412
[2025-05-02 09:51:46][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 09:51:46][INFO] ClientSession
[2025-05-02 09:51:50][INFO] Global Nouveau prix SRD-BTC simulé : 97113.5603230037
[2025-05-02 09:52:00][DEBUG] OpenSSL Callback: SSL3 alert read:warning:close notify
[2025-05-02 09:52:00][INFO] ServerConnection::receive INFO : Connexion fermée proprement par le pair (SSL_ERROR_ZERO_RETURN). Socket FD: 6
[2025-05-02 09:52:00][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 6
[2025-05-02 09:52:00][INFO] ClientSession INFO : Déconnexion propre détectée pour client nouveau_client_id_depuis_script. Socket FD: 6
[2025-05-02 09:52:00][INFO] ClientSession INFO : Sortie de la boucle de session pour client nouveau_client_id_depuis_script. Raison: running=0, client_connected=0
[2025-05-02 09:52:05][INFO] Global Nouveau prix SRD-BTC simulé : 97308.7825500171
--- Début du log : 1746172787 ---
[2025-05-02 09:59:47][DEBUG] TransactionQueue créée.
[2025-05-02 09:59:47][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 09:59:47][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 09:59:47][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 09:59:47][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 09:59:47][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 09:59:47][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 09:59:47][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 09:59:47][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 09:59:47][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 09:59:47][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 09:59:47][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 09:59:47][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 09:59:47][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 09:59:47][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 2 entrées chargées depuis users.txt
[2025-05-02 09:59:47][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 09:59:47][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 09:59:47][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 09:59:47][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 09:59:47][INFO] Global Thread de génération de prix initié.
[2025-05-02 09:59:47][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 09:59:47][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 09:59:47][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 09:59:47][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 09:59:47][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 09:59:47][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 09:59:47][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 09:59:47][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 09:59:47][INFO] Global Thread de génération de prix démarré.
[2025-05-02 09:59:47][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 09:59:47][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 09:59:47][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 09:59:47][INFO] Global Nouveau prix SRD-BTC simulé : 97603.3955075464
[2025-05-02 09:59:58][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 09:59:58][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 09:59:58][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:59:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 09:59:58][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 09:59:58][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 09:59:58][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 09:59:58][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 09:59:58][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 09:59:58][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 09:59:58][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 09:59:58][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 09:59:58][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 09:59:58][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 09:59:58][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 09:59:58][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:nouveau_client_id_depuis_script,TOKEN:nouveau_token_depuis_script
'
[2025-05-02 09:59:58][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'nouveau_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 09:59:58][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: nouveau_client_id_depuis_script...
[2025-05-02 09:59:58][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'nouveau_client_id_depuis_script'...
[2025-05-02 09:59:58][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'nouveau_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 09:59:58][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 09:59:58][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'nouveau_client_id_depuis_script'.
[2025-05-02 09:59:58][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'nouveau_client_id_depuis_script'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 09:59:58][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'nouveau_client_id_depuis_script' (SUCCESS). Socket FD: 10
[2025-05-02 09:59:58][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: nouveau_client_id_depuis_script...
[2025-05-02 09:59:58][INFO] ClientSession INFO : Initialisation pour client nouveau_client_id_depuis_script
[2025-05-02 09:59:58][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 09:59:58][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 09:59:58][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire '../src/data/wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 09:59:58][WARNING] Wallet Impossible de charger le portefeuille pour client ID: nouveau_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : ../src/data/wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:59:58][DEBUG] Wallet Objet Wallet créé pour client ID: nouveau_client_id_depuis_script. Chemin du fichier: ../src/data/wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 09:59:58][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'nouveau_client_id_depuis_script'. Socket FD: 10
[2025-05-02 09:59:58][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 09:59:58][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: nouveau_client_id_depuis_script. Total sessions actives: 1.
[2025-05-02 09:59:58][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 09:59:58][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: nouveau_client_id_depuis_script
[2025-05-02 09:59:58][INFO] Server::HandleClient INFO : ClientSession pour client ID: nouveau_client_id_depuis_script enregistrée auprès de la TransactionQueue.
[2025-05-02 09:59:58][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 09:59:58][INFO] ClientSession INFO : Démarrage du thread de session pour client nouveau_client_id_depuis_script
[2025-05-02 09:59:58][INFO] ClientSession INFO : Thread de session démarré et joignable pour client nouveau_client_id_depuis_script
[2025-05-02 09:59:58][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: nouveau_client_id_depuis_script. Le thread HandleClient va se terminer normalement.
[2025-05-02 09:59:58][INFO] ClientSession INFO : Thread de session démarré pour client nouveau_client_id_depuis_script
[2025-05-02 10:00:02][INFO] Global Nouveau prix SRD-BTC simulé : 98224.5369786652
[2025-05-02 10:00:06][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 10:00:06][INFO] ClientSession
[2025-05-02 10:00:11][DEBUG] OpenSSL Callback: SSL3 alert read:warning:close notify
[2025-05-02 10:00:11][INFO] ServerConnection::receive INFO : Connexion fermée proprement par le pair (SSL_ERROR_ZERO_RETURN). Socket FD: 10
[2025-05-02 10:00:11][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 10
[2025-05-02 10:00:11][INFO] ClientSession INFO : Déconnexion propre détectée pour client nouveau_client_id_depuis_script. Socket FD: 10
[2025-05-02 10:00:11][INFO] ClientSession INFO : Sortie de la boucle de session pour client nouveau_client_id_depuis_script. Raison: running=0, client_connected=0
--- Début du log : 1746172913 ---
[2025-05-02 10:01:53][DEBUG] TransactionQueue créée.
[2025-05-02 10:01:53][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 10:01:53][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 10:01:53][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 10:01:53][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 10:01:53][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 10:01:53][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 10:01:53][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 10:01:53][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 10:01:53][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 10:01:53][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 10:01:53][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 10:01:53][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 10:01:53][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 10:01:53][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 2 entrées chargées depuis users.txt
[2025-05-02 10:01:53][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 10:01:53][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 10:01:53][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 10:01:53][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 10:01:53][INFO] Global Thread de génération de prix initié.
[2025-05-02 10:01:53][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 10:01:53][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 10:01:53][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 10:01:53][INFO] Global Thread de génération de prix démarré.
[2025-05-02 10:01:53][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 10:01:53][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 10:01:53][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 10:01:53][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 10:01:53][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 10:01:53][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 10:01:53][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 10:01:53][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 10:01:53][INFO] Global Nouveau prix SRD-BTC simulé : 96513.1926553044
[2025-05-02 10:01:59][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 8, IP: 10.188.240.101
[2025-05-02 10:01:59][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 8
[2025-05-02 10:01:59][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 8
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:01:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:01:59][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 10:01:59][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 8
[2025-05-02 10:01:59][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 8
[2025-05-02 10:01:59][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 8
[2025-05-02 10:01:59][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 8
[2025-05-02 10:01:59][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 8
[2025-05-02 10:01:59][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (8) et SSL existants.
[2025-05-02 10:01:59][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 8
[2025-05-02 10:01:59][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 10:01:59][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 10:01:59][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 8
[2025-05-02 10:01:59][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 8 : 'ID:nouveau_client_id_depuis_script,TOKEN:nouveau_token_depuis_script
'
[2025-05-02 10:01:59][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'nouveau_client_id_depuis_script', Mot de passe: '[CACHÉ]'. Socket FD: 8
[2025-05-02 10:01:59][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: nouveau_client_id_depuis_script...
[2025-05-02 10:01:59][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'nouveau_client_id_depuis_script'...
[2025-05-02 10:01:59][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'nouveau_client_id_depuis_script'. Vérification du mot de passe...
[2025-05-02 10:01:59][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 10:01:59][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'nouveau_client_id_depuis_script'.
[2025-05-02 10:01:59][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'nouveau_client_id_depuis_script'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 10:01:59][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'nouveau_client_id_depuis_script' (SUCCESS). Socket FD: 8
[2025-05-02 10:01:59][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: nouveau_client_id_depuis_script...
[2025-05-02 10:01:59][INFO] ClientSession INFO : Initialisation pour client nouveau_client_id_depuis_script
[2025-05-02 10:01:59][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 10:01:59][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 10:01:59][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire '../src/data/wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 10:01:59][WARNING] Wallet Impossible de charger le portefeuille pour client ID: nouveau_client_id_depuis_script. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : ../src/data/wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 10:01:59][DEBUG] Wallet Objet Wallet créé pour client ID: nouveau_client_id_depuis_script. Chemin du fichier: ../src/data/wallets/nouveau_client_id_depuis_script.wallet
[2025-05-02 10:01:59][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'nouveau_client_id_depuis_script'. Socket FD: 8
[2025-05-02 10:01:59][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 10:01:59][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: nouveau_client_id_depuis_script. Total sessions actives: 1.
[2025-05-02 10:01:59][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 10:01:59][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: nouveau_client_id_depuis_script
[2025-05-02 10:01:59][INFO] Server::HandleClient INFO : ClientSession pour client ID: nouveau_client_id_depuis_script enregistrée auprès de la TransactionQueue.
[2025-05-02 10:01:59][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 10:01:59][INFO] ClientSession INFO : Démarrage du thread de session pour client nouveau_client_id_depuis_script
[2025-05-02 10:01:59][INFO] ClientSession INFO : Thread de session démarré et joignable pour client nouveau_client_id_depuis_script
[2025-05-02 10:01:59][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: nouveau_client_id_depuis_script. Le thread HandleClient va se terminer normalement.
[2025-05-02 10:01:59][INFO] ClientSession INFO : Thread de session démarré pour client nouveau_client_id_depuis_script
[2025-05-02 10:02:07][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 10:02:07][INFO] ClientSession
[2025-05-02 10:02:08][INFO] Global Nouveau prix SRD-BTC simulé : 96205.2448337502
[2025-05-02 10:02:16][DEBUG] OpenSSL Callback: SSL3 alert read:warning:close notify
[2025-05-02 10:02:16][INFO] ServerConnection::receive INFO : Connexion fermée proprement par le pair (SSL_ERROR_ZERO_RETURN). Socket FD: 8
[2025-05-02 10:02:16][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 8
[2025-05-02 10:02:16][INFO] ClientSession INFO : Déconnexion propre détectée pour client nouveau_client_id_depuis_script. Socket FD: 8
[2025-05-02 10:02:16][INFO] ClientSession INFO : Sortie de la boucle de session pour client nouveau_client_id_depuis_script. Raison: running=0, client_connected=0
[2025-05-02 10:02:23][INFO] Global Nouveau prix SRD-BTC simulé : 98554.3023233844
[2025-05-02 10:02:38][INFO] Global Nouveau prix SRD-BTC simulé : 98287.8975511258
--- Début du log : 1746172987 ---
[2025-05-02 10:03:07][DEBUG] TransactionQueue créée.
[2025-05-02 10:03:07][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 10:03:07][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 10:03:07][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 10:03:07][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 10:03:07][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 10:03:07][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 10:03:07][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 10:03:07][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 10:03:07][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 10:03:07][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 10:03:07][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 10:03:07][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 10:03:07][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 10:03:07][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 2 entrées chargées depuis users.txt
[2025-05-02 10:03:07][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 10:03:07][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 10:03:07][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 10:03:07][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 10:03:07][INFO] Global Thread de génération de prix initié.
[2025-05-02 10:03:07][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 10:03:07][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 10:03:07][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 10:03:07][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 10:03:07][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 10:03:07][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 10:03:07][INFO] Global Thread de génération de prix démarré.
[2025-05-02 10:03:07][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 10:03:07][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 10:03:07][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 10:03:07][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 10:03:07][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 10:03:07][INFO] Global Nouveau prix SRD-BTC simulé : 98259.9095760781
[2025-05-02 10:03:13][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 6, IP: 10.188.240.101
[2025-05-02 10:03:13][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 6
[2025-05-02 10:03:13][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 6
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:03:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:03:13][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 10:03:13][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 10:03:13][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 10:03:13][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 6
[2025-05-02 10:03:13][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 6
[2025-05-02 10:03:13][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 6
[2025-05-02 10:03:13][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (6) et SSL existants.
[2025-05-02 10:03:13][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 6
[2025-05-02 10:03:13][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 10:03:13][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 10:03:13][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 6
[2025-05-02 10:03:13][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 6 : 'ID:Client1,TOKEN:Token1
'
[2025-05-02 10:03:13][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 6
[2025-05-02 10:03:13][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 10:03:13][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 10:03:13][DEBUG] Server::processAuthRequest DEBUG : ID non trouvé : 'Client1'. Tentative d'enregistrement...
[2025-05-02 10:03:13][WARNING] SecurityUtils WARNING : HashPasswordSecure est un placeholder. REMPLACER PAR UN VRAI HACHAGE SECURISÉ (bcrypt, Argon2) !
[2025-05-02 10:03:13][DEBUG] Server::processAuthRequest DEBUG : Nouvel utilisateur 'Client1' ajouté à map en mémoire.
[2025-05-02 10:03:13][INFO] Server::SaveUsersInternal INFO : Sauvegarde de 3 utilisateurs dans users.txt
[2025-05-02 10:03:13][INFO] Server::processAuthRequest INFO : Liste utilisateurs sauvegardée sur disque après ajout ID: 'Client1'.
[2025-05-02 10:03:13][DEBUG] Server::CreateWalletFile DEBUG : Tentative création fichier portefeuille: ../src/data/wallets//Client1.wallet
[2025-05-02 10:03:13][WARNING] Server::CreateWalletFile WARNING : std::filesystem::create_directories retourné false mais ec non set. État inconnu répertoire.
[2025-05-02 10:03:13][DEBUG] Server::CreateWalletFile DEBUG : Fichier portefeuille ouvert/créé : ../src/data/wallets//Client1.wallet
[2025-05-02 10:03:13][INFO] Server::CreateWalletFile INFO : Fichier portefeuille vierge créé et initialisé : ../src/data/wallets//Client1.wallet
[2025-05-02 10:03:13][INFO] Server::processAuthRequest INFO : Fichier portefeuille créé avec succès pour ID: 'Client1'.
[2025-05-02 10:03:13][INFO] Server::processAuthRequest INFO : Enregistrement nouvel utilisateur 'Client1' réussi.
[2025-05-02 10:03:13][INFO] ClientAuthenticator::AuthenticateClient INFO : Enregistrement nouvel utilisateur et authentification réussie pour ID: 'Client1'. Envoi réponse AUTH NEW au client.
[2025-05-02 10:03:13][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (NEW). Socket FD: 6
[2025-05-02 10:03:13][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1...
[2025-05-02 10:03:13][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 10:03:13][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 10:03:13][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 10:03:13][ERROR] Wallet::ensureWalletsDirectoryExists ERROR: Impossible de créer/vérifier répertoire '../src/data/wallets'. Raison (errno): Success. Comportement create_directories inhabituel (ec vide).
[2025-05-02 10:03:13][WARNING] Wallet Impossible de charger le portefeuille pour client ID: Client1. Un nouveau portefeuille vierge sera utilisé. Chemin cherché : ../src/data/wallets/Client1.wallet
[2025-05-02 10:03:13][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 10:03:13][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'Client1'. Socket FD: 6
[2025-05-02 10:03:13][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 10:03:13][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 10:03:13][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 10:03:13][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 10:03:13][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 10:03:13][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 10:03:13][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 10:03:13][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 10:03:13][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 10:03:13][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 10:03:17][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 10:03:17][INFO] ClientSession
[2025-05-02 10:03:22][INFO] Global Nouveau prix SRD-BTC simulé : 96828.3569121330
--- Début du log : 1746174447 ---
[2025-05-02 10:27:27][DEBUG] TransactionQueue créée.
[2025-05-02 10:27:27][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 10:27:27][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 10:27:27][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 10:27:27][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 10:27:27][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 10:27:27][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 10:27:27][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 10:27:27][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 10:27:27][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 10:27:27][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 10:27:27][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 10:27:27][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 10:27:27][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 10:27:27][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 10:27:27][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 10:27:27][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 10:27:27][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 10:27:27][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 10:27:27][INFO] Global Thread de génération de prix initié.
[2025-05-02 10:27:27][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 10:27:27][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 10:27:27][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 10:27:27][INFO] Global Thread de génération de prix démarré.
[2025-05-02 10:27:27][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 10:27:27][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 10:27:27][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 10:27:27][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 10:27:27][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 10:27:27][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 10:27:27][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 10:27:27][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 10:27:27][INFO] Global Nouveau prix SRD-BTC simulé : 95126.0297224921
[2025-05-02 10:27:31][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 10:27:31][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 10:27:31][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:27:31][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:27:31][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 10:27:31][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 10:27:31][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 10:27:31][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 10:27:31][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 10:27:31][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 10:27:31][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 10:27:31][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 10:27:31][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 10:27:31][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 10:27:31][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 10:27:31][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:Client1,TOKEN:Token1
'
[2025-05-02 10:27:31][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 10:27:31][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 10:27:31][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 10:27:31][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 10:27:31][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 10:27:31][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 10:27:31][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'Client1'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 10:27:31][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 10
[2025-05-02 10:27:31][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1...
[2025-05-02 10:27:31][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 10:27:31][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 10:27:31][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 10:27:31][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 10:27:31][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 10:27:31][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 10:27:31][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 10:27:31][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 10:27:31][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 10:27:31][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 10:27:31][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'Client1'. Socket FD: 10
[2025-05-02 10:27:31][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 10:27:31][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 10:27:31][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 10:27:31][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 10:27:31][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 10:27:31][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 10:27:31][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 10:27:31][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 10:27:31][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 10:27:31][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 10:27:37][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 10:27:37][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW'
[2025-05-02 10:27:37][WARNING] ClientSession WARNING : Cible inconnue pour SHOW reçue pour client Client1 : 'SHOW'
[2025-05-02 10:27:37][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: ERROR: Unknown SHOW target. Use SHOW WALLET or SHOW TRANSACTIONS.
...
[2025-05-02 10:27:37][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW'
[2025-05-02 10:27:42][INFO] Global Nouveau prix SRD-BTC simulé : 98462.6472854132
[2025-05-02 10:27:44][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 10:27:44][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 10:27:44][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 10:27:44][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: BALANCE USD: 10000.0000000000, SRD-BTC: 0.0000000000
...
[2025-05-02 10:27:44][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 10:27:54][DEBUG] OpenSSL Callback: SSL3 alert read:warning:close notify
[2025-05-02 10:27:54][INFO] ServerConnection::receive INFO : Connexion fermée proprement par le pair (SSL_ERROR_ZERO_RETURN). Socket FD: 10
[2025-05-02 10:27:54][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 10
[2025-05-02 10:27:54][INFO] ClientSession INFO : Déconnexion propre détectée pour client Client1. Socket FD: 10
[2025-05-02 10:27:54][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=0
[2025-05-02 10:27:57][INFO] Global Nouveau prix SRD-BTC simulé : 95169.8323085469
[2025-05-02 10:28:01][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 9, IP: 10.188.240.101
[2025-05-02 10:28:01][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 9
[2025-05-02 10:28:01][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 9
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:28:01][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 10:28:01][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 9
[2025-05-02 10:28:01][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 9
[2025-05-02 10:28:01][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 9
[2025-05-02 10:28:01][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 9
[2025-05-02 10:28:01][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 9
[2025-05-02 10:28:01][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (9) et SSL existants.
[2025-05-02 10:28:01][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 9
[2025-05-02 10:28:01][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 10:28:01][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 10:28:01][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 9
[2025-05-02 10:28:01][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 9 : 'ID:Client1,TOKEN:Token1
'
[2025-05-02 10:28:01][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 9
[2025-05-02 10:28:01][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 10:28:01][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 10:28:01][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 10:28:01][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 10:28:01][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 10:28:01][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'Client1'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 10:28:01][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 9
[2025-05-02 10:28:01][WARNING] Server::HandleClient WARNING : Connexion refusée. Une session pour client ID: 'Client1' est déjà active. Socket FD: 9
[2025-05-02 10:28:01][INFO] ServerConnection::closeConnection INFO : Fermeture de la connexion pour socket FD: 9
[2025-05-02 10:28:01][DEBUG] OpenSSL Callback: SSL3 alert write:warning:close notify
[2025-05-02 10:28:01][DEBUG] ServerConnection::closeConnection DEBUG : SSL_shutdown étape 1/2 terminée. Tentative étape 2 (peut bloquer).
[2025-05-02 10:28:01][DEBUG] ServerConnection::closeConnection DEBUG : Objet SSL libéré.
[2025-05-02 10:28:01][DEBUG] ServerConnection::closeConnection DEBUG : Fermeture du socket FD: 9
[2025-05-02 10:28:01][INFO] ServerConnection::closeConnection INFO : Socket FD: 9 fermé.
[2025-05-02 10:28:01][DEBUG] ServerConnection::closeConnection DEBUG : Nettoyage de connexion terminé.
[2025-05-02 10:28:01][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur appelé. Socket FD final: -1
[2025-05-02 10:28:01][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur terminé.
[2025-05-02 10:28:12][INFO] Global Nouveau prix SRD-BTC simulé : 94181.7719231395
[2025-05-02 10:28:27][INFO] Global Nouveau prix SRD-BTC simulé : 95632.7750709708
[2025-05-02 10:28:42][INFO] Global Nouveau prix SRD-BTC simulé : 96492.0326574989
[2025-05-02 10:28:57][INFO] Global Nouveau prix SRD-BTC simulé : 96315.3645687492
[2025-05-02 10:29:12][INFO] Global Nouveau prix SRD-BTC simulé : 93301.6683005441
[2025-05-02 10:29:27][INFO] Global Nouveau prix SRD-BTC simulé : 97161.9727139078
--- Début du log : 1746175993 ---
[2025-05-02 10:53:13][DEBUG] TransactionQueue créée.
[2025-05-02 10:53:13][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 10:53:13][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 10:53:13][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 10:53:13][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 10:53:13][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 10:53:13][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 10:53:13][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 10:53:13][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 10:53:13][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 10:53:13][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 10:53:13][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 10:53:13][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 10:53:13][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 10:53:13][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 10:53:13][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 10:53:13][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 10:53:13][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 10:53:13][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 10:53:13][INFO] Global Thread de génération de prix initié.
[2025-05-02 10:53:13][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 10:53:13][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 10:53:13][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 10:53:13][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 10:53:13][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 10:53:13][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 10:53:13][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 10:53:13][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 10:53:13][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 10:53:13][INFO] Global Thread de génération de prix démarré.
[2025-05-02 10:53:13][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 10:53:13][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 10:53:13][INFO] Global Nouveau prix SRD-BTC simulé : 97125.0951682292
[2025-05-02 10:53:17][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 5, IP: 10.188.240.101
[2025-05-02 10:53:17][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 5
[2025-05-02 10:53:17][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 5
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:53:17][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:53:17][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 10:53:17][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 10:53:17][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 10:53:17][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 5
[2025-05-02 10:53:17][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 5
[2025-05-02 10:53:17][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 5
[2025-05-02 10:53:17][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (5) et SSL existants.
[2025-05-02 10:53:17][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 5
[2025-05-02 10:53:17][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 10:53:17][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 10:53:17][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 5
[2025-05-02 10:53:17][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 5 : 'ID:Client1,TOKEN:Token1
'
[2025-05-02 10:53:17][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 5
[2025-05-02 10:53:17][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 10:53:17][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 10:53:17][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 10:53:17][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 10:53:17][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 10:53:17][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'Client1'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 10:53:17][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 5
[2025-05-02 10:53:17][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1...
[2025-05-02 10:53:17][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 10:53:17][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 10:53:17][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 10:53:17][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 10:53:17][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 10:53:17][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 10:53:17][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 10:53:17][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 10:53:17][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 10:53:17][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 10:53:17][INFO] Server::HandleClient INFO : Objet ClientSession créé pour Client ID: 'Client1'. Socket FD: 5
[2025-05-02 10:53:17][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 10:53:17][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 10:53:17][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 10:53:17][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 10:53:17][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 10:53:17][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 10:53:17][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 10:53:17][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 10:53:17][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 10:53:17][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 10:53:20][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 10:53:20][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 10:53:20][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 10:53:20][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: BALANCE USD: 10000.0000000000, SRD-BTC: 0.0000000000
...
[2025-05-02 10:53:20][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 10:53:23][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 10:53:23][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'QUIT'
[2025-05-02 10:53:23][INFO] ClientSession INFO : Commande QUIT reçue pour client Client1. Signalement de l'arrêt de la session.
[2025-05-02 10:53:23][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: OK: Disconnecting.
...
[2025-05-02 10:53:23][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'QUIT'
[2025-05-02 10:53:23][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=1
[2025-05-02 10:53:25][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 10:53:25][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 10:53:25][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 10:53:25][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 10:53:25][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 10:53:25][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 10:53:25][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 10:53:25][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 10:53:25][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 10:53:25][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 10:53:25][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 10:53:25][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 10:53:25][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 10:53:25][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 10:53:25][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:Client1,TOKEN:Token1
'
[2025-05-02 10:53:25][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 10:53:25][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 10:53:25][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 10:53:25][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 10:53:25][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 10:53:25][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 10:53:25][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'Client1'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 10:53:25][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 10
[2025-05-02 10:53:25][WARNING] Server::HandleClient WARNING : Connexion refusée. Une session pour client ID: 'Client1' est déjà active. Socket FD: 10
[2025-05-02 10:53:25][INFO] ServerConnection::closeConnection INFO : Fermeture de la connexion pour socket FD: 10
[2025-05-02 10:53:25][DEBUG] OpenSSL Callback: SSL3 alert write:warning:close notify
[2025-05-02 10:53:25][DEBUG] ServerConnection::closeConnection DEBUG : SSL_shutdown étape 1/2 terminée. Tentative étape 2 (peut bloquer).
[2025-05-02 10:53:25][DEBUG] ServerConnection::closeConnection DEBUG : Objet SSL libéré.
[2025-05-02 10:53:25][DEBUG] ServerConnection::closeConnection DEBUG : Fermeture du socket FD: 10
[2025-05-02 10:53:25][INFO] ServerConnection::closeConnection INFO : Socket FD: 10 fermé.
[2025-05-02 10:53:25][DEBUG] ServerConnection::closeConnection DEBUG : Nettoyage de connexion terminé.
[2025-05-02 10:53:25][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur appelé. Socket FD final: -1
[2025-05-02 10:53:25][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur terminé.
[2025-05-02 10:53:28][INFO] Global Nouveau prix SRD-BTC simulé : 97717.0453720345
[2025-05-02 10:53:43][INFO] Global Nouveau prix SRD-BTC simulé : 96755.6175855985
[2025-05-02 10:53:58][INFO] Global Nouveau prix SRD-BTC simulé : 98388.4599433580
[2025-05-02 10:54:13][INFO] Global Nouveau prix SRD-BTC simulé : 96887.1203192451
[2025-05-02 10:54:28][INFO] Global Nouveau prix SRD-BTC simulé : 96136.9923121665
[2025-05-02 10:54:43][INFO] Global Nouveau prix SRD-BTC simulé : 98580.9969449539
[2025-05-02 10:54:58][INFO] Global Nouveau prix SRD-BTC simulé : 96726.2882519401
[2025-05-02 10:55:13][INFO] Global Nouveau prix SRD-BTC simulé : 98746.6071023339
[2025-05-02 10:55:28][INFO] Global Nouveau prix SRD-BTC simulé : 96229.3847364575
[2025-05-02 10:55:43][INFO] Global Nouveau prix SRD-BTC simulé : 97224.6179054184
[2025-05-02 10:55:58][INFO] Global Nouveau prix SRD-BTC simulé : 94376.0128099685
[2025-05-02 10:56:13][INFO] Global Nouveau prix SRD-BTC simulé : 96979.6018549033
[2025-05-02 10:56:28][INFO] Global Nouveau prix SRD-BTC simulé : 97627.7427491624
[2025-05-02 10:56:43][INFO] Global Nouveau prix SRD-BTC simulé : 95251.4725516649
[2025-05-02 10:56:58][INFO] Global Nouveau prix SRD-BTC simulé : 97233.5655092653
[2025-05-02 10:57:14][INFO] Global Nouveau prix SRD-BTC simulé : 97131.8490505442
[2025-05-02 10:57:29][INFO] Global Nouveau prix SRD-BTC simulé : 97765.7169989329
[2025-05-02 10:57:44][INFO] Global Nouveau prix SRD-BTC simulé : 96260.8224604818
[2025-05-02 10:57:59][INFO] Global Nouveau prix SRD-BTC simulé : 94773.9613391654
--- Début du log : 1746176587 ---
[2025-05-02 11:03:07][DEBUG] TransactionQueue créée.
[2025-05-02 11:03:07][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 11:03:07][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 11:03:07][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 11:03:07][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 11:03:07][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 11:03:07][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 11:03:07][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 11:03:07][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 11:03:07][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 11:03:07][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 11:03:07][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 11:03:07][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 11:03:07][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 11:03:07][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 11:03:07][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 11:03:07][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 11:03:07][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 11:03:07][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 11:03:07][INFO] Global Thread de génération de prix initié.
[2025-05-02 11:03:07][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 11:03:07][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 11:03:07][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 11:03:07][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 11:03:07][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 11:03:07][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 11:03:07][INFO] Global Thread de génération de prix démarré.
[2025-05-02 11:03:07][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 11:03:07][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 11:03:07][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 11:03:07][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 11:03:07][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 11:03:07][INFO] Global Nouveau prix SRD-BTC simulé : 95083.2230802753
[2025-05-02 11:03:12][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 6, IP: 10.188.240.101
[2025-05-02 11:03:12][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 6
[2025-05-02 11:03:12][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 6
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:03:12][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:03:12][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 11:03:12][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 11:03:12][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 11:03:12][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 6
[2025-05-02 11:03:12][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 6
[2025-05-02 11:03:12][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 6
[2025-05-02 11:03:12][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (6) et SSL existants.
[2025-05-02 11:03:12][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 6
[2025-05-02 11:03:12][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 11:03:12][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 11:03:12][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 6
[2025-05-02 11:03:12][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 6 : 'ID:Client1,TOKEN:Token1
'
[2025-05-02 11:03:12][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 6
[2025-05-02 11:03:12][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 11:03:12][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 11:03:12][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 11:03:12][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 11:03:12][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 11:03:12][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'Client1'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 11:03:12][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 6
[2025-05-02 11:03:12][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 11:03:12][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 11:03:12][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 11:03:12][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 11:03:12][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 11:03:12][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 11:03:12][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 11:03:12][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 11:03:12][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 11:03:12][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 11:03:12][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 11:03:12][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 11:03:12][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 11:03:12][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 11:03:12][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 11:03:12][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 11:03:12][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 11:03:12][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 11:03:12][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 11:03:12][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 11:03:12][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 11:03:12][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 11:03:12][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 11:03:12][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 11:03:12][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 11:03:12][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 11:03:16][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 11:03:16][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 11:03:16][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 11:03:16][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: BALANCE USD: 10000.0000000000, SRD-BTC: 0.0000000000
...
[2025-05-02 11:03:16][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 11:03:22][INFO] Global Nouveau prix SRD-BTC simulé : 95714.3487220941
[2025-05-02 11:03:32][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 11:03:32][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 11:03:32][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 11:03:32][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: BALANCE USD: 10000.0000000000, SRD-BTC: 0.0000000000
...
[2025-05-02 11:03:32][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 11:03:37][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 11:03:37][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'QUIT'
[2025-05-02 11:03:37][INFO] ClientSession INFO : Commande QUIT reçue pour client Client1. Signalement de l'arrêt de la session.
[2025-05-02 11:03:37][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: OK: Disconnecting.
...
[2025-05-02 11:03:37][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'QUIT'
[2025-05-02 11:03:37][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=1
[2025-05-02 11:03:38][INFO] Global Nouveau prix SRD-BTC simulé : 99835.6673302064
[2025-05-02 11:03:39][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 11:03:39][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 11:03:39][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:03:39][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 11:03:39][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 11:03:39][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 11:03:39][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 11:03:39][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 11:03:39][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 11:03:39][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 11:03:39][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 11:03:39][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 11:03:39][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 11:03:39][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 11:03:39][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:Client1,TOKEN:Token1
'
[2025-05-02 11:03:39][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 11:03:39][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 11:03:39][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 11:03:39][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 11:03:39][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 11:03:39][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 11:03:39][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification réussie (utilisateur existant) pour ID: 'Client1'. Envoi réponse AUTH SUCCESS au client.
[2025-05-02 11:03:39][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 10
[2025-05-02 11:03:39][WARNING] Server::HandleClient WARNING : Connexion refusée. Une session pour client ID: 'Client1' est déjà active. Socket FD: 10
[2025-05-02 11:03:39][INFO] ServerConnection::closeConnection INFO : Fermeture de la connexion pour socket FD: 10
[2025-05-02 11:03:39][DEBUG] OpenSSL Callback: SSL3 alert write:warning:close notify
[2025-05-02 11:03:39][DEBUG] ServerConnection::closeConnection DEBUG : SSL_shutdown étape 1/2 terminée. Tentative étape 2 (peut bloquer).
[2025-05-02 11:03:39][DEBUG] ServerConnection::closeConnection DEBUG : Objet SSL libéré.
[2025-05-02 11:03:39][DEBUG] ServerConnection::closeConnection DEBUG : Fermeture du socket FD: 10
[2025-05-02 11:03:39][INFO] ServerConnection::closeConnection INFO : Socket FD: 10 fermé.
[2025-05-02 11:03:39][DEBUG] ServerConnection::closeConnection DEBUG : Nettoyage de connexion terminé.
[2025-05-02 11:03:39][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur appelé. Socket FD final: -1
[2025-05-02 11:03:39][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur terminé.
[2025-05-02 11:03:53][INFO] Global Nouveau prix SRD-BTC simulé : 96270.7348896791
--- Début du log : 1746177427 ---
[2025-05-02 11:17:07][DEBUG] TransactionQueue créée.
[2025-05-02 11:17:07][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 11:17:07][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 11:17:07][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 11:17:07][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 11:17:07][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 11:17:07][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 11:17:07][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 11:17:07][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 11:17:07][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 11:17:07][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 11:17:07][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 11:17:07][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 11:17:07][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 11:17:07][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 11:17:07][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 11:17:07][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 11:17:07][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 11:17:07][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 11:17:07][INFO] Global Thread de génération de prix initié.
[2025-05-02 11:17:07][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 11:17:07][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 11:17:07][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 11:17:07][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 11:17:07][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 11:17:07][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 11:17:07][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 11:17:07][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 11:17:07][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 11:17:07][INFO] Global Thread de génération de prix démarré.
[2025-05-02 11:17:07][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 11:17:07][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 11:17:07][INFO] Global Nouveau prix SRD-BTC simulé : 97069.4962418221
[2025-05-02 11:17:13][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 6, IP: 10.188.240.101
[2025-05-02 11:17:13][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 6
[2025-05-02 11:17:13][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 6
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:17:13][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:17:13][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 11:17:13][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 11:17:13][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 11:17:13][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 6
[2025-05-02 11:17:13][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 6
[2025-05-02 11:17:13][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 6
[2025-05-02 11:17:13][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (6) et SSL existants.
[2025-05-02 11:17:13][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 6
[2025-05-02 11:17:13][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 11:17:13][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 11:17:13][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 6
[2025-05-02 11:17:13][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 6. Buffer accumulation size: 24
[2025-05-02 11:17:13][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 6. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 11:17:13][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 6 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 11:17:13][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 6
[2025-05-02 11:17:13][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 11:17:13][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 11:17:13][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 11:17:13][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 11:17:13][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 11:17:13][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 6
[2025-05-02 11:17:13][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 6
[2025-05-02 11:17:13][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 11:17:13][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 11:17:13][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 11:17:13][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 11:17:13][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 11:17:13][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 11:17:13][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 11:17:13][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 11:17:13][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 11:17:13][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 11:17:13][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 11:17:13][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 11:17:13][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 11:17:13][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 11:17:13][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 11:17:13][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 11:17:13][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 11:17:13][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 11:17:13][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 11:17:13][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 11:17:13][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 11:17:13][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 11:17:13][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 11:17:13][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 11:17:13][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 11:17:13][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 11:17:22][INFO] Global Nouveau prix SRD-BTC simulé : 99456.3749390404
[2025-05-02 11:17:27][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 11:17:27][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 11:17:27][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 11:17:27][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: BALANCE USD: 10000.0000000000, SRD-BTC: 0.0000000000
...
[2025-05-02 11:17:27][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 11:17:30][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 11:17:30][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'QUIT'
[2025-05-02 11:17:30][INFO] ClientSession INFO : Commande QUIT reçue pour client Client1. Signalement de l'arrêt de la session.
[2025-05-02 11:17:30][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: OK: Disconnecting.
...
[2025-05-02 11:17:30][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'QUIT'
[2025-05-02 11:17:30][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=1
[2025-05-02 11:17:34][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 11:17:34][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 11:17:34][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:17:34][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 11:17:34][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 11:17:34][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 11:17:34][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 11:17:34][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 11:17:34][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 11:17:34][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 11:17:34][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 11:17:34][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 11:17:34][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 11:17:34][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 11:17:34][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 10. Buffer accumulation size: 24
[2025-05-02 11:17:34][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 10. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 11:17:34][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 11:17:34][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 11:17:34][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 11:17:34][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 11:17:34][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 11:17:34][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 11:17:34][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 11:17:34][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 10
[2025-05-02 11:17:34][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 10
[2025-05-02 11:17:34][WARNING] Server::HandleClient WARNING : Connexion refusée. Une session pour client ID: 'Client1' est déjà active. Socket FD: 10
[2025-05-02 11:17:34][INFO] ServerConnection::closeConnection INFO : Fermeture de la connexion pour socket FD: 10
[2025-05-02 11:17:34][DEBUG] OpenSSL Callback: SSL3 alert write:warning:close notify
[2025-05-02 11:17:34][DEBUG] ServerConnection::closeConnection DEBUG : SSL_shutdown étape 1/2 terminée. Tentative étape 2 (peut bloquer).
[2025-05-02 11:17:34][DEBUG] ServerConnection::closeConnection DEBUG : Objet SSL libéré.
[2025-05-02 11:17:34][DEBUG] ServerConnection::closeConnection DEBUG : Fermeture du socket FD: 10
[2025-05-02 11:17:34][INFO] ServerConnection::closeConnection INFO : Socket FD: 10 fermé.
[2025-05-02 11:17:34][DEBUG] ServerConnection::closeConnection DEBUG : Nettoyage de connexion terminé.
[2025-05-02 11:17:34][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur appelé. Socket FD final: -1
[2025-05-02 11:17:34][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur terminé.
[2025-05-02 11:17:37][INFO] Global Nouveau prix SRD-BTC simulé : 95822.4928977401
[2025-05-02 11:17:41][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 11, IP: 10.188.240.101
[2025-05-02 11:17:41][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 11
[2025-05-02 11:17:41][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 11
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:17:41][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 11:17:41][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 11:17:41][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 11:17:41][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 11
[2025-05-02 11:17:41][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 11
[2025-05-02 11:17:41][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 11
[2025-05-02 11:17:41][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (11) et SSL existants.
[2025-05-02 11:17:41][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 11
[2025-05-02 11:17:41][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 11:17:41][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 11:17:41][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 11
[2025-05-02 11:17:41][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 11. Buffer accumulation size: 24
[2025-05-02 11:17:41][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 11. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 11:17:41][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 11 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 11:17:41][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 11
[2025-05-02 11:17:41][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 11:17:41][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 11:17:41][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 11:17:41][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 11:17:41][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 11:17:41][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 11
[2025-05-02 11:17:41][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 11
[2025-05-02 11:17:41][WARNING] Server::HandleClient WARNING : Connexion refusée. Une session pour client ID: 'Client1' est déjà active. Socket FD: 11
[2025-05-02 11:17:41][INFO] ServerConnection::closeConnection INFO : Fermeture de la connexion pour socket FD: 11
[2025-05-02 11:17:41][DEBUG] OpenSSL Callback: SSL3 alert write:warning:close notify
[2025-05-02 11:17:41][DEBUG] ServerConnection::closeConnection DEBUG : SSL_shutdown étape 1/2 terminée. Tentative étape 2 (peut bloquer).
[2025-05-02 11:17:41][DEBUG] ServerConnection::closeConnection DEBUG : Objet SSL libéré.
[2025-05-02 11:17:41][DEBUG] ServerConnection::closeConnection DEBUG : Fermeture du socket FD: 11
[2025-05-02 11:17:41][INFO] ServerConnection::closeConnection INFO : Socket FD: 11 fermé.
[2025-05-02 11:17:41][DEBUG] ServerConnection::closeConnection DEBUG : Nettoyage de connexion terminé.
[2025-05-02 11:17:41][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur appelé. Socket FD final: -1
[2025-05-02 11:17:41][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur terminé.
[2025-05-02 11:17:52][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 11:17:52][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 11:17:52][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:17:52][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 11:17:52][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 11:17:52][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 11:17:52][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 11:17:52][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 11:17:52][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 11:17:52][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 11:17:52][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 11:17:52][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 11:17:52][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 11:17:52][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 11:17:52][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 10. Buffer accumulation size: 24
[2025-05-02 11:17:52][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 10. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 11:17:52][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 11:17:52][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 11:17:52][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 11:17:52][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 11:17:52][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 11:17:52][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 11:17:52][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 11:17:52][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 10
[2025-05-02 11:17:52][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 10
[2025-05-02 11:17:52][WARNING] Server::HandleClient WARNING : Connexion refusée. Une session pour client ID: 'Client1' est déjà active. Socket FD: 10
[2025-05-02 11:17:52][INFO] ServerConnection::closeConnection INFO : Fermeture de la connexion pour socket FD: 10
[2025-05-02 11:17:52][DEBUG] OpenSSL Callback: SSL3 alert write:warning:close notify
[2025-05-02 11:17:52][DEBUG] ServerConnection::closeConnection DEBUG : SSL_shutdown étape 1/2 terminée. Tentative étape 2 (peut bloquer).
[2025-05-02 11:17:52][DEBUG] ServerConnection::closeConnection DEBUG : Objet SSL libéré.
[2025-05-02 11:17:52][DEBUG] ServerConnection::closeConnection DEBUG : Fermeture du socket FD: 10
[2025-05-02 11:17:52][INFO] ServerConnection::closeConnection INFO : Socket FD: 10 fermé.
[2025-05-02 11:17:52][DEBUG] ServerConnection::closeConnection DEBUG : Nettoyage de connexion terminé.
[2025-05-02 11:17:52][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur appelé. Socket FD final: -1
[2025-05-02 11:17:52][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur terminé.
[2025-05-02 11:17:52][INFO] Global Nouveau prix SRD-BTC simulé : 95183.3124171478
--- Début du log : 1746177635 ---
[2025-05-02 11:20:35][DEBUG] TransactionQueue créée.
[2025-05-02 11:20:35][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 11:20:35][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 11:20:35][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 11:20:35][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 11:20:35][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 11:20:35][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 11:20:35][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 11:20:35][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 11:20:35][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 11:20:35][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 11:20:35][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 11:20:35][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 11:20:35][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 11:20:35][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 11:20:35][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 11:20:35][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 11:20:35][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 11:20:35][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 11:20:35][INFO] Global Thread de génération de prix initié.
[2025-05-02 11:20:35][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 11:20:35][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 11:20:35][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 11:20:35][INFO] Global Thread de génération de prix démarré.
[2025-05-02 11:20:35][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 11:20:35][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 11:20:35][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 11:20:35][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 11:20:35][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 11:20:35][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 11:20:35][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 11:20:35][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 11:20:35][INFO] Global Nouveau prix SRD-BTC simulé : 97608.8641072135
[2025-05-02 11:20:40][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 11:20:40][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 11:20:40][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:20:40][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 11:20:40][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 11:20:40][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 11:20:40][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 11:20:40][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 11:20:40][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 11:20:40][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 11:20:40][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 11:20:40][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 11:20:40][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 11:20:40][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 11:20:40][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 11:20:40][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 10. Buffer accumulation size: 24
[2025-05-02 11:20:40][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 10. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 11:20:40][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 11:20:40][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 11:20:40][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 11:20:40][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 11:20:40][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 11:20:40][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 11:20:40][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 11:20:40][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 10
[2025-05-02 11:20:40][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 10
[2025-05-02 11:20:40][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 11:20:40][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 11:20:40][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 11:20:40][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 11:20:40][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 11:20:40][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 11:20:40][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 11:20:40][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 11:20:40][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 11:20:40][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 11:20:40][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 11:20:40][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 11:20:40][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 11:20:40][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 11:20:40][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 11:20:40][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 11:20:40][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 11:20:40][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 11:20:40][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 11:20:40][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 11:20:40][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 11:20:40][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 11:20:40][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 11:20:40][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 11:20:40][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 11:20:40][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 11:20:44][DEBUG] ClientSession DEBUG : Reçu 10 octets. Buffer d'accumulation: 10 octets.
[2025-05-02 11:20:44][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'GET PRICE'
[2025-05-02 11:20:44][WARNING] ClientSession WARNING : Commande inconnue reçue pour client Client1 : 'GET PRICE'
[2025-05-02 11:20:44][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: ERROR: Unknown command 'GET PRICE'. Use SHOW WALLET, SHOW TRANSACTIONS, GET_PRICE <symbol> or QUIT.
...
[2025-05-02 11:20:44][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'GET PRICE'
[2025-05-02 11:20:50][INFO] Global Nouveau prix SRD-BTC simulé : 98057.8044368996
[2025-05-02 11:20:52][DEBUG] ClientSession DEBUG : Reçu 10 octets. Buffer d'accumulation: 10 octets.
[2025-05-02 11:20:52][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'GET_PRICE'
[2025-05-02 11:20:52][WARNING] ClientSession WARNING : Symbole manquant pour commande GET_PRICE pour client Client1
[2025-05-02 11:20:52][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: ERROR: Missing symbol for GET_PRICE. Use GET_PRICE <symbol>.
...
[2025-05-02 11:20:52][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'GET_PRICE'
[2025-05-02 11:20:55][DEBUG] ClientSession DEBUG : Reçu 9 octets. Buffer d'accumulation: 9 octets.
[2025-05-02 11:20:55][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'GETPRICE'
[2025-05-02 11:20:55][WARNING] ClientSession WARNING : Commande inconnue reçue pour client Client1 : 'GETPRICE'
[2025-05-02 11:20:55][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: ERROR: Unknown command 'GETPRICE'. Use SHOW WALLET, SHOW TRANSACTIONS, GET_PRICE <symbol> or QUIT.
...
[2025-05-02 11:20:55][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'GETPRICE'
[2025-05-02 11:21:05][INFO] Global Nouveau prix SRD-BTC simulé : 96249.3413949136
[2025-05-02 11:21:07][DEBUG] ClientSession DEBUG : Reçu 18 octets. Buffer d'accumulation: 18 octets.
[2025-05-02 11:21:07][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'GET_PRICE SRD-BTC'
[2025-05-02 11:21:07][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: PRICE SRD-BTC 96249.34139491
...
[2025-05-02 11:21:07][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'GET_PRICE SRD-BTC'
[2025-05-02 11:21:20][INFO] Global Nouveau prix SRD-BTC simulé : 97093.6230443623
[2025-05-02 11:21:23][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 11:21:23][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'QUIT'
[2025-05-02 11:21:23][INFO] ClientSession INFO : Commande QUIT reçue pour client Client1. Signalement de l'arrêt de la session.
[2025-05-02 11:21:23][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: OK: Disconnecting.
...
[2025-05-02 11:21:23][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'QUIT'
[2025-05-02 11:21:23][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=1
--- Début du log : 1746187308 ---
[2025-05-02 14:01:48][DEBUG] TransactionQueue créée.
[2025-05-02 14:01:48][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 14:01:48][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 14:01:48][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 14:01:48][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 14:01:48][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 14:01:48][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 14:01:48][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 14:01:48][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 14:01:48][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 14:01:48][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 14:01:48][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 14:01:48][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 14:01:48][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 14:01:48][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 14:01:48][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 14:01:48][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 14:01:48][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 14:01:48][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 14:01:48][INFO] Global Thread de génération de prix initié.
[2025-05-02 14:01:48][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 14:01:48][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 14:01:48][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 14:01:48][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 14:01:48][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 14:01:48][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 14:01:48][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 14:01:48][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 14:01:48][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 14:01:48][INFO] Global Thread de génération de prix démarré.
[2025-05-02 14:01:48][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 14:01:48][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 14:01:48][INFO] Global Nouveau prix SRD-BTC simulé : 95017.0062513967
[2025-05-02 14:01:56][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 5, IP: 10.188.240.101
[2025-05-02 14:01:56][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 5
[2025-05-02 14:01:56][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 5
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 14:01:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 14:01:56][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 14:01:56][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 14:01:56][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 14:01:56][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 5
[2025-05-02 14:01:56][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 5
[2025-05-02 14:01:56][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 5
[2025-05-02 14:01:56][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (5) et SSL existants.
[2025-05-02 14:01:56][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 5
[2025-05-02 14:01:56][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 14:01:56][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 14:01:56][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 5
[2025-05-02 14:01:56][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 5. Buffer accumulation size: 24
[2025-05-02 14:01:56][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 5. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 14:01:56][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 5 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 14:01:56][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 5
[2025-05-02 14:01:56][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 14:01:56][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 14:01:56][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 14:01:56][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 14:01:56][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 14:01:56][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 5
[2025-05-02 14:01:56][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 5
[2025-05-02 14:01:56][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 14:01:56][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 14:01:56][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 14:01:56][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 14:01:56][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 14:01:56][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 14:01:56][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 14:01:56][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 14:01:56][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 14:01:56][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 14:01:56][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 14:01:56][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 14:01:56][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 14:01:56][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 14:01:56][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 14:01:56][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 14:01:56][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 14:01:56][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 14:01:56][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 14:01:56][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 14:01:56][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 14:01:56][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 14:01:56][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 14:01:56][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 14:01:56][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 14:01:56][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 14:02:03][INFO] Global Nouveau prix SRD-BTC simulé : 97750.9745344302
[2025-05-02 14:02:06][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 14:02:06][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 14:02:06][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 14:02:06][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'BALANCE USD: 10000.0000000000, SRD-BTC: 0.0000000000
'
[2025-05-02 14:02:06][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 14:02:12][DEBUG] ClientSession DEBUG : Reçu 17 octets. Buffer d'accumulation: 17 octets.
[2025-05-02 14:02:12][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW TRANSACTION'
[2025-05-02 14:02:12][WARNING] ClientSession WARNING : Cible inconnue pour SHOW reçue pour client Client1 : 'SHOW TRANSACTION'
[2025-05-02 14:02:12][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'ERROR: Unknown SHOW target. Use SHOW WALLET or SHOW TRANSACTIONS.
'
[2025-05-02 14:02:12][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW TRANSACTION'
[2025-05-02 14:02:18][INFO] Global Nouveau prix SRD-BTC simulé : 97858.8558554344
[2025-05-02 14:02:21][DEBUG] ClientSession DEBUG : Reçu 18 octets. Buffer d'accumulation: 18 octets.
[2025-05-02 14:02:21][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW TRANSACTIONS'
[2025-05-02 14:02:21][INFO] ClientSession INFO : Commande SHOW TRANSACTIONS reçue pour client Client1
[2025-05-02 14:02:21][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'TRANSACTION_HISTORY (Total: 0, Showing last 0):
'
[2025-05-02 14:02:21][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW TRANSACTIONS'
[2025-05-02 14:02:33][INFO] Global Nouveau prix SRD-BTC simulé : 98177.3765942046
[2025-05-02 14:02:40][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 14:02:40][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'QUIT'
[2025-05-02 14:02:40][INFO] ClientSession INFO : Commande QUIT reçue pour client Client1. Signalement de l'arrêt de la session.
[2025-05-02 14:02:40][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Disconnecting.
'
[2025-05-02 14:02:40][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'QUIT'
[2025-05-02 14:02:40][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=1
[2025-05-02 14:02:43][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 14:02:43][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 14:02:43][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 14:02:43][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 14:02:43][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 14:02:43][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 14:02:43][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 14:02:43][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 14:02:43][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 14:02:43][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 14:02:43][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 14:02:43][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 14:02:43][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 14:02:43][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 14:02:43][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 10. Buffer accumulation size: 24
[2025-05-02 14:02:43][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 10. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 14:02:43][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 14:02:43][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 14:02:43][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 14:02:43][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 14:02:43][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 14:02:43][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 14:02:43][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 14:02:43][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 10
[2025-05-02 14:02:43][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 10
[2025-05-02 14:02:43][WARNING] Server::HandleClient WARNING : Connexion refusée. Une session pour client ID: 'Client1' est déjà active. Socket FD: 10
[2025-05-02 14:02:43][INFO] ServerConnection::closeConnection INFO : Fermeture de la connexion pour socket FD: 10
[2025-05-02 14:02:43][DEBUG] OpenSSL Callback: SSL3 alert write:warning:close notify
[2025-05-02 14:02:43][DEBUG] ServerConnection::closeConnection DEBUG : SSL_shutdown étape 1/2 terminée. Tentative étape 2 (peut bloquer).
[2025-05-02 14:02:43][DEBUG] ServerConnection::closeConnection DEBUG : Objet SSL libéré.
[2025-05-02 14:02:43][DEBUG] ServerConnection::closeConnection DEBUG : Fermeture du socket FD: 10
[2025-05-02 14:02:43][INFO] ServerConnection::closeConnection INFO : Socket FD: 10 fermé.
[2025-05-02 14:02:43][DEBUG] ServerConnection::closeConnection DEBUG : Nettoyage de connexion terminé.
[2025-05-02 14:02:43][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur appelé. Socket FD final: -1
[2025-05-02 14:02:43][DEBUG] ServerConnection::~ServerConnection DEBUG : Destructeur terminé.
[2025-05-02 14:02:48][INFO] Global Nouveau prix SRD-BTC simulé : 97548.3374413531
--- Début du log : 1746187437 ---
[2025-05-02 14:03:57][DEBUG] TransactionQueue créée.
[2025-05-02 14:03:57][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 14:03:57][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 14:03:57][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 14:03:57][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 14:03:57][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 14:03:57][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 14:03:57][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 14:03:57][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 14:03:57][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 14:03:57][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 14:03:57][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 14:03:57][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 14:03:57][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 14:03:57][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 14:03:57][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 14:03:57][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 14:03:57][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 14:03:57][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 14:03:57][INFO] Global Thread de génération de prix initié.
[2025-05-02 14:03:57][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 14:03:57][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 14:03:57][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 14:03:57][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 14:03:57][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 14:03:57][INFO] Global Thread de génération de prix démarré.
[2025-05-02 14:03:57][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 14:03:57][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 14:03:57][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 14:03:57][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 14:03:57][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 14:03:57][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 14:03:58][INFO] Global Nouveau prix SRD-BTC simulé : 95785.0486090777
[2025-05-02 14:04:04][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 11, IP: 10.188.240.101
[2025-05-02 14:04:04][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 11
[2025-05-02 14:04:04][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 11
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 14:04:04][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 14:04:04][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 14:04:04][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 14:04:04][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 14:04:04][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 11
[2025-05-02 14:04:04][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 11
[2025-05-02 14:04:04][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 11
[2025-05-02 14:04:04][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (11) et SSL existants.
[2025-05-02 14:04:04][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 11
[2025-05-02 14:04:04][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 14:04:04][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 14:04:04][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 11
[2025-05-02 14:04:04][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 11. Buffer accumulation size: 24
[2025-05-02 14:04:04][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 11. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 14:04:04][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 11 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 14:04:04][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 11
[2025-05-02 14:04:04][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 14:04:04][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 14:04:04][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 14:04:04][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 14:04:04][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 14:04:04][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 11
[2025-05-02 14:04:04][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 11
[2025-05-02 14:04:04][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 14:04:04][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 14:04:04][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 14:04:04][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 14:04:04][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 14:04:04][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 14:04:04][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 14:04:04][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 14:04:04][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 14:04:04][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 14:04:04][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 14:04:04][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 14:04:04][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 14:04:04][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 14:04:04][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 14:04:04][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 14:04:04][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 14:04:04][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 14:04:04][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 14:04:04][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 14:04:04][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 14:04:04][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 14:04:04][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 14:04:04][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 14:04:04][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 14:04:04][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 14:04:11][DEBUG] ClientSession DEBUG : Reçu 18 octets. Buffer d'accumulation: 18 octets.
[2025-05-02 14:04:11][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'GET_PRICE SRD-BTC'
[2025-05-02 14:04:11][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'PRICE SRD-BTC 95785.04860908
'
[2025-05-02 14:04:11][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'GET_PRICE SRD-BTC'
[2025-05-02 14:04:13][INFO] Global Nouveau prix SRD-BTC simulé : 95842.5850914446
[2025-05-02 14:04:24][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 14:04:24][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 14:04:24][DEBUG] ClientSession DEBUG : BUY calculé (basé sur prix actuel 95842.585091): utiliser 1000.000000 USD (10.000000%) pour une quantité visée de 0.010434 SRD-BTC.
[2025-05-02 14:04:24][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0104337753. Taille de la queue: 1
[2025-05-02 14:04:24][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1: Client=Client1, Type=BUY, Qty Visée=0.010434 SRD-BTC (basé sur 10.000000% de solde USD)
[2025-05-02 14:04:24][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 10.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 14:04:24][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.010434
[2025-05-02 14:04:24][DEBUG] TransactionQueue::processRequest Début traitement logique pour requête ID client: Client1, Type: BUY, Quantité: 0.010434
[2025-05-02 14:04:24][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 14:04:24][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 14:04:28][INFO] Global Nouveau prix SRD-BTC simulé : 98005.2505979424
[2025-05-02 14:04:37][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 14:04:37][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 14:04:37][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 14:04:43][INFO] Global Nouveau prix SRD-BTC simulé : 96175.6649625310
[2025-05-02 14:04:58][INFO] Global Nouveau prix SRD-BTC simulé : 96506.7916719173
--- Début du log : 1746189142 ---
[2025-05-02 14:32:22][DEBUG] TransactionQueue créée.
[2025-05-02 14:32:22][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 14:32:22][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 14:32:22][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 14:32:22][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 14:32:22][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 14:32:22][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 14:32:22][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 14:32:22][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 14:32:22][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 14:32:22][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 14:32:22][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 14:32:22][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 14:32:22][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 14:32:22][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 14:32:22][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 14:32:22][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 14:32:22][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 14:32:22][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 14:32:22][INFO] Global Thread de génération de prix initié.
[2025-05-02 14:32:22][INFO] Global Thread de génération de prix démarré.
[2025-05-02 14:32:22][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 14:32:22][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 14:32:22][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 14:32:22][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 14:32:22][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 5
[2025-05-02 14:32:22][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 14:32:22][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 14:32:22][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 14:32:22][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 14:32:22][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 14:32:22][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 14:32:22][INFO] Global Nouveau prix SRD-BTC simulé : 95488.8336413992
[2025-05-02 14:32:29][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 14:32:29][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 14:32:29][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 14:32:29][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 14:32:29][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 14:32:29][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 14:32:29][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 14:32:29][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 14:32:29][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 14:32:29][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 14:32:29][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 14:32:29][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 14:32:29][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 14:32:29][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 14:32:29][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 14:32:29][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 10. Buffer accumulation size: 24
[2025-05-02 14:32:29][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 10. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 14:32:29][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 14:32:29][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 14:32:29][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 14:32:29][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 14:32:29][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 14:32:29][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 14:32:29][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 14:32:29][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 10
[2025-05-02 14:32:29][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 10
[2025-05-02 14:32:29][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 14:32:29][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 14:32:29][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 14:32:29][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 14:32:29][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 14:32:29][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 14:32:29][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 14:32:29][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 14:32:29][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 14:32:29][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 14:32:29][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 14:32:29][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 14:32:29][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 14:32:29][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 14:32:29][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 14:32:29][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 14:32:29][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 14:32:29][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 14:32:29][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 14:32:29][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 14:32:29][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 14:32:29][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 14:32:29][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 14:32:29][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 14:32:29][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 14:32:29][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 14:32:36][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 14:32:36][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 14:32:36][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 14:32:36][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'BALANCE USD: 10000.0000000000, SRD-BTC: 0.0000000000
'
[2025-05-02 14:32:36][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 14:32:37][INFO] Global Nouveau prix SRD-BTC simulé : 98002.4906116136
[2025-05-02 14:32:49][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 14:32:49][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 14:32:49][DEBUG] ClientSession DEBUG : BUY calculé (basé sur prix actuel 98002.490612): utiliser 1000.000000 USD (10.000000%) pour une quantité visée de 0.010204 SRD-BTC.
[2025-05-02 14:32:49][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0102038223. Taille de la queue: 1
[2025-05-02 14:32:49][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1: Client=Client1, Type=BUY, Qty Visée=0.010204 SRD-BTC (basé sur 10.000000% de solde USD)
[2025-05-02 14:32:49][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 10.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 14:32:49][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.010204
[2025-05-02 14:32:49][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 14:32:49][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 14:32:49][DEBUG] TransactionQueue::processRequest Début traitement logique pour requête ID client: Client1, Type: BUY, Quantité: 0.010204
[2025-05-02 14:32:52][INFO] Global Nouveau prix SRD-BTC simulé : 96897.0588458991
[2025-05-02 14:33:07][INFO] Global Nouveau prix SRD-BTC simulé : 96931.0881244683
[2025-05-02 14:33:12][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 14:33:12][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 14:33:12][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
--- Début du log : 1746191872 ---
[2025-05-02 15:17:52][DEBUG] TransactionQueue créée.
[2025-05-02 15:17:52][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 15:17:52][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 15:17:52][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 15:17:52][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 15:17:52][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 15:17:52][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 15:17:52][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 15:17:52][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 15:17:52][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 15:17:52][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 15:17:52][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 15:17:52][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 15:17:52][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 15:17:52][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 15:17:52][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 15:17:52][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 15:17:52][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 15:17:52][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 15:17:52][INFO] Global Thread de génération de prix initié.
[2025-05-02 15:17:52][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 15:17:52][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 15:17:52][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 15:17:52][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 15:17:52][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 15:17:52][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 15:17:52][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 15:17:52][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 15:17:52][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 15:17:52][INFO] Global Thread de génération de prix démarré.
[2025-05-02 15:17:52][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 15:17:52][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 15:17:52][INFO] Global Nouveau prix SRD-BTC simulé : 95289.0574634205
[2025-05-02 15:17:58][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 6, IP: 10.188.240.101
[2025-05-02 15:17:58][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 6
[2025-05-02 15:17:58][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 6
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 15:17:58][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 15:17:58][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 15:17:58][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 15:17:58][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 15:17:58][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 6
[2025-05-02 15:17:58][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 6
[2025-05-02 15:17:58][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 6
[2025-05-02 15:17:58][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (6) et SSL existants.
[2025-05-02 15:17:58][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 6
[2025-05-02 15:17:58][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 15:17:58][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 15:17:58][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 6
[2025-05-02 15:17:58][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 6. Buffer accumulation size: 24
[2025-05-02 15:17:58][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 6. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 15:17:58][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 6 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 15:17:58][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 6
[2025-05-02 15:17:58][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 15:17:58][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 15:17:58][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 15:17:58][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 15:17:58][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 15:17:58][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 6
[2025-05-02 15:17:58][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 6
[2025-05-02 15:17:58][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 15:17:58][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 15:17:58][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 15:17:58][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 15:17:58][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 15:17:58][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 15:17:58][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 15:17:58][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 15:17:58][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 15:17:58][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 15:17:58][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 15:17:58][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 15:17:58][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 15:17:58][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 15:17:58][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 15:17:58][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 15:17:58][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 15:17:58][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 15:17:58][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 15:17:58][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 15:17:58][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 15:17:58][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 15:17:58][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 15:17:58][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 15:17:58][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 15:17:58][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 15:18:03][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 15:18:03][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 15:18:03][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 15:18:03][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'BALANCE USD: 10000.0000000000, SRD-BTC: 0.0000000000
'
[2025-05-02 15:18:03][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 15:18:07][INFO] Global Nouveau prix SRD-BTC simulé : 95461.7540796657
[2025-05-02 15:18:22][INFO] Global Nouveau prix SRD-BTC simulé : 98261.1630004932
[2025-05-02 15:18:37][INFO] Global Nouveau prix SRD-BTC simulé : 96680.3956501210
[2025-05-02 15:18:52][INFO] Global Nouveau prix SRD-BTC simulé : 97383.0835112710
[2025-05-02 15:19:07][INFO] Global Nouveau prix SRD-BTC simulé : 95775.5496084651
[2025-05-02 15:19:13][DEBUG] ClientSession DEBUG : Reçu 14 octets. Buffer d'accumulation: 14 octets.
[2025-05-02 15:19:13][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 1'
[2025-05-02 15:19:13][DEBUG] ClientSession DEBUG : BUY calculé (basé sur prix actuel 95775.549608): utiliser 100.000000 USD (1.000000%) pour une quantité visée de 0.001044 SRD-BTC.
[2025-05-02 15:19:13][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0010441078. Taille de la queue: 1
[2025-05-02 15:19:13][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1: Client=Client1, Type=BUY, Qty Visée=0.001044 SRD-BTC (basé sur 1.000000% de solde USD)
[2025-05-02 15:19:13][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 1.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 15:19:13][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.001044
[2025-05-02 15:19:13][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 15:19:13][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 1'
[2025-05-02 15:19:22][INFO] Global Nouveau prix SRD-BTC simulé : 96601.9021550460
[2025-05-02 15:19:37][INFO] Global Nouveau prix SRD-BTC simulé : 98059.3727870217
[2025-05-02 15:19:42][DEBUG] OpenSSL Callback: SSL3 alert write:fatal:decode error
[2025-05-02 15:19:42][WARNING] ServerConnection::receive WARNING : SSL_read retourné 0. Erreur code: 1. Socket FD: 6
[2025-05-02 15:19:42][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 6
[2025-05-02 15:19:42][INFO] ClientSession INFO : Déconnexion propre détectée pour client Client1. Socket FD: 6
[2025-05-02 15:19:42][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=0
--- Début du log : 1746192435 ---
[2025-05-02 15:27:15][DEBUG] TransactionQueue créée.
[2025-05-02 15:27:15][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 15:27:15][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 15:27:15][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 15:27:15][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 15:27:15][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 15:27:15][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 15:27:15][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 15:27:15][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 15:27:15][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 15:27:15][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 15:27:15][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 15:27:15][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 15:27:15][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 15:27:15][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 15:27:15][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 15:27:15][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 15:27:15][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 15:27:15][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 15:27:15][INFO] Global Thread de génération de prix démarré.
[2025-05-02 15:27:15][INFO] Global Thread de génération de prix initié.
[2025-05-02 15:27:15][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 15:27:15][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 15:27:15][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 15:27:15][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 15:27:15][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 15:27:15][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 7
[2025-05-02 15:27:15][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 15:27:15][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 15:27:15][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 15:27:15][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 15:27:15][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 15:27:15][INFO] Global Nouveau prix SRD-BTC simulé : 98431.3006186487
[2025-05-02 15:27:21][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 11, IP: 10.188.240.101
[2025-05-02 15:27:21][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 11
[2025-05-02 15:27:21][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 11
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 15:27:21][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 15:27:21][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 15:27:21][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 15:27:21][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 15:27:21][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 11
[2025-05-02 15:27:21][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 11
[2025-05-02 15:27:21][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 11
[2025-05-02 15:27:21][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (11) et SSL existants.
[2025-05-02 15:27:21][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 11
[2025-05-02 15:27:21][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 15:27:21][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 15:27:21][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 11
[2025-05-02 15:27:21][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 11. Buffer accumulation size: 24
[2025-05-02 15:27:21][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 11. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 15:27:21][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 11 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 15:27:21][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 11
[2025-05-02 15:27:21][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 15:27:21][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 15:27:21][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 15:27:21][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 15:27:21][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 15:27:21][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 11
[2025-05-02 15:27:21][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 11
[2025-05-02 15:27:21][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 15:27:21][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 15:27:21][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 15:27:21][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 15:27:21][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 15:27:21][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 15:27:21][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 15:27:21][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 15:27:21][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 15:27:21][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 15:27:21][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 15:27:21][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 15:27:21][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 15:27:21][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 15:27:21][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 15:27:21][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 15:27:21][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 15:27:21][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 15:27:21][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 15:27:21][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 15:27:21][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 15:27:21][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 15:27:21][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 15:27:21][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 15:27:21][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 15:27:21][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 15:27:30][INFO] Global Nouveau prix SRD-BTC simulé : 94885.3461164617
[2025-05-02 15:27:31][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 15:27:31][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 15:27:31][DEBUG] ClientSession DEBUG : BUY calculé (basé sur prix actuel 94885.346116): utiliser 1000.000000 USD (10.000000%) pour une quantité visée de 0.010539 SRD-BTC.
[2025-05-02 15:27:31][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0105390352. Taille de la queue: 1
[2025-05-02 15:27:31][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1: Client=Client1, Type=BUY, Qty Visée=0.010539 SRD-BTC (basé sur 10.000000% de solde USD)
[2025-05-02 15:27:31][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 10.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 15:27:31][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.010539
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: --- Entrée de la fonction processRequest ---
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Avant déclarations variables locales
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Après déclarations variables locales
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Avant accès sessionMap
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Tentative verrou sessionMap
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Verrou sessionMap obtenu
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Recherche sessionMap faite
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: session.lock() appelé
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: getClientWallet() appelé
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Accès session/wallet fait
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Verrou sessionMap libéré
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Avant vérification session/wallet null
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Session et Wallet sont valides
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Avant Global::getPrice
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Après Global::getPrice
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Avant bloc verrouillé Wallet
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Tentative verrou Wallet
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Verrou Wallet obtenu
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Logique sous verrou terminée
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Verrou Wallet libéré
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Avant création Transaction finale
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: ID et Timestamp générés
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Construction Transaction finale
[2025-05-02 15:27:31][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 15:27:31][DEBUG] Transaction créée/chargée : ID=T1746192451968497671_1, Client=Client1, Type=BUY, Statut=PENDING
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Transaction finale construite
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Avant logging global
[2025-05-02 15:27:31][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 15:27:31][INFO] Transaction Fichier de log transaction CSV créé avec en-tête: ../src/data/global_transactions.csv
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Après logging global
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Avant notification ClientSession
[2025-05-02 15:27:31][INFO] ClientSession INFO : Notification de TQ reçue pour transaction Client1:T1746192451968497671_1 avec statut PENDING
[2025-05-02 15:27:31][DEBUG] ClientSession DEBUG : Bot non actif pour client Client1. Notification TX T1746192451968497671_1 non passée au bot.
[2025-05-02 15:27:31][INFO] ClientSession INFO : Résultat de TQ envoyé à client Client1 pour Tx T1746192451968497671_1 (PENDING). Message: 'TRANSACTION_RESULT ID=T1746192451968497671_1 STATUS=PENDING
'
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Après appel applyTransactionRequest
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: Après notification ClientSession
[2025-05-02 15:27:31][DEBUG] TransactionQueue::processRequest DEBUG: --- Fin de la fonction processRequest ---
[2025-05-02 15:27:41][ERROR] ServerConnection::receive ERROR : Erreur système SSL_read (SSL_ERROR_SYSCALL). errno: Connection reset by peer. Socket FD: 11
[2025-05-02 15:27:41][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 11
[2025-05-02 15:27:41][ERROR] ClientSession ERROR : Erreur détectée lors de la réception pour client Client1. Arrêt de la session. Code retour receive: -1
[2025-05-02 15:27:41][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=0
--- Début du log : 1746192832 ---
[2025-05-02 15:33:52][DEBUG] TransactionQueue créée.
[2025-05-02 15:33:52][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 15:33:52][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 15:33:52][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 15:33:52][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 15:33:52][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 15:33:52][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 15:33:52][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 15:33:52][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 15:33:52][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 15:33:52][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 15:33:52][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 15:33:52][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 15:33:52][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 15:33:52][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 15:33:52][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 15:33:52][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 15:33:52][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 15:33:52][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 15:33:52][INFO] Global Thread de génération de prix initié.
[2025-05-02 15:33:52][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 15:33:52][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 15:33:52][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 15:33:52][INFO] Global Thread de génération de prix démarré.
[2025-05-02 15:33:52][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 15:33:52][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 15:33:52][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 15:33:52][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 15:33:52][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 15:33:52][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 15:33:52][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 15:33:52][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 15:33:52][INFO] Global Nouveau prix SRD-BTC simulé : 95121.1082746958
[2025-05-02 15:33:57][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 8, IP: 10.188.240.101
[2025-05-02 15:33:57][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 8
[2025-05-02 15:33:57][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 8
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 15:33:57][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 15:33:57][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 15:33:57][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 8
[2025-05-02 15:33:57][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 8
[2025-05-02 15:33:57][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 8
[2025-05-02 15:33:57][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 8
[2025-05-02 15:33:57][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 8
[2025-05-02 15:33:57][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (8) et SSL existants.
[2025-05-02 15:33:57][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 8
[2025-05-02 15:33:57][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 15:33:57][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 15:33:57][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 8
[2025-05-02 15:33:57][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 8. Buffer accumulation size: 24
[2025-05-02 15:33:57][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 8. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 15:33:57][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 8 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 15:33:57][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 8
[2025-05-02 15:33:57][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 15:33:57][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 15:33:57][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 15:33:57][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 15:33:57][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 15:33:57][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 8
[2025-05-02 15:33:57][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 8
[2025-05-02 15:33:57][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 15:33:57][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 15:33:57][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 15:33:57][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 15:33:57][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 15:33:57][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 15:33:57][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 15:33:57][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 15:33:57][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 15:33:57][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 15:33:57][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 15:33:57][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 15:33:57][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 15:33:57][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 15:33:57][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 15:33:57][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 15:33:57][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 15:33:57][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 15:33:57][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 15:33:57][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 15:33:57][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 15:33:57][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 15:33:57][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 15:33:57][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 15:33:57][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 15:33:57][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 15:34:04][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 15:34:04][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 15:34:04][DEBUG] ClientSession DEBUG : BUY calculé (basé sur prix actuel 95121.108275): utiliser 1000.000000 USD (10.000000%) pour une quantité visée de 0.010513 SRD-BTC.
[2025-05-02 15:34:04][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0105129137. Taille de la queue: 1
[2025-05-02 15:34:04][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1: Client=Client1, Type=BUY, Qty Visée=0.010513 SRD-BTC (basé sur 10.000000% de solde USD)
[2025-05-02 15:34:04][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 10.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 15:34:04][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.010513
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: --- Entrée de la fonction processRequest ---
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Avant déclarations variables locales
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Après déclarations variables locales
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Avant accès sessionMap
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Tentative verrou sessionMap
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Verrou sessionMap obtenu
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Recherche sessionMap faite
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: session.lock() appelé
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: getClientWallet() appelé
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Accès session/wallet fait
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Verrou sessionMap libéré
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Avant vérification session/wallet null
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Session et Wallet sont valides
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Avant Global::getPrice
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Après Global::getPrice
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Avant bloc verrouillé Wallet
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Tentative verrou Wallet
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Verrou Wallet obtenu
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Logique sous verrou terminée
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Verrou Wallet libéré
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Avant création Transaction finale
[2025-05-02 15:34:04][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 15:34:04][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: ID et Timestamp générés
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Construction Transaction finale
[2025-05-02 15:34:04][DEBUG] Transaction créée/chargée : ID=T1746192844128166368_1, Client=Client1, Type=BUY, Statut=PENDING
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Transaction finale construite
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Avant logging global
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Après logging global
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Avant notification ClientSession
[2025-05-02 15:34:04][INFO] ClientSession INFO : Notification de TQ reçue pour transaction Client1:T1746192844128166368_1 avec statut PENDING
[2025-05-02 15:34:04][DEBUG] ClientSession DEBUG : Bot non actif pour client Client1. Notification TX T1746192844128166368_1 non passée au bot.
[2025-05-02 15:34:04][DEBUG] ClientSession DEBUG : applyTransactionRequest: Tentative d'envoi de la réponse TRANSACTION_RESULT au client...
[2025-05-02 15:34:04][DEBUG] ClientSession DEBUG : applyTransactionRequest: Réponse TRANSACTION_RESULT envoyée (ou appel send terminé sans exception).
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Après appel applyTransactionRequest
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: Après notification ClientSession
[2025-05-02 15:34:04][DEBUG] TransactionQueue::processRequest DEBUG: --- Fin de la fonction processRequest ---
[2025-05-02 15:34:07][INFO] Global Nouveau prix SRD-BTC simulé : 96273.1246841304
[2025-05-02 15:34:22][INFO] Global Nouveau prix SRD-BTC simulé : 96872.5240396058
--- Début du log : 1746193169 ---
[2025-05-02 15:39:29][DEBUG] TransactionQueue créée.
[2025-05-02 15:39:29][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 15:39:29][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 15:39:29][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 15:39:29][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 15:39:29][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 15:39:29][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 15:39:29][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 15:39:29][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 15:39:29][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 15:39:29][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 15:39:29][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 15:39:29][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 15:39:29][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 15:39:29][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 15:39:29][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 15:39:29][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 15:39:29][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 15:39:29][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 15:39:29][INFO] Global Thread de génération de prix initié.
[2025-05-02 15:39:29][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 15:39:29][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 15:39:29][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 15:39:29][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 15:39:29][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 15:39:29][INFO] Global Thread de génération de prix démarré.
[2025-05-02 15:39:29][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 15:39:29][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 15:39:29][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 15:39:29][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 15:39:29][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 15:39:29][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 15:39:29][INFO] Global Nouveau prix SRD-BTC simulé : 97043.7864481779
[2025-05-02 15:39:38][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 8, IP: 10.188.240.101
[2025-05-02 15:39:38][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 8
[2025-05-02 15:39:38][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 8
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 15:39:38][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 15:39:38][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 15:39:38][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 8
[2025-05-02 15:39:38][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 8
[2025-05-02 15:39:38][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 8
[2025-05-02 15:39:38][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 8
[2025-05-02 15:39:38][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 8
[2025-05-02 15:39:38][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (8) et SSL existants.
[2025-05-02 15:39:38][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 8
[2025-05-02 15:39:38][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 15:39:38][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 15:39:38][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 8
[2025-05-02 15:39:38][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 8. Buffer accumulation size: 24
[2025-05-02 15:39:38][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 8. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 15:39:38][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 8 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 15:39:38][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 8
[2025-05-02 15:39:38][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 15:39:38][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 15:39:38][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 15:39:38][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 15:39:38][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 15:39:38][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 8
[2025-05-02 15:39:38][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 8
[2025-05-02 15:39:38][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 15:39:38][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 15:39:38][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 15:39:38][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 15:39:38][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 15:39:38][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 15:39:38][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 15:39:38][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 15:39:38][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 15:39:38][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 15:39:38][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 15:39:38][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 15:39:38][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 15:39:38][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 15:39:38][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 15:39:38][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 15:39:38][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 15:39:38][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 15:39:38][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 15:39:38][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 15:39:38][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 15:39:38][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 15:39:38][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 15:39:38][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 15:39:38][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 15:39:38][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 15:39:44][INFO] Global Nouveau prix SRD-BTC simulé : 94487.7360001931
[2025-05-02 15:39:45][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 15:39:45][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 50'
[2025-05-02 15:39:45][DEBUG] ClientSession DEBUG : BUY calculé (basé sur prix actuel 94487.736000): utiliser 5000.000000 USD (50.000000%) pour une quantité visée de 0.052917 SRD-BTC.
[2025-05-02 15:39:45][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0529169204. Taille de la queue: 1
[2025-05-02 15:39:45][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1: Client=Client1, Type=BUY, Qty Visée=0.052917 SRD-BTC (basé sur 50.000000% de solde USD)
[2025-05-02 15:39:45][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 50.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 15:39:45][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.052917
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: --- Entrée de la fonction processRequest ---
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Avant déclarations variables locales
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Après déclarations variables locales
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Avant accès sessionMap
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Tentative verrou sessionMap
[2025-05-02 15:39:45][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 15:39:45][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 50'
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Verrou sessionMap obtenu
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Recherche sessionMap faite
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: session.lock() appelé
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: getClientWallet() appelé
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Accès session/wallet fait
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Verrou sessionMap libéré
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Avant vérification session/wallet null
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Session et Wallet sont valides
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Avant Global::getPrice
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Après Global::getPrice
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Avant bloc verrouillé Wallet
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Tentative verrou Wallet
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Verrou Wallet obtenu
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Logique sous verrou terminée
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Verrou Wallet libéré
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Avant création Transaction finale
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: ID et Timestamp générés
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Construction Transaction finale
[2025-05-02 15:39:45][DEBUG] Transaction créée/chargée : ID=T1746193185111044458_1, Client=Client1, Type=BUY, Statut=PENDING
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Transaction finale construite
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Avant logging global
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Après logging global
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Avant notification ClientSession
[2025-05-02 15:39:45][INFO] ClientSession INFO : Notification de TQ reçue pour transaction Client1:T1746193185111044458_1 avec statut PENDING
[2025-05-02 15:39:45][DEBUG] ClientSession DEBUG : Bot non actif pour client Client1. Notification TX T1746193185111044458_1 non passée au bot.
[2025-05-02 15:39:45][DEBUG] ClientSession DEBUG : applyTransactionRequest: Tentative d'envoi de la réponse TRANSACTION_RESULT au client...
[2025-05-02 15:39:45][DEBUG] ClientSession DEBUG : applyTransactionRequest: Réponse TRANSACTION_RESULT envoyée (ou appel send terminé sans exception).
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Après appel applyTransactionRequest
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: Après notification ClientSession
[2025-05-02 15:39:45][DEBUG] TransactionQueue::processRequest DEBUG: --- Fin de la fonction processRequest ---
[2025-05-02 15:39:59][INFO] Global Nouveau prix SRD-BTC simulé : 97610.3628419101
[2025-05-02 15:40:14][INFO] Global Nouveau prix SRD-BTC simulé : 95631.2410403899
[2025-05-02 15:40:29][INFO] Global Nouveau prix SRD-BTC simulé : 99023.1232197432
[2025-05-02 15:40:44][INFO] Global Nouveau prix SRD-BTC simulé : 96596.4898424626
[2025-05-02 15:40:59][INFO] Global Nouveau prix SRD-BTC simulé : 98718.4833175423
[2025-05-02 15:41:14][INFO] Global Nouveau prix SRD-BTC simulé : 98479.7740609670
[2025-05-02 15:41:29][INFO] Global Nouveau prix SRD-BTC simulé : 96312.4599429808
[2025-05-02 15:41:44][INFO] Global Nouveau prix SRD-BTC simulé : 96998.6583174077
[2025-05-02 15:41:59][INFO] Global Nouveau prix SRD-BTC simulé : 97027.6451225156
[2025-05-02 15:42:14][INFO] Global Nouveau prix SRD-BTC simulé : 95883.7586366539
[2025-05-02 15:42:29][INFO] Global Nouveau prix SRD-BTC simulé : 95081.9765773194
[2025-05-02 15:42:45][INFO] Global Nouveau prix SRD-BTC simulé : 100802.0181065575
[2025-05-02 15:43:00][INFO] Global Nouveau prix SRD-BTC simulé : 96301.6628089253
[2025-05-02 15:43:15][INFO] Global Nouveau prix SRD-BTC simulé : 96998.1238033567
[2025-05-02 15:43:30][INFO] Global Nouveau prix SRD-BTC simulé : 98764.1769432013
[2025-05-02 15:43:45][INFO] Global Nouveau prix SRD-BTC simulé : 94154.1458874613
[2025-05-02 15:44:00][INFO] Global Nouveau prix SRD-BTC simulé : 97737.0094777962
[2025-05-02 15:44:15][INFO] Global Nouveau prix SRD-BTC simulé : 96832.3242420655
[2025-05-02 15:44:30][INFO] Global Nouveau prix SRD-BTC simulé : 97796.0406233436
[2025-05-02 15:44:45][INFO] Global Nouveau prix SRD-BTC simulé : 96463.9988183350
[2025-05-02 15:45:00][INFO] Global Nouveau prix SRD-BTC simulé : 95265.4768267705
[2025-05-02 15:45:15][INFO] Global Nouveau prix SRD-BTC simulé : 96854.8455859458
[2025-05-02 15:45:30][INFO] Global Nouveau prix SRD-BTC simulé : 94820.8801823989
[2025-05-02 15:45:45][INFO] Global Nouveau prix SRD-BTC simulé : 94519.8793898501
[2025-05-02 15:46:00][INFO] Global Nouveau prix SRD-BTC simulé : 95588.2838143967
[2025-05-02 15:46:15][INFO] Global Nouveau prix SRD-BTC simulé : 95805.7472399048
[2025-05-02 15:46:30][INFO] Global Nouveau prix SRD-BTC simulé : 95810.8616323464
[2025-05-02 15:46:45][INFO] Global Nouveau prix SRD-BTC simulé : 96550.3859987059
[2025-05-02 15:47:01][INFO] Global Nouveau prix SRD-BTC simulé : 97830.1931871220
[2025-05-02 15:47:16][INFO] Global Nouveau prix SRD-BTC simulé : 98139.0619291105
[2025-05-02 15:47:31][INFO] Global Nouveau prix SRD-BTC simulé : 97382.9108789786
[2025-05-02 15:47:46][INFO] Global Nouveau prix SRD-BTC simulé : 97933.3334284953
[2025-05-02 15:48:01][INFO] Global Nouveau prix SRD-BTC simulé : 97026.3335503708
[2025-05-02 15:48:16][INFO] Global Nouveau prix SRD-BTC simulé : 99569.1451372728
[2025-05-02 15:48:31][INFO] Global Nouveau prix SRD-BTC simulé : 97445.0010353753
[2025-05-02 15:48:46][INFO] Global Nouveau prix SRD-BTC simulé : 95968.7258649691
[2025-05-02 15:49:01][INFO] Global Nouveau prix SRD-BTC simulé : 98055.3115819769
[2025-05-02 15:49:16][INFO] Global Nouveau prix SRD-BTC simulé : 97208.3178998773
[2025-05-02 15:49:31][INFO] Global Nouveau prix SRD-BTC simulé : 98935.6015967704
[2025-05-02 15:49:46][INFO] Global Nouveau prix SRD-BTC simulé : 99249.5059648567
[2025-05-02 15:50:01][INFO] Global Nouveau prix SRD-BTC simulé : 95523.6734676278
[2025-05-02 15:50:16][INFO] Global Nouveau prix SRD-BTC simulé : 98946.0153486859
[2025-05-02 15:50:31][INFO] Global Nouveau prix SRD-BTC simulé : 98121.2071166576
[2025-05-02 15:50:46][INFO] Global Nouveau prix SRD-BTC simulé : 96194.2945274719
[2025-05-02 15:51:01][INFO] Global Nouveau prix SRD-BTC simulé : 99647.4923354391
[2025-05-02 15:51:16][INFO] Global Nouveau prix SRD-BTC simulé : 94105.9345198568
[2025-05-02 15:51:31][INFO] Global Nouveau prix SRD-BTC simulé : 97047.2713812209
[2025-05-02 15:51:46][INFO] Global Nouveau prix SRD-BTC simulé : 101310.2605567597
[2025-05-02 15:52:01][INFO] Global Nouveau prix SRD-BTC simulé : 97526.7768162502
[2025-05-02 15:52:16][INFO] Global Nouveau prix SRD-BTC simulé : 98672.3269737339
[2025-05-02 15:52:18][ERROR] ServerConnection::receive ERROR : Erreur système SSL_read (SSL_ERROR_SYSCALL). errno: Connection reset by peer. Socket FD: 8
[2025-05-02 15:52:18][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 8
[2025-05-02 15:52:18][ERROR] ClientSession ERROR : Erreur détectée lors de la réception pour client Client1. Arrêt de la session. Code retour receive: -1
[2025-05-02 15:52:18][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=0
[2025-05-02 15:52:31][INFO] Global Nouveau prix SRD-BTC simulé : 99019.7662690614
--- Début du log : 1746194271 ---
[2025-05-02 15:57:51][DEBUG] TransactionQueue créée.
[2025-05-02 15:57:51][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 15:57:51][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 15:57:51][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 15:57:51][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 15:57:51][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 15:57:51][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 15:57:51][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 15:57:51][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 15:57:51][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 15:57:51][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 15:57:51][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 15:57:51][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 15:57:51][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 15:57:51][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 15:57:51][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 15:57:51][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 15:57:51][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 15:57:51][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 15:57:51][INFO] Global Thread de génération de prix initié.
[2025-05-02 15:57:51][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 15:57:51][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 15:57:51][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 15:57:51][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 15:57:51][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 15:57:51][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 15:57:51][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 15:57:51][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 15:57:51][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 15:57:51][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 15:57:51][INFO] Global Thread de génération de prix démarré.
[2025-05-02 15:57:51][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 15:57:51][INFO] Global Nouveau prix SRD-BTC simulé : 97313.2921881047
[2025-05-02 15:57:56][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 5, IP: 10.188.240.101
[2025-05-02 15:57:56][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 5
[2025-05-02 15:57:56][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 5
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 15:57:56][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 15:57:56][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 15:57:56][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 15:57:56][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 15:57:56][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 5
[2025-05-02 15:57:56][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 5
[2025-05-02 15:57:56][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 5
[2025-05-02 15:57:56][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (5) et SSL existants.
[2025-05-02 15:57:56][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 5
[2025-05-02 15:57:56][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 15:57:56][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 15:57:56][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 5
[2025-05-02 15:57:56][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 5. Buffer accumulation size: 24
[2025-05-02 15:57:56][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 5. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 15:57:56][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 5 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 15:57:56][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 5
[2025-05-02 15:57:56][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 15:57:56][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 15:57:56][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 15:57:56][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 15:57:56][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 15:57:56][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 5
[2025-05-02 15:57:56][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 5
[2025-05-02 15:57:56][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 15:57:56][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 15:57:56][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 15:57:56][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 15:57:56][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 15:57:56][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 15:57:56][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 15:57:56][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 15:57:56][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 15:57:56][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 15:57:56][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 15:57:56][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 15:57:56][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 15:57:56][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 15:57:56][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 15:57:56][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 15:57:56][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 15:57:56][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 15:57:56][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 15:57:56][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 15:57:56][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 15:57:56][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 15:57:56][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 15:57:56][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 15:57:56][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 15:57:56][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 15:58:03][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 15:58:03][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 15:58:03][DEBUG] ClientSession DEBUG : BUY calculé (basé sur prix actuel 97313.292188): utiliser 1000.000000 USD (10.000000%) pour une quantité visée de 0.010276 SRD-BTC.
[2025-05-02 15:58:03][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0102760885. Taille de la queue: 1
[2025-05-02 15:58:03][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1: Client=Client1, Type=BUY, Qty Visée=0.010276 SRD-BTC (basé sur 10.000000% de solde USD)
[2025-05-02 15:58:03][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 10.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 15:58:03][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.010276
[2025-05-02 15:58:03][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 15:58:03][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: --- Entrée de la fonction processRequest ---
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Avant déclarations variables locales
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Après déclarations variables locales
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Avant accès sessionMap
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Tentative verrou sessionMap
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Verrou sessionMap obtenu
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Recherche sessionMap faite
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: session.lock() appelé
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: getClientWallet() appelé
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Accès session/wallet fait
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Verrou sessionMap libéré
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Avant vérification session/wallet null
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Session et Wallet sont valides
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Avant Global::getPrice
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Après Global::getPrice
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Avant bloc verrouillé Wallet
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Tentative verrou Wallet
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Verrou Wallet obtenu
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Logique sous verrou terminée
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Verrou Wallet libéré
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Avant création Transaction finale
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: ID et Timestamp générés
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Construction Transaction finale
[2025-05-02 15:58:03][DEBUG] Transaction créée/chargée : ID=T1746194283066952322_1, Client=Client1, Type=BUY, Statut=PENDING
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Transaction finale construite
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Avant logging global
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Après logging global
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Avant notification ClientSession
[2025-05-02 15:58:03][INFO] ClientSession INFO : Notification de TQ reçue pour transaction Client1:T1746194283066952322_1 avec statut PENDING
[2025-05-02 15:58:03][DEBUG] ClientSession DEBUG : Bot non actif pour client Client1. Notification TX T1746194283066952322_1 non passée au bot.
[2025-05-02 15:58:03][DEBUG] ClientSession DEBUG : applyTransactionRequest: Tentative d'envoi de la réponse TRANSACTION_RESULT au client...
[2025-05-02 15:58:03][DEBUG] ClientSession DEBUG : applyTransactionRequest: Réponse TRANSACTION_RESULT envoyée (ou appel send terminé sans exception).
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Après appel applyTransactionRequest
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: Après notification ClientSession
[2025-05-02 15:58:03][DEBUG] TransactionQueue::processRequest DEBUG: --- Fin de la fonction processRequest ---
[2025-05-02 15:58:06][INFO] Global Nouveau prix SRD-BTC simulé : 99494.8275119228
[2025-05-02 15:58:21][INFO] Global Nouveau prix SRD-BTC simulé : 94864.3926669023
[2025-05-02 15:58:36][INFO] Global Nouveau prix SRD-BTC simulé : 97088.1708381793
[2025-05-02 15:58:51][INFO] Global Nouveau prix SRD-BTC simulé : 93759.8436330182
[2025-05-02 15:59:06][INFO] Global Nouveau prix SRD-BTC simulé : 96487.5063000095
[2025-05-02 15:59:21][INFO] Global Nouveau prix SRD-BTC simulé : 94358.1196131947
[2025-05-02 15:59:36][INFO] Global Nouveau prix SRD-BTC simulé : 96027.2542467695
[2025-05-02 15:59:51][INFO] Global Nouveau prix SRD-BTC simulé : 96504.7875579054
[2025-05-02 16:00:06][INFO] Global Nouveau prix SRD-BTC simulé : 95356.9805037032
[2025-05-02 16:00:21][INFO] Global Nouveau prix SRD-BTC simulé : 96970.6477842591
[2025-05-02 16:00:36][INFO] Global Nouveau prix SRD-BTC simulé : 98123.5943160418
[2025-05-02 16:00:51][INFO] Global Nouveau prix SRD-BTC simulé : 97150.6993099040
[2025-05-02 16:01:06][INFO] Global Nouveau prix SRD-BTC simulé : 95666.2253128330
[2025-05-02 16:01:22][INFO] Global Nouveau prix SRD-BTC simulé : 96521.9330499216
[2025-05-02 16:01:37][INFO] Global Nouveau prix SRD-BTC simulé : 92347.9238979471
[2025-05-02 16:01:52][INFO] Global Nouveau prix SRD-BTC simulé : 94810.1970718371
[2025-05-02 16:02:07][INFO] Global Nouveau prix SRD-BTC simulé : 96778.3706043062
[2025-05-02 16:02:22][INFO] Global Nouveau prix SRD-BTC simulé : 94045.2309946272
[2025-05-02 16:02:37][INFO] Global Nouveau prix SRD-BTC simulé : 94778.4756723885
[2025-05-02 16:02:52][INFO] Global Nouveau prix SRD-BTC simulé : 97562.3815624043
[2025-05-02 16:03:07][INFO] Global Nouveau prix SRD-BTC simulé : 96752.9860763716
[2025-05-02 16:03:22][INFO] Global Nouveau prix SRD-BTC simulé : 94981.0610301402
[2025-05-02 16:03:37][INFO] Global Nouveau prix SRD-BTC simulé : 96497.1850724201
[2025-05-02 16:03:52][INFO] Global Nouveau prix SRD-BTC simulé : 97026.8348747856
[2025-05-02 16:04:07][INFO] Global Nouveau prix SRD-BTC simulé : 96988.7337459454
[2025-05-02 16:04:22][INFO] Global Nouveau prix SRD-BTC simulé : 96674.4395383200
[2025-05-02 16:04:37][INFO] Global Nouveau prix SRD-BTC simulé : 98239.7691035175
[2025-05-02 16:04:52][INFO] Global Nouveau prix SRD-BTC simulé : 98015.4783508873
[2025-05-02 16:05:07][INFO] Global Nouveau prix SRD-BTC simulé : 99053.2967770762
[2025-05-02 16:05:22][INFO] Global Nouveau prix SRD-BTC simulé : 97026.2442296161
[2025-05-02 16:05:37][INFO] Global Nouveau prix SRD-BTC simulé : 96693.1712376547
[2025-05-02 16:05:52][INFO] Global Nouveau prix SRD-BTC simulé : 98564.4797209925
[2025-05-02 16:06:07][INFO] Global Nouveau prix SRD-BTC simulé : 98986.1998110837
[2025-05-02 16:06:22][INFO] Global Nouveau prix SRD-BTC simulé : 96285.8478307267
[2025-05-02 16:06:37][INFO] Global Nouveau prix SRD-BTC simulé : 96460.8455943237
[2025-05-02 16:06:53][INFO] Global Nouveau prix SRD-BTC simulé : 97488.9340327761
[2025-05-02 16:07:08][INFO] Global Nouveau prix SRD-BTC simulé : 95435.6516620186
[2025-05-02 16:07:23][INFO] Global Nouveau prix SRD-BTC simulé : 95885.7252709862
[2025-05-02 16:07:38][INFO] Global Nouveau prix SRD-BTC simulé : 96273.5856540958
[2025-05-02 16:07:53][INFO] Global Nouveau prix SRD-BTC simulé : 96026.2015784211
[2025-05-02 16:08:08][INFO] Global Nouveau prix SRD-BTC simulé : 96437.9752682690
[2025-05-02 16:08:23][INFO] Global Nouveau prix SRD-BTC simulé : 98816.4154900158
[2025-05-02 16:08:38][INFO] Global Nouveau prix SRD-BTC simulé : 97315.9702049666
[2025-05-02 16:08:53][INFO] Global Nouveau prix SRD-BTC simulé : 94392.1129240894
[2025-05-02 16:09:08][INFO] Global Nouveau prix SRD-BTC simulé : 99606.3373620679
[2025-05-02 16:09:23][INFO] Global Nouveau prix SRD-BTC simulé : 94405.4531095854
[2025-05-02 16:09:38][INFO] Global Nouveau prix SRD-BTC simulé : 97565.0549474037
[2025-05-02 16:09:53][INFO] Global Nouveau prix SRD-BTC simulé : 98585.3587997580
[2025-05-02 16:10:08][INFO] Global Nouveau prix SRD-BTC simulé : 96126.4858486712
[2025-05-02 16:10:23][INFO] Global Nouveau prix SRD-BTC simulé : 97303.9055215695
[2025-05-02 16:10:38][INFO] Global Nouveau prix SRD-BTC simulé : 98309.8794636986
[2025-05-02 16:10:53][INFO] Global Nouveau prix SRD-BTC simulé : 95038.8332875876
[2025-05-02 16:11:08][INFO] Global Nouveau prix SRD-BTC simulé : 97823.6129087125
[2025-05-02 16:11:23][INFO] Global Nouveau prix SRD-BTC simulé : 97313.2830950829
[2025-05-02 16:11:38][INFO] Global Nouveau prix SRD-BTC simulé : 95651.3848147900
[2025-05-02 16:11:53][INFO] Global Nouveau prix SRD-BTC simulé : 98336.2430384943
[2025-05-02 16:12:08][INFO] Global Nouveau prix SRD-BTC simulé : 98666.1852146575
[2025-05-02 16:12:24][INFO] Global Nouveau prix SRD-BTC simulé : 96257.4679466890
[2025-05-02 16:12:39][INFO] Global Nouveau prix SRD-BTC simulé : 97207.6060145595
[2025-05-02 16:12:54][INFO] Global Nouveau prix SRD-BTC simulé : 93093.2171016225
[2025-05-02 16:13:09][INFO] Global Nouveau prix SRD-BTC simulé : 95904.9681974634
[2025-05-02 16:13:24][INFO] Global Nouveau prix SRD-BTC simulé : 96172.6549306025
[2025-05-02 16:13:39][INFO] Global Nouveau prix SRD-BTC simulé : 95777.5791289521
[2025-05-02 16:13:54][INFO] Global Nouveau prix SRD-BTC simulé : 96198.4174187230
[2025-05-02 16:14:09][INFO] Global Nouveau prix SRD-BTC simulé : 97192.2374086802
[2025-05-02 16:14:24][INFO] Global Nouveau prix SRD-BTC simulé : 95593.7867837615
[2025-05-02 16:14:39][INFO] Global Nouveau prix SRD-BTC simulé : 96651.3667475430
[2025-05-02 16:14:54][INFO] Global Nouveau prix SRD-BTC simulé : 97337.2644405618
[2025-05-02 16:15:09][INFO] Global Nouveau prix SRD-BTC simulé : 97472.7612836298
[2025-05-02 16:15:24][INFO] Global Nouveau prix SRD-BTC simulé : 97813.2050430026
--- Début du log : 1746196523 ---
[2025-05-02 16:35:23][DEBUG] TransactionQueue créée.
[2025-05-02 16:35:23][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 16:35:23][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 16:35:23][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 16:35:23][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 16:35:23][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 16:35:23][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 16:35:23][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 16:35:23][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 16:35:23][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 16:35:23][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 16:35:23][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 16:35:23][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 16:35:23][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 16:35:23][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 16:35:23][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 16:35:23][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 16:35:23][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 16:35:23][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 16:35:23][INFO] Global Thread de génération de prix initié.
[2025-05-02 16:35:23][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 16:35:23][INFO] Global Thread de génération de prix démarré.
[2025-05-02 16:35:23][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 16:35:23][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 16:35:23][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 16:35:23][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 16:35:23][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 5
[2025-05-02 16:35:23][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 16:35:23][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 16:35:23][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 16:35:23][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 16:35:23][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 16:35:23][INFO] Global Nouveau prix SRD-BTC simulé : 96732.2929866182
[2025-05-02 16:35:33][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 11, IP: 10.188.240.101
[2025-05-02 16:35:33][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 11
[2025-05-02 16:35:33][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 11
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 16:35:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 16:35:33][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 16:35:33][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 16:35:33][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 16:35:33][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 11
[2025-05-02 16:35:33][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 11
[2025-05-02 16:35:33][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 11
[2025-05-02 16:35:33][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (11) et SSL existants.
[2025-05-02 16:35:33][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 11
[2025-05-02 16:35:33][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 16:35:33][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 16:35:33][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 11
[2025-05-02 16:35:33][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 11. Buffer accumulation size: 24
[2025-05-02 16:35:33][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 11. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 16:35:33][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 11 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 16:35:33][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 11
[2025-05-02 16:35:33][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 16:35:33][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 16:35:33][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 16:35:33][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 16:35:33][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 16:35:33][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 11
[2025-05-02 16:35:33][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 11
[2025-05-02 16:35:33][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 16:35:33][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 16:35:33][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 16:35:33][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 16:35:33][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 16:35:33][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 16:35:33][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 16:35:33][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 16:35:33][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 16:35:33][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 16:35:33][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 16:35:33][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 16:35:33][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 16:35:33][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 16:35:33][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 16:35:33][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 16:35:33][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 16:35:33][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 16:35:33][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 16:35:33][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 16:35:33][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 16:35:33][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 16:35:33][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 16:35:33][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 16:35:33][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 16:35:33][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 16:35:38][INFO] Global Nouveau prix SRD-BTC simulé : 97540.1882053969
[2025-05-02 16:35:41][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 16:35:41][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 16:35:41][DEBUG] ClientSession DEBUG : BUY calculé (basé sur prix actuel 97540.188205): utiliser 1000.000000 USD (10.000000%) pour une quantité visée de 0.010252 SRD-BTC.
[2025-05-02 16:35:41][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0102521844. Taille de la queue: 1
[2025-05-02 16:35:41][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1: Client=Client1, Type=BUY, Qty Visée=0.010252 SRD-BTC (basé sur 10.000000% de solde USD)
[2025-05-02 16:35:41][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 10.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 16:35:41][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.010252
[2025-05-02 16:35:41][INFO] TransactionQueue::processRequest INFO : Début traitement requête ID client: Client1, Type: BUY, Quantité: 0.010252
[2025-05-02 16:35:41][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 16:35:41][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 16:35:41][DEBUG] TransactionQueue::processRequest DEBUG : ID (T1746196541774751162_1) et Timestamp générés pour requête client Client1
[2025-05-02 16:35:41][DEBUG] TransactionQueue::processRequest DEBUG : Prix SRD-BTC obtenu: 97540.188205 pour client Client1
[2025-05-02 16:35:41][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet obtenu pour client Client1
[2025-05-02 16:35:53][INFO] Global Nouveau prix SRD-BTC simulé : 97342.8272347399
[2025-05-02 16:36:08][INFO] Global Nouveau prix SRD-BTC simulé : 96383.1856420454
[2025-05-02 16:36:23][INFO] Global Nouveau prix SRD-BTC simulé : 94746.3857602087
[2025-05-02 16:36:29][DEBUG] OpenSSL Callback: SSL3 alert write:fatal:decode error
[2025-05-02 16:36:29][WARNING] ServerConnection::receive WARNING : SSL_read retourné 0. Erreur code: 1. Socket FD: 11
[2025-05-02 16:36:29][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 11
[2025-05-02 16:36:29][INFO] ClientSession INFO : Déconnexion propre détectée pour client Client1. Socket FD: 11
[2025-05-02 16:36:29][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=0
[2025-05-02 16:36:38][INFO] Global Nouveau prix SRD-BTC simulé : 97263.0873213733
[2025-05-02 16:36:53][INFO] Global Nouveau prix SRD-BTC simulé : 96329.3468591151
--- Début du log : 1746200862 ---
[2025-05-02 17:47:42][DEBUG] TransactionQueue créée.
[2025-05-02 17:47:42][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 17:47:42][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 17:47:42][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 17:47:42][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 17:47:42][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 17:47:42][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 17:47:42][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 17:47:42][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 17:47:42][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 17:47:42][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 17:47:42][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 17:47:42][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 17:47:42][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 17:47:42][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 17:47:42][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 17:47:42][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 17:47:42][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 17:47:42][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 17:47:42][INFO] Global Thread de génération de prix initié.
[2025-05-02 17:47:42][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 17:47:42][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 17:47:42][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 17:47:42][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 17:47:42][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 17:47:42][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 17:47:42][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 17:47:42][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 17:47:42][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 17:47:42][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 17:47:42][INFO] Global Thread de génération de prix démarré.
[2025-05-02 17:47:42][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 17:47:43][INFO] Global Nouveau prix SRD-BTC simulé : 99324.0832934168
[2025-05-02 17:47:46][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 5, IP: 10.188.240.101
[2025-05-02 17:47:46][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 5
[2025-05-02 17:47:46][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 5
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 17:47:46][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 17:47:46][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 17:47:46][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 17:47:46][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 17:47:46][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 5
[2025-05-02 17:47:46][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 5
[2025-05-02 17:47:46][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 5
[2025-05-02 17:47:46][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (5) et SSL existants.
[2025-05-02 17:47:46][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 5
[2025-05-02 17:47:46][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 17:47:46][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 17:47:46][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 5
[2025-05-02 17:47:46][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 5. Buffer accumulation size: 24
[2025-05-02 17:47:46][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 5. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 17:47:46][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 5 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 17:47:46][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 5
[2025-05-02 17:47:46][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 17:47:46][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 17:47:46][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 17:47:46][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 17:47:46][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 17:47:46][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 5
[2025-05-02 17:47:46][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 5
[2025-05-02 17:47:46][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 17:47:46][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 17:47:46][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 17:47:46][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 17:47:46][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 17:47:46][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 17:47:46][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 17:47:46][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 17:47:46][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 17:47:46][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 17:47:46][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 17:47:46][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 17:47:46][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 17:47:46][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 17:47:46][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 17:47:46][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 17:47:46][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 17:47:46][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 17:47:46][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 17:47:46][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 17:47:46][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 17:47:46][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 17:47:46][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 17:47:46][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 17:47:46][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 17:47:46][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 17:47:52][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 17:47:52][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 20'
[2025-05-02 17:47:52][DEBUG] ClientSession DEBUG : BUY calculé (basé sur prix actuel 99324.083293): utiliser 2000.000000 USD (20.000000%) pour une quantité visée de 0.020136 SRD-BTC.
[2025-05-02 17:47:52][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0201361033. Taille de la queue: 1
[2025-05-02 17:47:52][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1: Client=Client1, Type=BUY, Qty Visée=0.020136 SRD-BTC (basé sur 20.000000% de solde USD)
[2025-05-02 17:47:52][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 20.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 17:47:52][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.020136
[2025-05-02 17:47:52][INFO] TransactionQueue::processRequest INFO : Début traitement requête ID client: Client1, Type: BUY, Quantité: 0.020136
[2025-05-02 17:47:52][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 17:47:52][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 20'
[2025-05-02 17:47:52][DEBUG] TransactionQueue::processRequest DEBUG : ID (T1746200872446909456_1) et Timestamp générés pour requête client Client1
[2025-05-02 17:47:52][DEBUG] TransactionQueue::processRequest DEBUG : Prix SRD-BTC obtenu: 99324.083293 pour client Client1
[2025-05-02 17:47:52][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet obtenu pour client Client1
[2025-05-02 17:47:52][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Vérification validité prix 99324.083293
[2025-05-02 17:47:52][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Prix valide. Avant calculs et vérif fonds.
[2025-05-02 17:47:52][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Traitement BUY. Avant calculs montants.
[2025-05-02 17:47:52][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après calculs BUY. Avant vérif solde USD.
[2025-05-02 17:47:58][INFO] Global Nouveau prix SRD-BTC simulé : 98280.1893671743
[2025-05-02 17:48:13][INFO] Global Nouveau prix SRD-BTC simulé : 97884.7137974454
[2025-05-02 17:48:28][INFO] Global Nouveau prix SRD-BTC simulé : 97442.3575873044
[2025-05-02 17:48:43][INFO] Global Nouveau prix SRD-BTC simulé : 96543.6658343584
[2025-05-02 17:48:58][INFO] Global Nouveau prix SRD-BTC simulé : 97972.8855079809
[2025-05-02 17:49:13][INFO] Global Nouveau prix SRD-BTC simulé : 96700.0061761563
[2025-05-02 17:49:28][INFO] Global Nouveau prix SRD-BTC simulé : 97368.6464695913
[2025-05-02 17:49:43][INFO] Global Nouveau prix SRD-BTC simulé : 96966.2164027327
[2025-05-02 17:49:58][INFO] Global Nouveau prix SRD-BTC simulé : 96521.4188200044
[2025-05-02 17:50:13][INFO] Global Nouveau prix SRD-BTC simulé : 97966.8470464078
[2025-05-02 17:50:28][INFO] Global Nouveau prix SRD-BTC simulé : 96758.4869376433
[2025-05-02 17:50:43][INFO] Global Nouveau prix SRD-BTC simulé : 97911.4299402953
[2025-05-02 17:50:58][INFO] Global Nouveau prix SRD-BTC simulé : 96839.1903423038
[2025-05-02 17:51:13][INFO] Global Nouveau prix SRD-BTC simulé : 97668.2515758956
[2025-05-02 17:51:28][INFO] Global Nouveau prix SRD-BTC simulé : 100025.9660216637
[2025-05-02 17:51:43][INFO] Global Nouveau prix SRD-BTC simulé : 99178.5599797789
[2025-05-02 17:51:58][INFO] Global Nouveau prix SRD-BTC simulé : 97653.0833900597
[2025-05-02 17:52:13][INFO] Global Nouveau prix SRD-BTC simulé : 96442.4838782590
[2025-05-02 17:52:28][INFO] Global Nouveau prix SRD-BTC simulé : 97910.5777172038
[2025-05-02 17:52:43][INFO] Global Nouveau prix SRD-BTC simulé : 96479.3176050966
[2025-05-02 17:52:58][INFO] Global Nouveau prix SRD-BTC simulé : 97026.2115083018
[2025-05-02 17:53:14][INFO] Global Nouveau prix SRD-BTC simulé : 96387.1844001877
[2025-05-02 17:53:29][INFO] Global Nouveau prix SRD-BTC simulé : 98801.1274117264
[2025-05-02 17:53:44][INFO] Global Nouveau prix SRD-BTC simulé : 96993.6323445669
[2025-05-02 17:53:59][INFO] Global Nouveau prix SRD-BTC simulé : 96734.2497149787
--- Début du log : 1746201368 ---
[2025-05-02 17:56:08][DEBUG] TransactionQueue créée.
[2025-05-02 17:56:08][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 17:56:08][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 17:56:08][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 17:56:08][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 17:56:08][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 17:56:08][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 17:56:08][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 17:56:08][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 17:56:08][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 17:56:08][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 17:56:08][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 17:56:08][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 17:56:08][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 17:56:08][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 17:56:08][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 17:56:08][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 17:56:08][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 17:56:08][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 17:56:08][INFO] Global Thread de génération de prix initié.
[2025-05-02 17:56:08][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 17:56:08][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 17:56:08][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 17:56:08][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 17:56:08][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 17:56:08][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 17:56:08][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 17:56:08][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 17:56:08][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 17:56:08][INFO] Global Thread de génération de prix démarré.
[2025-05-02 17:56:08][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 17:56:08][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 17:56:09][INFO] Global Nouveau prix SRD-BTC simulé : 97552.1621478008
[2025-05-02 17:56:16][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 5, IP: 10.188.240.101
[2025-05-02 17:56:16][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 5
[2025-05-02 17:56:16][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 5
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 17:56:16][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 17:56:16][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 17:56:16][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 17:56:16][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 17:56:16][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 5
[2025-05-02 17:56:16][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 5
[2025-05-02 17:56:16][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 5
[2025-05-02 17:56:16][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (5) et SSL existants.
[2025-05-02 17:56:16][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 5
[2025-05-02 17:56:16][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 17:56:16][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 17:56:16][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 5
[2025-05-02 17:56:16][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 5. Buffer accumulation size: 24
[2025-05-02 17:56:16][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 5. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 17:56:16][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 5 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 17:56:16][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 5
[2025-05-02 17:56:16][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 17:56:16][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 17:56:16][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 17:56:16][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 17:56:16][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 17:56:16][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 5
[2025-05-02 17:56:16][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 5
[2025-05-02 17:56:16][DEBUG] Server::HandleClient DEBUG : Lancement de la création de ClientSession pour client ID: Client1 (sous lock)...
[2025-05-02 17:56:16][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 17:56:16][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 17:56:16][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 17:56:16][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 17:56:16][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 17:56:16][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 17:56:16][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 17:56:16][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10000.0000000000, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 17:56:16][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 17:56:16][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 17:56:16][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 17:56:16][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 17:56:16][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession pour client ID: Client1...
[2025-05-02 17:56:16][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 17:56:16][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 17:56:16][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 17:56:16][DEBUG] Server::HandleClient DEBUG : Ajout de la session à activeSessions...
[2025-05-02 17:56:16][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1.
[2025-05-02 17:56:16][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 17:56:16][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 17:56:16][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 17:56:16][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 17:56:16][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 17:56:16][WARNING] ClientSession WARNING : Impossible de démarrer la session pour client Client1 (déjà en cours ou client déconnecté)
[2025-05-02 17:56:16][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 17:56:24][INFO] Global Nouveau prix SRD-BTC simulé : 95957.4150911599
[2025-05-02 17:56:26][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 17:56:26][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 17:56:26][DEBUG] ClientSession DEBUG : BUY calculé (basé sur prix actuel 95957.415091): utiliser 1000.000000 USD (10.000000%) pour une quantité visée de 0.010421 SRD-BTC.
[2025-05-02 17:56:26][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0104212895. Taille de la queue: 1
[2025-05-02 17:56:26][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1: Client=Client1, Type=BUY, Qty Visée=0.010421 SRD-BTC (basé sur 10.000000% de solde USD)
[2025-05-02 17:56:26][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 10.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 17:56:26][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.010421
[2025-05-02 17:56:26][INFO] TransactionQueue::processRequest INFO : Début traitement requête ID client: Client1, Type: BUY, Quantité: 0.010421
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : ID (T1746201386542836298_1) et Timestamp générés pour requête client Client1
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Prix SRD-BTC obtenu: 95957.415091 pour client Client1
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet obtenu pour client Client1
[2025-05-02 17:56:26][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 17:56:26][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Vérification validité prix 95957.415091
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Prix valide. Avant calculs et vérif fonds.
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Traitement BUY. Avant calculs montants.
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après calculs BUY. Avant vérif solde USD.
[2025-05-02 17:56:26][INFO] TransactionQueue::processRequest INFO : Client Client1: BUY validé sous verrou. Fonds USD suffisants.
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après vérifs fonds/calculs. Statut actuel: COMPLETED
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Statut COMPLETED. Avant mise à jour soldes.
[2025-05-02 17:56:26][DEBUG] Wallet DEBUG : Client Client1 balance USD mise à jour de -1000.100000. Nouveau solde: 8999.900000
[2025-05-02 17:56:26][DEBUG] Wallet DEBUG : Client Client1 balance SRD-BTC mise à jour de 0.010421. Nouveau solde: 0.010421
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Soldes mis à jour BUY.
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Avant sauvegarde Wallet.
[2025-05-02 17:56:26][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 17:56:26][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 17:56:26][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 17:56:26][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 17:56:26][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 17:56:26][DEBUG] Wallet Sauvegarde du portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 17:56:26][INFO] Wallet Portefeuille (Client1) sauvegardé : USD=8999.9000000000, SRD-BTC=0.0104212895.
[2025-05-02 17:56:26][INFO] TransactionQueue::processRequest INFO : Client Client1: Wallet sauvegardé après Tx COMPLETED.
[2025-05-02 17:56:26][DEBUG] Transaction créée/chargée : ID=T1746201386542836298_1, Client=Client1, Type=BUY, Statut=COMPLETED
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Transaction finale (via shared_ptr) construite SOUS VERROU pour client Client1
[2025-05-02 17:56:26][INFO] Wallet Portefeuille (Client1) : Transaction ajoutée à l'historique. ID: T1746201386542836298_1, Type: BUY, Statut: COMPLETED
[2025-05-02 17:56:26][INFO] TransactionQueue::processRequest INFO : Transaction T1746201386542836298_1 ajoutée à l'historique du Wallet sous verrou pour client Client1. Statut: COMPLETED
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet libéré pour client Client1
[2025-05-02 17:56:26][INFO] TransactionQueue::processRequest INFO : Transaction ID: T1746201386542836298_1 logguée globalement pour client Client1 avec statut: COMPLETED
[2025-05-02 17:56:26][INFO] ClientSession INFO : Notification de TQ reçue pour transaction Client1:T1746201386542836298_1 avec statut COMPLETED
[2025-05-02 17:56:26][DEBUG] ClientSession DEBUG : Bot non actif pour client Client1. Notification TX T1746201386542836298_1 non passée au bot.
[2025-05-02 17:56:26][DEBUG] ClientSession DEBUG : applyTransactionRequest: Tentative d'envoi de la réponse TRANSACTION_RESULT au client...
[2025-05-02 17:56:26][DEBUG] ClientSession DEBUG : applyTransactionRequest: Réponse TRANSACTION_RESULT envoyée (ou appel send terminé sans exception).
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : applyTransactionRequest appelé pour client Client1, Transaction ID: T1746201386542836298_1, Statut: COMPLETED
[2025-05-02 17:56:26][DEBUG] TransactionQueue::processRequest DEBUG : Après notification ClientSession pour client Client1
[2025-05-02 17:56:26][INFO] TransactionQueue::processRequest INFO : --- Fin traitement requête ID: T1746201386542836298_1 pour client Client1 avec statut final: COMPLETED ---
[2025-05-02 17:56:37][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 17:56:37][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 17:56:37][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 17:56:37][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'BALANCE USD: 8999.9000000000, SRD-BTC: 0.0104212895
'
[2025-05-02 17:56:37][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 17:56:39][INFO] Global Nouveau prix SRD-BTC simulé : 97063.1776055526
[2025-05-02 17:56:54][INFO] Global Nouveau prix SRD-BTC simulé : 96532.1102606708
[2025-05-02 17:57:09][INFO] Global Nouveau prix SRD-BTC simulé : 98837.7202360835
[2025-05-02 17:57:24][INFO] Global Nouveau prix SRD-BTC simulé : 96657.8219581436
[2025-05-02 17:57:28][DEBUG] ClientSession DEBUG : Reçu 17 octets. Buffer d'accumulation: 17 octets.
[2025-05-02 17:57:28][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SELL SRD-BTC 100'
[2025-05-02 17:57:28][DEBUG] ClientSession DEBUG : SELL calculé : vendre 0.010421 SRD-BTC (basé sur 100.000000% de solde).
[2025-05-02 17:57:28][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: SELL, Quantité: 0.0104212895. Taille de la queue: 1
[2025-05-02 17:57:28][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1: Client=Client1, Type=SELL, Qty Visée=0.010421 SRD-BTC (basé sur 100.000000% de solde SRD-BTC)
[2025-05-02 17:57:28][INFO] ClientSession INFO : Requête de trading manuelle (SELL SRD-BTC 100.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 17:57:28][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: SELL, Quantité: 0.010421
[2025-05-02 17:57:28][INFO] TransactionQueue::processRequest INFO : Début traitement requête ID client: Client1, Type: SELL, Quantité: 0.010421
[2025-05-02 17:57:28][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your SELL request has been submitted for processing.
'
[2025-05-02 17:57:28][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SELL SRD-BTC 100'
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : ID (T1746201448360127562_2) et Timestamp générés pour requête client Client1
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Prix SRD-BTC obtenu: 96657.821958 pour client Client1
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet obtenu pour client Client1
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Vérification validité prix 96657.821958
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Prix valide. Avant calculs et vérif fonds.
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Traitement SELL. Avant calculs montants.
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après calculs SELL. Avant vérif solde SRD-BTC.
[2025-05-02 17:57:28][INFO] TransactionQueue::processRequest INFO : Client Client1: SELL validé sous verrou. Fonds SRD-BTC suffisants.
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après vérifs fonds/calculs. Statut actuel: COMPLETED
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Statut COMPLETED. Avant mise à jour soldes.
[2025-05-02 17:57:28][DEBUG] Wallet DEBUG : Client Client1 balance SRD-BTC mise à jour de -0.010421. Nouveau solde: 0.000000
[2025-05-02 17:57:28][DEBUG] Wallet DEBUG : Client Client1 balance USD mise à jour de 1007.198413. Nouveau solde: 10007.098413
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Soldes mis à jour SELL.
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Avant sauvegarde Wallet.
[2025-05-02 17:57:28][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 17:57:28][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 17:57:28][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 17:57:28][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 17:57:28][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 17:57:28][DEBUG] Wallet Sauvegarde du portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 17:57:28][INFO] Wallet Portefeuille (Client1) sauvegardé : USD=10007.0984127973, SRD-BTC=0.0000000000.
[2025-05-02 17:57:28][INFO] TransactionQueue::processRequest INFO : Client Client1: Wallet sauvegardé après Tx COMPLETED.
[2025-05-02 17:57:28][DEBUG] Transaction créée/chargée : ID=T1746201448360127562_2, Client=Client1, Type=SELL, Statut=COMPLETED
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Transaction finale (via shared_ptr) construite SOUS VERROU pour client Client1
[2025-05-02 17:57:28][INFO] Wallet Portefeuille (Client1) : Transaction ajoutée à l'historique. ID: T1746201448360127562_2, Type: SELL, Statut: COMPLETED
[2025-05-02 17:57:28][INFO] TransactionQueue::processRequest INFO : Transaction T1746201448360127562_2 ajoutée à l'historique du Wallet sous verrou pour client Client1. Statut: COMPLETED
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet libéré pour client Client1
[2025-05-02 17:57:28][INFO] TransactionQueue::processRequest INFO : Transaction ID: T1746201448360127562_2 logguée globalement pour client Client1 avec statut: COMPLETED
[2025-05-02 17:57:28][INFO] ClientSession INFO : Notification de TQ reçue pour transaction Client1:T1746201448360127562_2 avec statut COMPLETED
[2025-05-02 17:57:28][DEBUG] ClientSession DEBUG : Bot non actif pour client Client1. Notification TX T1746201448360127562_2 non passée au bot.
[2025-05-02 17:57:28][DEBUG] ClientSession DEBUG : applyTransactionRequest: Tentative d'envoi de la réponse TRANSACTION_RESULT au client...
[2025-05-02 17:57:28][DEBUG] ClientSession DEBUG : applyTransactionRequest: Réponse TRANSACTION_RESULT envoyée (ou appel send terminé sans exception).
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : applyTransactionRequest appelé pour client Client1, Transaction ID: T1746201448360127562_2, Statut: COMPLETED
[2025-05-02 17:57:28][DEBUG] TransactionQueue::processRequest DEBUG : Après notification ClientSession pour client Client1
[2025-05-02 17:57:28][INFO] TransactionQueue::processRequest INFO : --- Fin traitement requête ID: T1746201448360127562_2 pour client Client1 avec statut final: COMPLETED ---
[2025-05-02 17:57:34][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 17:57:34][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 17:57:34][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 17:57:34][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'BALANCE USD: 10007.0984127973, SRD-BTC: 0.0000000000
'
[2025-05-02 17:57:34][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 17:57:39][INFO] Global Nouveau prix SRD-BTC simulé : 97930.9621843814
[2025-05-02 17:57:54][INFO] Global Nouveau prix SRD-BTC simulé : 95305.6691581880
[2025-05-02 17:58:09][INFO] Global Nouveau prix SRD-BTC simulé : 97225.9399971494
[2025-05-02 17:58:25][INFO] Global Nouveau prix SRD-BTC simulé : 97558.2793791988
[2025-05-02 17:58:40][INFO] Global Nouveau prix SRD-BTC simulé : 95041.6229899739
[2025-05-02 17:58:43][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 17:58:43][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'QUIT'
[2025-05-02 17:58:43][INFO] ClientSession INFO : Commande QUIT reçue pour client Client1. Signalement de l'arrêt de la session.
[2025-05-02 17:58:43][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Disconnecting.
'
[2025-05-02 17:58:43][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'QUIT'
[2025-05-02 17:58:43][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=1
[2025-05-02 17:58:55][INFO] Global Nouveau prix SRD-BTC simulé : 99203.5257086337
[2025-05-02 17:59:10][INFO] Global Nouveau prix SRD-BTC simulé : 97724.7698829023
[2025-05-02 17:59:25][INFO] Global Nouveau prix SRD-BTC simulé : 99526.0464311569
[2025-05-02 17:59:40][INFO] Global Nouveau prix SRD-BTC simulé : 96726.6165931074
--- Début du log : 1746211165 ---
[2025-05-02 20:39:25][DEBUG] TransactionQueue créée.
[2025-05-02 20:39:25][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 20:39:25][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 20:39:25][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 20:39:25][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 20:39:25][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 20:39:25][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 20:39:25][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 20:39:25][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 20:39:25][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 20:39:25][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 20:39:25][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 20:39:25][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:39:25][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:39:25][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 20:39:25][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 20:39:25][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 20:39:25][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 20:39:25][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 20:39:25][INFO] Global Thread de génération de prix initié.
[2025-05-02 20:39:25][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 20:39:25][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 20:39:25][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 20:39:25][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 20:39:25][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 20:39:25][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 20:39:25][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 20:39:25][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 20:39:25][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 20:39:25][INFO] Global Thread de génération de prix démarré.
[2025-05-02 20:39:25][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 20:39:25][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 20:39:25][INFO] Global Nouveau prix SRD-BTC simulé : 97683.4810051240
[2025-05-02 20:39:30][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 5, IP: 10.188.240.101
[2025-05-02 20:39:30][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 5
[2025-05-02 20:39:30][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 5
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:39:30][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:39:30][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 20:39:30][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 20:39:30][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 20:39:30][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 5
[2025-05-02 20:39:30][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 5
[2025-05-02 20:39:30][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 5
[2025-05-02 20:39:30][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (5) et SSL existants.
[2025-05-02 20:39:30][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 5
[2025-05-02 20:39:30][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 20:39:30][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 20:39:30][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 5
[2025-05-02 20:39:30][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 5. Buffer accumulation size: 24
[2025-05-02 20:39:30][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 5. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:39:30][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 5 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:39:30][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 5
[2025-05-02 20:39:30][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 20:39:30][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 20:39:30][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 20:39:30][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 20:39:30][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 20:39:30][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 5
[2025-05-02 20:39:30][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 5
[2025-05-02 20:39:30][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 20:39:30][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 20:39:30][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 20:39:30][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 20:39:30][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 20:39:30][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 20:39:30][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=10007.0984127973, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 20:39:30][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 20:39:30][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 20:39:30][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 20:39:30][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 20:39:30][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 20:39:30][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 20:39:30][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 20:39:30][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 20:39:30][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 20:39:30][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 20:39:30][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 20:39:30][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:39:30][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:39:30][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 20:39:34][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 20:39:34][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 20:39:34][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 20:39:34][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'BALANCE USD: 10007.0984127973, SRD-BTC: 0.0000000000
'
[2025-05-02 20:39:34][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 20:39:40][INFO] Global Nouveau prix SRD-BTC simulé : 97696.6464862020
[2025-05-02 20:39:42][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 20:39:42][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 50'
[2025-05-02 20:39:42][DEBUG] ClientSession DEBUG : BUY (pourcentage) calculé (basé sur prix actuel 97696.646486): utiliser 5003.549206 USD (50.000000%) pour une quantité visée de 0.051215 SRD-BTC.
[2025-05-02 20:39:42][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0512151582. Taille de la queue: 1
[2025-05-02 20:39:42][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1 (manuel, pourcentage) : Client=Client1, Type=BUY, Qty Visée=0.051215 SRD-BTC (basé sur 50.000000% de solde USD)
[2025-05-02 20:39:42][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 50.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 20:39:42][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.051215
[2025-05-02 20:39:42][INFO] TransactionQueue::processRequest INFO : Début traitement requête ID client: Client1, Type: BUY, Quantité: 0.051215
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : ID (T1746211182001140705_1) et Timestamp générés pour requête client Client1
[2025-05-02 20:39:42][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 20:39:42][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 50'
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Prix SRD-BTC obtenu: 97696.646486 pour client Client1
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet obtenu pour client Client1
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Vérification validité prix 97696.646486
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Prix valide. Avant calculs et vérif fonds.
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Traitement BUY. Avant calculs montants.
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après calculs BUY. Avant vérif solde USD.
[2025-05-02 20:39:42][INFO] TransactionQueue::processRequest INFO : Client Client1: BUY validé sous verrou. Fonds USD suffisants.
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après vérifs fonds/calculs. Statut actuel: COMPLETED
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Statut COMPLETED. Avant mise à jour soldes.
[2025-05-02 20:39:42][DEBUG] Wallet DEBUG : Client Client1 balance USD mise à jour de -5004.049561. Nouveau solde: 5003.048851
[2025-05-02 20:39:42][DEBUG] Wallet DEBUG : Client Client1 balance SRD-BTC mise à jour de 0.051215. Nouveau solde: 0.051215
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Soldes mis à jour BUY.
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Avant sauvegarde Wallet.
[2025-05-02 20:39:42][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 20:39:42][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 20:39:42][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 20:39:42][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 20:39:42][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 20:39:42][DEBUG] Wallet Sauvegarde du portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 20:39:42][INFO] Wallet Portefeuille (Client1) sauvegardé : USD=5003.0488514780, SRD-BTC=0.0512151582.
[2025-05-02 20:39:42][INFO] TransactionQueue::processRequest INFO : Client Client1: Wallet sauvegardé après Tx COMPLETED.
[2025-05-02 20:39:42][DEBUG] Transaction créée/chargée : ID=T1746211182001140705_1, Client=Client1, Type=BUY, Statut=COMPLETED
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Transaction finale (via shared_ptr) construite SOUS VERROU pour client Client1
[2025-05-02 20:39:42][INFO] Wallet Portefeuille (Client1) : Transaction ajoutée à l'historique. ID: T1746211182001140705_1, Type: BUY, Statut: COMPLETED
[2025-05-02 20:39:42][INFO] TransactionQueue::processRequest INFO : Transaction T1746211182001140705_1 ajoutée à l'historique du Wallet sous verrou pour client Client1. Statut: COMPLETED
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet libéré pour client Client1
[2025-05-02 20:39:42][INFO] TransactionQueue::processRequest INFO : Transaction ID: T1746211182001140705_1 logguée globalement pour client Client1 avec statut: COMPLETED
[2025-05-02 20:39:42][INFO] ClientSession INFO : Notification de TQ reçue pour transaction client Client1, ID: T1746211182001140705_1, Statut: COMPLETED
[2025-05-02 20:39:42][DEBUG] ClientSession DEBUG : Bot non actif pour client Client1. Notification de Tx T1746211182001140705_1 non passée au bot.
[2025-05-02 20:39:42][DEBUG] ClientSession DEBUG : Message TRANSACTION_RESULT formaté pour Client1 Tx T1746211182001140705_1: 'TRANSACTION_RESULT ID=T1746211182001140705_1 STATUS=COMPLETED'
[2025-05-02 20:39:42][DEBUG] ClientSession DEBUG : applyTransactionRequest: Tentative d'envoi de la réponse TRANSACTION_RESULT au client Client1...
[2025-05-02 20:39:42][DEBUG] ClientSession DEBUG : applyTransactionRequest: Réponse TRANSACTION_RESULT envoyée (ou appel send terminé sans exception) à Client1.
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : applyTransactionRequest appelé pour client Client1, Transaction ID: T1746211182001140705_1, Statut: COMPLETED
[2025-05-02 20:39:42][DEBUG] TransactionQueue::processRequest DEBUG : Après notification ClientSession pour client Client1
[2025-05-02 20:39:42][INFO] TransactionQueue::processRequest INFO : --- Fin traitement requête ID: T1746211182001140705_1 pour client Client1 avec statut final: COMPLETED ---
[2025-05-02 20:39:48][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 20:39:48][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 20:39:48][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 20:39:48][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'BALANCE USD: 5003.0488514780, SRD-BTC: 0.0512151582
'
[2025-05-02 20:39:48][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 20:39:55][INFO] Global Nouveau prix SRD-BTC simulé : 96942.5658083718
[2025-05-02 20:39:56][DEBUG] ClientSession DEBUG : Reçu 17 octets. Buffer d'accumulation: 17 octets.
[2025-05-02 20:39:56][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SELL SRD-BTC 100'
[2025-05-02 20:39:56][DEBUG] ClientSession DEBUG : SELL (pourcentage) calculé : vendre 0.051215 SRD-BTC (basé sur 100.000000% de solde).
[2025-05-02 20:39:56][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: SELL, Quantité: 0.0512151582. Taille de la queue: 1
[2025-05-02 20:39:56][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1 (manuel, pourcentage) : Client=Client1, Type=SELL, Qty Visée=0.051215 SRD-BTC (basé sur 100.000000% de solde SRD-BTC)
[2025-05-02 20:39:56][INFO] ClientSession INFO : Requête de trading manuelle (SELL SRD-BTC 100.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 20:39:56][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: SELL, Quantité: 0.051215
[2025-05-02 20:39:56][INFO] TransactionQueue::processRequest INFO : Début traitement requête ID client: Client1, Type: SELL, Quantité: 0.051215
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : ID (T1746211196262802133_2) et Timestamp générés pour requête client Client1
[2025-05-02 20:39:56][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your SELL request has been submitted for processing.
'
[2025-05-02 20:39:56][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SELL SRD-BTC 100'
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Prix SRD-BTC obtenu: 96942.565808 pour client Client1
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet obtenu pour client Client1
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Vérification validité prix 96942.565808
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Prix valide. Avant calculs et vérif fonds.
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Traitement SELL. Avant calculs montants.
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après calculs SELL. Avant vérif solde SRD-BTC.
[2025-05-02 20:39:56][INFO] TransactionQueue::processRequest INFO : Client Client1: SELL validé sous verrou. Fonds SRD-BTC suffisants.
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après vérifs fonds/calculs. Statut actuel: COMPLETED
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Statut COMPLETED. Avant mise à jour soldes.
[2025-05-02 20:39:56][DEBUG] Wallet DEBUG : Client Client1 balance SRD-BTC mise à jour de -0.051215. Nouveau solde: 0.000000
[2025-05-02 20:39:56][DEBUG] Wallet DEBUG : Client Client1 balance USD mise à jour de 4964.432352. Nouveau solde: 9967.481204
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Soldes mis à jour SELL.
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Avant sauvegarde Wallet.
[2025-05-02 20:39:56][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 20:39:56][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 20:39:56][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 20:39:56][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 20:39:56][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 20:39:56][DEBUG] Wallet Sauvegarde du portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 20:39:56][INFO] Wallet Portefeuille (Client1) sauvegardé : USD=9967.4812037738, SRD-BTC=0.0000000000.
[2025-05-02 20:39:56][INFO] TransactionQueue::processRequest INFO : Client Client1: Wallet sauvegardé après Tx COMPLETED.
[2025-05-02 20:39:56][DEBUG] Transaction créée/chargée : ID=T1746211196262802133_2, Client=Client1, Type=SELL, Statut=COMPLETED
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Transaction finale (via shared_ptr) construite SOUS VERROU pour client Client1
[2025-05-02 20:39:56][INFO] Wallet Portefeuille (Client1) : Transaction ajoutée à l'historique. ID: T1746211196262802133_2, Type: SELL, Statut: COMPLETED
[2025-05-02 20:39:56][INFO] TransactionQueue::processRequest INFO : Transaction T1746211196262802133_2 ajoutée à l'historique du Wallet sous verrou pour client Client1. Statut: COMPLETED
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet libéré pour client Client1
[2025-05-02 20:39:56][INFO] TransactionQueue::processRequest INFO : Transaction ID: T1746211196262802133_2 logguée globalement pour client Client1 avec statut: COMPLETED
[2025-05-02 20:39:56][INFO] ClientSession INFO : Notification de TQ reçue pour transaction client Client1, ID: T1746211196262802133_2, Statut: COMPLETED
[2025-05-02 20:39:56][DEBUG] ClientSession DEBUG : Bot non actif pour client Client1. Notification de Tx T1746211196262802133_2 non passée au bot.
[2025-05-02 20:39:56][DEBUG] ClientSession DEBUG : Message TRANSACTION_RESULT formaté pour Client1 Tx T1746211196262802133_2: 'TRANSACTION_RESULT ID=T1746211196262802133_2 STATUS=COMPLETED'
[2025-05-02 20:39:56][DEBUG] ClientSession DEBUG : applyTransactionRequest: Tentative d'envoi de la réponse TRANSACTION_RESULT au client Client1...
[2025-05-02 20:39:56][DEBUG] ClientSession DEBUG : applyTransactionRequest: Réponse TRANSACTION_RESULT envoyée (ou appel send terminé sans exception) à Client1.
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : applyTransactionRequest appelé pour client Client1, Transaction ID: T1746211196262802133_2, Statut: COMPLETED
[2025-05-02 20:39:56][DEBUG] TransactionQueue::processRequest DEBUG : Après notification ClientSession pour client Client1
[2025-05-02 20:39:56][INFO] TransactionQueue::processRequest INFO : --- Fin traitement requête ID: T1746211196262802133_2 pour client Client1 avec statut final: COMPLETED ---
[2025-05-02 20:40:01][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 20:40:01][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 20:40:01][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 20:40:01][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'BALANCE USD: 9967.4812037738, SRD-BTC: 0.0000000000
'
[2025-05-02 20:40:01][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 20:40:07][DEBUG] ClientSession DEBUG : Reçu 10 octets. Buffer d'accumulation: 10 octets.
[2025-05-02 20:40:07][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'START BOT'
[2025-05-02 20:40:07][WARNING] ClientSession WARNING : Commande inconnue reçue pour client Client1 : 'START BOT'
[2025-05-02 20:40:07][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'ERROR: Unknown command 'START BOT'. Use SHOW WALLET, SHOW TRANSACTIONS, GET_PRICE <symbol>, BUY/SELL <Currency> <Percentage>, START BOT <period> <K>, STOP BOT, STOP SESSION, or QUIT.
'
[2025-05-02 20:40:07][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'START BOT'
[2025-05-02 20:40:10][INFO] Global Nouveau prix SRD-BTC simulé : 96429.6319442011
[2025-05-02 20:40:22][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 20:40:22][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:40:22][WARNING] ClientSession WARNING : Commande inconnue reçue pour client Client1 : 'START BOT 2'
[2025-05-02 20:40:22][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'ERROR: Unknown command 'START BOT 2'. Use SHOW WALLET, SHOW TRANSACTIONS, GET_PRICE <symbol>, BUY/SELL <Currency> <Percentage>, START BOT <period> <K>, STOP BOT, STOP SESSION, or QUIT.
'
[2025-05-02 20:40:22][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:40:25][INFO] Global Nouveau prix SRD-BTC simulé : 99588.1303870616
[2025-05-02 20:40:40][INFO] Global Nouveau prix SRD-BTC simulé : 97666.3697731936
[2025-05-02 20:40:55][INFO] Global Nouveau prix SRD-BTC simulé : 96407.1389591951
[2025-05-02 20:41:04][DEBUG] OpenSSL Callback: SSL3 alert write:fatal:decode error
[2025-05-02 20:41:04][WARNING] ServerConnection::receive WARNING : SSL_read retourné 0. Erreur code: 1. Socket FD: 5
[2025-05-02 20:41:04][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 5
[2025-05-02 20:41:04][INFO] ClientSession INFO : Déconnexion propre détectée pour client Client1. Socket FD: 5
[2025-05-02 20:41:04][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=0
--- Début du log : 1746211534 ---
[2025-05-02 20:45:34][DEBUG] TransactionQueue créée.
[2025-05-02 20:45:34][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 20:45:34][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 20:45:34][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 20:45:34][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 20:45:34][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 20:45:34][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 20:45:34][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 20:45:34][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 20:45:34][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 20:45:34][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 20:45:34][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 20:45:34][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:45:34][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:45:34][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 20:45:34][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 20:45:34][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 20:45:34][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 20:45:34][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 20:45:34][INFO] Global Thread de génération de prix initié.
[2025-05-02 20:45:34][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 20:45:34][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 20:45:34][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 20:45:34][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 20:45:34][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 20:45:34][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 20:45:34][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 20:45:34][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 20:45:34][INFO] Global Thread de génération de prix démarré.
[2025-05-02 20:45:34][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 20:45:34][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 20:45:34][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 20:45:34][INFO] Global Nouveau prix SRD-BTC simulé : 97410.0328498660
[2025-05-02 20:45:42][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 5, IP: 10.188.240.101
[2025-05-02 20:45:42][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 5
[2025-05-02 20:45:42][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 5
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:45:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:45:42][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 20:45:42][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 20:45:42][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 5
[2025-05-02 20:45:42][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 5
[2025-05-02 20:45:42][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 5
[2025-05-02 20:45:42][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 5
[2025-05-02 20:45:42][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (5) et SSL existants.
[2025-05-02 20:45:42][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 5
[2025-05-02 20:45:42][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 20:45:42][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 20:45:42][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 5
[2025-05-02 20:45:42][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 5. Buffer accumulation size: 24
[2025-05-02 20:45:42][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 5. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:45:42][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 5 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:45:42][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 5
[2025-05-02 20:45:42][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 20:45:42][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 20:45:42][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 20:45:42][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 20:45:42][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 20:45:42][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 5
[2025-05-02 20:45:42][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 5
[2025-05-02 20:45:42][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 20:45:42][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 20:45:42][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 20:45:42][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 20:45:42][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 20:45:42][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 20:45:42][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=9967.4812037738, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 20:45:42][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 20:45:42][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 20:45:42][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 20:45:42][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 20:45:42][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 20:45:42][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 20:45:42][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 20:45:42][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 20:45:42][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 20:45:42][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 20:45:42][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 20:45:42][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:45:42][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:45:42][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 20:45:49][INFO] Global Nouveau prix SRD-BTC simulé : 98892.7118295438
[2025-05-02 20:45:49][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 20:45:49][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:45:49][WARNING] ClientSession WARNING : Commande inconnue reçue pour client Client1 : 'START BOT 2'
[2025-05-02 20:45:49][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'ERROR: Unknown command 'START BOT 2'. Use SHOW WALLET, SHOW TRANSACTIONS, GET_PRICE <symbol>, BUY/SELL <Currency> <Percentage>, START BOT <period> <K>, STOP BOT, STOP SESSION, or QUIT.
'
[2025-05-02 20:45:49][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:46:04][INFO] Global Nouveau prix SRD-BTC simulé : 98198.6718108889
[2025-05-02 20:46:11][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 20:46:11][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'quit'
[2025-05-02 20:46:11][INFO] ClientSession INFO : Commande QUIT reçue pour client Client1. Signalement de l'arrêt de la session.
[2025-05-02 20:46:11][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Disconnecting.
'
[2025-05-02 20:46:11][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'quit'
[2025-05-02 20:46:11][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=1
[2025-05-02 20:46:19][INFO] Global Nouveau prix SRD-BTC simulé : 96015.6487061458
[2025-05-02 20:46:34][INFO] Global Nouveau prix SRD-BTC simulé : 99486.7006643318
[2025-05-02 20:46:49][INFO] Global Nouveau prix SRD-BTC simulé : 96817.5083409480
[2025-05-02 20:47:04][INFO] Global Nouveau prix SRD-BTC simulé : 97614.3076563914
[2025-05-02 20:47:19][INFO] Global Nouveau prix SRD-BTC simulé : 97869.9939700212
[2025-05-02 20:47:34][INFO] Global Nouveau prix SRD-BTC simulé : 95222.3215311752
[2025-05-02 20:47:49][INFO] Global Nouveau prix SRD-BTC simulé : 96863.8978800927
--- Début du log : 1746211709 ---
[2025-05-02 20:48:29][DEBUG] TransactionQueue créée.
[2025-05-02 20:48:29][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 20:48:29][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 20:48:29][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 20:48:29][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 20:48:29][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 20:48:29][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 20:48:29][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 20:48:29][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 20:48:29][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 20:48:29][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 20:48:29][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 20:48:29][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:48:29][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:48:29][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 20:48:29][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 20:48:29][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 20:48:29][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 20:48:29][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 20:48:29][INFO] Global Thread de génération de prix initié.
[2025-05-02 20:48:29][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 20:48:29][INFO] Global Thread de génération de prix démarré.
[2025-05-02 20:48:29][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 20:48:29][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 20:48:29][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 5
[2025-05-02 20:48:29][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 20:48:29][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 20:48:29][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 20:48:29][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 20:48:29][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 20:48:29][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 20:48:29][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 20:48:29][INFO] Global Nouveau prix SRD-BTC simulé : 97347.7576751384
[2025-05-02 20:48:33][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 10, IP: 10.188.240.101
[2025-05-02 20:48:33][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 10
[2025-05-02 20:48:33][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 10
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:48:33][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:48:33][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 20:48:33][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 20:48:33][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 10
[2025-05-02 20:48:33][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 10
[2025-05-02 20:48:33][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 10
[2025-05-02 20:48:33][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 10
[2025-05-02 20:48:33][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (10) et SSL existants.
[2025-05-02 20:48:33][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 10
[2025-05-02 20:48:33][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 20:48:33][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 20:48:33][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 10
[2025-05-02 20:48:33][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 10. Buffer accumulation size: 24
[2025-05-02 20:48:33][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 10. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:48:33][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 10 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:48:33][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 10
[2025-05-02 20:48:33][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 20:48:33][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 20:48:33][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 20:48:33][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 20:48:33][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 20:48:33][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 10
[2025-05-02 20:48:33][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 10
[2025-05-02 20:48:33][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 20:48:33][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 20:48:33][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 20:48:33][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 20:48:33][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 20:48:33][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 20:48:33][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=9967.4812037738, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 20:48:33][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 20:48:33][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 20:48:33][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 20:48:33][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 20:48:33][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 20:48:33][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 20:48:33][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 20:48:33][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 20:48:33][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 20:48:33][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 20:48:33][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 20:48:33][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:48:33][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:48:33][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 20:48:37][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 20:48:37][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:48:37][WARNING] ClientSession WARNING : Commande inconnue reçue pour client Client1 : 'START BOT 2'
[2025-05-02 20:48:37][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'ERROR: Unknown command 'START BOT 2'. Use SHOW WALLET, SHOW TRANSACTIONS, GET_PRICE <symbol>, BUY/SELL <Currency> <Percentage>, START BOT <period> <K>, STOP BOT, STOP SESSION, or QUIT.
'
[2025-05-02 20:48:37][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:48:44][INFO] Global Nouveau prix SRD-BTC simulé : 97024.3538557736
[2025-05-02 20:48:59][INFO] Global Nouveau prix SRD-BTC simulé : 99988.2036938927
[2025-05-02 20:49:04][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 20:49:04][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'QUIT'
[2025-05-02 20:49:04][INFO] ClientSession INFO : Commande QUIT reçue pour client Client1. Signalement de l'arrêt de la session.
[2025-05-02 20:49:04][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Disconnecting.
'
[2025-05-02 20:49:04][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'QUIT'
[2025-05-02 20:49:04][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=1
--- Début du log : 1746211839 ---
[2025-05-02 20:50:39][DEBUG] TransactionQueue créée.
[2025-05-02 20:50:39][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 20:50:39][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 20:50:39][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 20:50:39][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 20:50:39][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 20:50:39][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 20:50:39][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 20:50:39][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 20:50:39][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 20:50:39][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 20:50:39][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 20:50:39][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:50:39][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:50:39][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 20:50:39][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 20:50:39][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 20:50:39][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 20:50:39][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 20:50:39][INFO] Global Thread de génération de prix initié.
[2025-05-02 20:50:39][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 20:50:39][INFO] Global Thread de génération de prix démarré.
[2025-05-02 20:50:39][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 20:50:39][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 20:50:39][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 20:50:39][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 20:50:39][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 9
[2025-05-02 20:50:39][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 20:50:39][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 20:50:39][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 20:50:39][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 20:50:39][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 20:50:39][INFO] Global Nouveau prix SRD-BTC simulé : 97076.2003542946
[2025-05-02 20:50:42][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 11, IP: 10.188.240.101
[2025-05-02 20:50:42][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 11
[2025-05-02 20:50:42][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 11
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:50:42][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:50:42][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 20:50:42][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 20:50:42][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 20:50:42][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 11
[2025-05-02 20:50:42][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 11
[2025-05-02 20:50:42][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 11
[2025-05-02 20:50:42][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (11) et SSL existants.
[2025-05-02 20:50:42][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 11
[2025-05-02 20:50:42][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 20:50:42][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 20:50:42][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 11
[2025-05-02 20:50:42][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 11. Buffer accumulation size: 24
[2025-05-02 20:50:42][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 11. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:50:42][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 11 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:50:42][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 11
[2025-05-02 20:50:42][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 20:50:42][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 20:50:42][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 20:50:42][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 20:50:42][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 20:50:42][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 11
[2025-05-02 20:50:42][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 11
[2025-05-02 20:50:42][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 20:50:42][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 20:50:42][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 20:50:42][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 20:50:42][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 20:50:42][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 20:50:42][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=9967.4812037738, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 20:50:42][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 20:50:42][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 20:50:42][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 20:50:42][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 20:50:42][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 20:50:42][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 20:50:42][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 20:50:42][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 20:50:42][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 20:50:42][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 20:50:42][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 20:50:42][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:50:42][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:50:42][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 20:50:47][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 20:50:47][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:50:47][WARNING] ClientSession WARNING : Commande inconnue reçue pour client Client1 : 'START BOT 2'
[2025-05-02 20:50:47][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'ERROR: Unknown command 'START BOT 2'. Use SHOW WALLET, SHOW TRANSACTIONS, GET_PRICE <symbol>, BUY/SELL <Currency> <Percentage>, START BOT <period> <K>, STOP BOT, STOP SESSION, or QUIT.
'
[2025-05-02 20:50:47][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:50:52][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 20:50:52][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'QUIT'
[2025-05-02 20:50:52][INFO] ClientSession INFO : Commande QUIT reçue pour client Client1. Signalement de l'arrêt de la session.
[2025-05-02 20:50:52][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Disconnecting.
'
[2025-05-02 20:50:52][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'QUIT'
[2025-05-02 20:50:52][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=1
[2025-05-02 20:50:54][INFO] Global Nouveau prix SRD-BTC simulé : 97600.2975310767
--- Début du log : 1746211976 ---
[2025-05-02 20:52:56][DEBUG] TransactionQueue créée.
[2025-05-02 20:52:56][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 20:52:56][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 20:52:56][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 20:52:56][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 20:52:56][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 20:52:56][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 20:52:56][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 20:52:56][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 20:52:56][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 20:52:56][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 20:52:56][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 20:52:56][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:52:56][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:52:56][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 20:52:56][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 20:52:56][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 20:52:56][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 20:52:56][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 20:52:56][INFO] Global Thread de génération de prix initié.
[2025-05-02 20:52:56][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 20:52:56][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 20:52:56][INFO] Global Thread de génération de prix démarré.
[2025-05-02 20:52:56][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 20:52:56][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 20:52:56][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 9
[2025-05-02 20:52:56][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 20:52:56][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 20:52:56][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 20:52:56][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 20:52:56][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 20:52:56][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 20:52:56][INFO] Global Nouveau prix SRD-BTC simulé : 96482.9082159658
[2025-05-02 20:53:02][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 11, IP: 10.188.240.101
[2025-05-02 20:53:02][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 11
[2025-05-02 20:53:02][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 11
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:53:02][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:53:02][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 20:53:02][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 20:53:02][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 11
[2025-05-02 20:53:02][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 11
[2025-05-02 20:53:02][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 11
[2025-05-02 20:53:02][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 11
[2025-05-02 20:53:02][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (11) et SSL existants.
[2025-05-02 20:53:02][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 11
[2025-05-02 20:53:02][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 20:53:02][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 20:53:02][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 11
[2025-05-02 20:53:02][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 11. Buffer accumulation size: 24
[2025-05-02 20:53:02][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 11. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:53:02][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 11 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:53:02][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 11
[2025-05-02 20:53:02][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 20:53:02][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 20:53:02][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 20:53:02][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 20:53:02][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 20:53:02][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 11
[2025-05-02 20:53:02][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 11
[2025-05-02 20:53:02][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 20:53:02][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 20:53:02][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 20:53:02][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 20:53:02][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 20:53:02][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 20:53:02][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=9967.4812037738, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 20:53:02][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 20:53:02][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 20:53:02][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 20:53:02][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 20:53:02][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 20:53:02][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 20:53:02][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 20:53:02][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 20:53:02][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 20:53:02][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 20:53:02][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 20:53:02][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:53:02][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:53:02][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 20:53:11][INFO] Global Nouveau prix SRD-BTC simulé : 96467.6284080060
[2025-05-02 20:53:15][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 20:53:15][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'START_BOT 2'
[2025-05-02 20:53:15][WARNING] ClientSession WARNING : Commande inconnue reçue pour client Client1 : 'START_BOT 2'
[2025-05-02 20:53:15][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'ERROR: Unknown command 'START_BOT 2'. Use SHOW WALLET, SHOW TRANSACTIONS, GET_PRICE <symbol>, BUY/SELL <Currency> <Percentage>, START BOT <period> <K>, STOP BOT, STOP SESSION, or QUIT.
'
[2025-05-02 20:53:15][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'START_BOT 2'
[2025-05-02 20:53:22][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 20:53:22][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:53:22][WARNING] ClientSession WARNING : Commande inconnue reçue pour client Client1 : 'START BOT 2'
[2025-05-02 20:53:22][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'ERROR: Unknown command 'START BOT 2'. Use SHOW WALLET, SHOW TRANSACTIONS, GET_PRICE <symbol>, BUY/SELL <Currency> <Percentage>, START BOT <period> <K>, STOP BOT, STOP SESSION, or QUIT.
'
[2025-05-02 20:53:22][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:53:25][DEBUG] OpenSSL Callback: SSL3 alert write:fatal:decode error
[2025-05-02 20:53:25][WARNING] ServerConnection::receive WARNING : SSL_read retourné 0. Erreur code: 1. Socket FD: 11
[2025-05-02 20:53:25][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 11
[2025-05-02 20:53:25][INFO] ClientSession INFO : Déconnexion propre détectée pour client Client1. Socket FD: 11
[2025-05-02 20:53:25][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=0
[2025-05-02 20:53:26][INFO] Global Nouveau prix SRD-BTC simulé : 97574.9925838310
--- Début du log : 1746212155 ---
[2025-05-02 20:55:55][DEBUG] TransactionQueue créée.
[2025-05-02 20:55:55][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 20:55:55][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 20:55:55][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 20:55:55][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 20:55:55][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 20:55:55][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 20:55:55][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 20:55:55][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 20:55:55][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 20:55:55][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 20:55:55][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 20:55:55][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:55:55][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 20:55:55][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 20:55:55][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 20:55:55][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 20:55:55][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 20:55:55][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 20:55:55][INFO] Global Thread de génération de prix initié.
[2025-05-02 20:55:55][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 20:55:55][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 20:55:55][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 20:55:55][INFO] Global Thread de génération de prix démarré.
[2025-05-02 20:55:55][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 20:55:55][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 20:55:55][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 20:55:55][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 20:55:55][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 20:55:55][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 20:55:55][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 20:55:55][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 20:55:55][INFO] Global Nouveau prix SRD-BTC simulé : 97454.5458196855
[2025-05-02 20:55:59][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 8, IP: 10.188.240.101
[2025-05-02 20:55:59][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 8
[2025-05-02 20:55:59][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 8
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:55:59][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 20:55:59][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 20:55:59][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 8
[2025-05-02 20:55:59][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 8
[2025-05-02 20:55:59][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 8
[2025-05-02 20:55:59][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 8
[2025-05-02 20:55:59][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 8
[2025-05-02 20:55:59][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (8) et SSL existants.
[2025-05-02 20:55:59][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 8
[2025-05-02 20:55:59][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 20:55:59][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 20:55:59][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 8
[2025-05-02 20:55:59][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 8. Buffer accumulation size: 24
[2025-05-02 20:55:59][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 8. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:55:59][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 8 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 20:55:59][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 8
[2025-05-02 20:55:59][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 20:55:59][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 20:55:59][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 20:55:59][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 20:55:59][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 20:55:59][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 8
[2025-05-02 20:55:59][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 8
[2025-05-02 20:55:59][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 20:55:59][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 20:55:59][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 20:55:59][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 20:55:59][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 20:55:59][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 20:55:59][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=9967.4812037738, SRD-BTC=0.0000000000, Transactions=0
[2025-05-02 20:55:59][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 20:55:59][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 20:55:59][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 20:55:59][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 20:55:59][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 20:55:59][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 20:55:59][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 20:55:59][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 20:55:59][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 20:55:59][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 20:55:59][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 20:55:59][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:55:59][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 20:55:59][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 20:56:03][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 20:56:03][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:56:03][INFO] Bot créé pour client ID : Client1 avec période Bollinger = 20 et K = 2.000000. ClientSessionPtr reçu (pas encore validé).
[2025-05-02 20:56:03][INFO] Bot Client1 - Démarrage du thread du bot...
[2025-05-02 20:56:03][INFO] Bot Client1 - Thread du bot lancé.
[2025-05-02 20:56:03][INFO] ClientSession INFO : Bot créé et démarré pour client Client1 avec P=20, K=2.000000
[2025-05-02 20:56:03][INFO] Bot Client1 - Thread de logique de trading démarré.
[2025-05-02 20:56:03][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:03][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:03][INFO] Bot Client1 - Pas assez de données pour Bandes (1/20). HOLD.
[2025-05-02 20:56:03][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:03][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:56:03][INFO] Server INFO : Commande START BOT reçue et parsée avec K=2.000000 pour client Client1
[2025-05-02 20:56:03][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 20:56:08][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:08][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:08][INFO] Bot Client1 - Pas assez de données pour Bandes (2/20). HOLD.
[2025-05-02 20:56:08][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:08][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:56:10][INFO] Global Nouveau prix SRD-BTC simulé : 97208.4594456046
[2025-05-02 20:56:13][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:13][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:13][INFO] Bot Client1 - Pas assez de données pour Bandes (3/20). HOLD.
[2025-05-02 20:56:13][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:13][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:56:17][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 20:56:17][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 20:56:17][WARNING] ClientSession WARNING : Refus commande manuelle BUY de client Client1 : Bot actif.
[2025-05-02 20:56:17][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'ERROR: Manual trading (BUY) is disabled while the bot is active. Please stop the bot first.
'
[2025-05-02 20:56:17][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 20:56:17][DEBUG] ClientSession DEBUG : Appel de la logique du bot pour Client1
[2025-05-02 20:56:17][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:17][INFO] Bot Client1 - Pas assez de données pour Bandes (4/20). HOLD.
[2025-05-02 20:56:18][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:18][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:18][INFO] Bot Client1 - Pas assez de données pour Bandes (5/20). HOLD.
[2025-05-02 20:56:18][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:18][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:56:23][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:23][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:23][INFO] Bot Client1 - Pas assez de données pour Bandes (6/20). HOLD.
[2025-05-02 20:56:23][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:23][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:56:25][INFO] Global Nouveau prix SRD-BTC simulé : 97479.4351562464
[2025-05-02 20:56:28][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:28][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:28][INFO] Bot Client1 - Pas assez de données pour Bandes (7/20). HOLD.
[2025-05-02 20:56:28][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:28][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:56:33][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:33][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:33][INFO] Bot Client1 - Pas assez de données pour Bandes (8/20). HOLD.
[2025-05-02 20:56:33][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:33][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:56:38][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:38][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:38][INFO] Bot Client1 - Pas assez de données pour Bandes (9/20). HOLD.
[2025-05-02 20:56:38][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:38][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:56:40][INFO] Global Nouveau prix SRD-BTC simulé : 96501.1616935251
[2025-05-02 20:56:43][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:43][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:43][INFO] Bot Client1 - Pas assez de données pour Bandes (10/20). HOLD.
[2025-05-02 20:56:43][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:43][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:56:48][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:48][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:48][INFO] Bot Client1 - Pas assez de données pour Bandes (11/20). HOLD.
[2025-05-02 20:56:48][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:48][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:56:53][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:53][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:53][INFO] Bot Client1 - Pas assez de données pour Bandes (12/20). HOLD.
[2025-05-02 20:56:53][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:53][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:56:55][INFO] Global Nouveau prix SRD-BTC simulé : 97805.4378902891
[2025-05-02 20:56:58][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:56:58][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:56:58][INFO] Bot Client1 - Pas assez de données pour Bandes (13/20). HOLD.
[2025-05-02 20:56:58][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:56:58][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:03][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:03][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:03][INFO] Bot Client1 - Pas assez de données pour Bandes (14/20). HOLD.
[2025-05-02 20:57:03][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:03][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:09][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:09][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:09][INFO] Bot Client1 - Pas assez de données pour Bandes (15/20). HOLD.
[2025-05-02 20:57:09][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:09][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:10][INFO] Global Nouveau prix SRD-BTC simulé : 96513.3791678052
[2025-05-02 20:57:14][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:14][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:14][INFO] Bot Client1 - Pas assez de données pour Bandes (16/20). HOLD.
[2025-05-02 20:57:14][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:14][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:19][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:19][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:19][INFO] Bot Client1 - Pas assez de données pour Bandes (17/20). HOLD.
[2025-05-02 20:57:19][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:19][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:24][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:24][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:24][INFO] Bot Client1 - Pas assez de données pour Bandes (18/20). HOLD.
[2025-05-02 20:57:24][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:24][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:25][INFO] Global Nouveau prix SRD-BTC simulé : 97891.7374933163
[2025-05-02 20:57:29][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:29][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:29][INFO] Bot Client1 - Pas assez de données pour Bandes (19/20). HOLD.
[2025-05-02 20:57:29][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:29][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:34][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:34][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:34][INFO] Bot Client1 - Prix : 97891.7374933163, Bandes (M: 97221.2323066010, U: 98249.9446350972, L: 96192.5199781048)
[2025-05-02 20:57:34][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:57:34][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:34][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:39][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:39][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:39][INFO] Bot Client1 - Prix : 97891.7374933163, Bandes (M: 97243.0918902825, U: 98308.6274791813, L: 96177.5563013837)
[2025-05-02 20:57:39][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:57:39][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:39][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:40][INFO] Global Nouveau prix SRD-BTC simulé : 97403.6255954150
[2025-05-02 20:57:44][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:44][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:44][INFO] Bot Client1 - Prix : 97403.6255954150, Bandes (M: 97240.5458790690, U: 98304.2901264153, L: 96176.8016317227)
[2025-05-02 20:57:44][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:57:44][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:44][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:49][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:49][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:49][INFO] Bot Client1 - Prix : 97403.6255954150, Bandes (M: 97250.3041865595, U: 98316.2704226272, L: 96184.3379504919)
[2025-05-02 20:57:49][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:57:49][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:49][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:54][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:54][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:54][INFO] Bot Client1 - Prix : 97403.6255954150, Bandes (M: 97260.0624940501, U: 98327.8894522176, L: 96192.2355358825)
[2025-05-02 20:57:54][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:57:54][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:54][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:57:55][INFO] Global Nouveau prix SRD-BTC simulé : 96638.4311681378
[2025-05-02 20:57:59][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:57:59][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:57:59][INFO] Bot Client1 - Prix : 96638.4311681378, Bandes (M: 97231.5610801767, U: 98333.2677636309, L: 96129.8543967225)
[2025-05-02 20:57:59][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:57:59][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:57:59][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:58:04][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:58:04][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:58:04][INFO] Bot Client1 - Prix : 96638.4311681378, Bandes (M: 97203.0596663034, U: 98334.7673031971, L: 96071.3520294097)
[2025-05-02 20:58:04][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:58:04][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:58:04][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:58:09][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:58:09][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:58:09][INFO] Bot Client1 - Prix : 96638.4311681378, Bandes (M: 97161.0094668980, U: 98310.8675817205, L: 96011.1513520754)
[2025-05-02 20:58:09][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:58:09][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:58:09][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:58:10][INFO] Global Nouveau prix SRD-BTC simulé : 94451.7217422401
[2025-05-02 20:58:14][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:58:14][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:58:14][INFO] Bot Client1 - Prix : 94451.7217422401, Bandes (M: 97009.6237961976, U: 98646.1665576673, L: 95373.0810347280)
[2025-05-02 20:58:14][INFO] Bot Client1 - Signal BUY (Prix <= Bande Inf.) & Solde USD > 0 calculé. Décision BUY.
[2025-05-02 20:58:14][INFO] Bot Client1 - Action décidée: BUY
[2025-05-02 20:58:14][DEBUG] Bot Client1 - Boucle de trading : Action décidée : BUY. Tentative de soumission d'ordre.
[2025-05-02 20:58:14][DEBUG] ClientSession DEBUG : Bot Client1 - BUY : Solde USD=9967.481204, pour 10.000000%, montant base=996.748120 USD.
[2025-05-02 20:58:14][DEBUG] ClientSession DEBUG : Bot Client1 - BUY : Montant base USD 996.748120 converti en quantité crypto visée 0.010553 @ prix 94451.721742
[2025-05-02 20:58:14][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0105529905. Taille de la queue: 1
[2025-05-02 20:58:14][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par bot Client1 (auto): Client=Client1, Type=BUY, Qty Visée=0.010553 SRD-BTC
[2025-05-02 20:58:14][INFO] Bot Client1 - Boucle de trading : Ordre 'BUY' soumis avec succès via ClientSession.
[2025-05-02 20:58:14][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.010553
[2025-05-02 20:58:14][INFO] TransactionQueue::processRequest INFO : Début traitement requête ID client: Client1, Type: BUY, Quantité: 0.010553
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : ID (T1746212294147235219_1) et Timestamp générés pour requête client Client1
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Prix SRD-BTC obtenu: 94451.721742 pour client Client1
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet obtenu pour client Client1
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Vérification validité prix 94451.721742
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Prix valide. Avant calculs et vérif fonds.
[2025-05-02 20:58:14][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Traitement BUY. Avant calculs montants.
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après calculs BUY. Avant vérif solde USD.
[2025-05-02 20:58:14][INFO] TransactionQueue::processRequest INFO : Client Client1: BUY validé sous verrou. Fonds USD suffisants.
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après vérifs fonds/calculs. Statut actuel: COMPLETED
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Statut COMPLETED. Avant mise à jour soldes.
[2025-05-02 20:58:14][DEBUG] Wallet DEBUG : Client Client1 balance USD mise à jour de -996.847795. Nouveau solde: 8970.633409
[2025-05-02 20:58:14][DEBUG] Wallet DEBUG : Client Client1 balance SRD-BTC mise à jour de 0.010553. Nouveau solde: 0.010553
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Soldes mis à jour BUY.
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Avant sauvegarde Wallet.
[2025-05-02 20:58:14][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 20:58:14][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 20:58:14][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 20:58:14][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 20:58:14][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 20:58:14][DEBUG] Wallet Sauvegarde du portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 20:58:14][INFO] Wallet Portefeuille (Client1) sauvegardé : USD=8970.6334085844, SRD-BTC=0.0105529905.
[2025-05-02 20:58:14][INFO] TransactionQueue::processRequest INFO : Client Client1: Wallet sauvegardé après Tx COMPLETED.
[2025-05-02 20:58:14][DEBUG] Transaction créée/chargée : ID=T1746212294147235219_1, Client=Client1, Type=BUY, Statut=COMPLETED
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Transaction finale (via shared_ptr) construite SOUS VERROU pour client Client1
[2025-05-02 20:58:14][INFO] Wallet Portefeuille (Client1) : Transaction ajoutée à l'historique. ID: T1746212294147235219_1, Type: BUY, Statut: COMPLETED
[2025-05-02 20:58:14][INFO] TransactionQueue::processRequest INFO : Transaction T1746212294147235219_1 ajoutée à l'historique du Wallet sous verrou pour client Client1. Statut: COMPLETED
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet libéré pour client Client1
[2025-05-02 20:58:14][INFO] TransactionQueue::processRequest INFO : Transaction ID: T1746212294147235219_1 logguée globalement pour client Client1 avec statut: COMPLETED
[2025-05-02 20:58:14][INFO] ClientSession INFO : Notification de TQ reçue pour transaction client Client1, ID: T1746212294147235219_1, Statut: COMPLETED
[2025-05-02 20:58:14][INFO] Bot Client1 - Notification transaction (ID: T1746212294147235219_1, Type: BUY, Statut: COMPLETED, Client ID TX: Client1)
[2025-05-02 20:58:14][INFO] Bot Client1 - Position ouverte: LONG @ 94451.7217422401
[2025-05-02 20:58:14][INFO] Bot Client1 - Nouvel état après TX (ID: T1746212294147235219_1, Statut: COMPLETED): LONG @ 94451.721742
[2025-05-02 20:58:14][DEBUG] ClientSession DEBUG : Bot actif pour client Client1. Notification de Tx T1746212294147235219_1 passée au bot.
[2025-05-02 20:58:14][DEBUG] ClientSession DEBUG : Message TRANSACTION_RESULT formaté pour Client1 Tx T1746212294147235219_1: 'TRANSACTION_RESULT ID=T1746212294147235219_1 STATUS=COMPLETED'
[2025-05-02 20:58:14][DEBUG] ClientSession DEBUG : applyTransactionRequest: Tentative d'envoi de la réponse TRANSACTION_RESULT au client Client1...
[2025-05-02 20:58:14][DEBUG] ClientSession DEBUG : applyTransactionRequest: Réponse TRANSACTION_RESULT envoyée (ou appel send terminé sans exception) à Client1.
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : applyTransactionRequest appelé pour client Client1, Transaction ID: T1746212294147235219_1, Statut: COMPLETED
[2025-05-02 20:58:14][DEBUG] TransactionQueue::processRequest DEBUG : Après notification ClientSession pour client Client1
[2025-05-02 20:58:14][INFO] TransactionQueue::processRequest INFO : --- Fin traitement requête ID: T1746212294147235219_1 pour client Client1 avec statut final: COMPLETED ---
[2025-05-02 20:58:14][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 20:58:14][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'STOP'
[2025-05-02 20:58:14][WARNING] Server WARNING : Commande STOP inconnue de client Client1. Commande: 'STOP'
[2025-05-02 20:58:14][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'ERROR: Unknown STOP command target ''. Available: STOP BOT.
'
[2025-05-02 20:58:14][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'STOP'
[2025-05-02 20:58:14][DEBUG] ClientSession DEBUG : Appel de la logique du bot pour Client1
[2025-05-02 20:58:14][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:58:14][INFO] Bot Client1 - Prix : 94451.7217422401, Bandes (M: 96858.2381254973, U: 98820.6422035778, L: 94895.8340474168)
[2025-05-02 20:58:14][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:58:19][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:58:19][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:58:19][INFO] Bot Client1 - Prix : 94451.7217422401, Bandes (M: 96755.7661279330, U: 98978.7801246166, L: 94532.7521312495)
[2025-05-02 20:58:19][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:58:19][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:58:19][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:58:24][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:58:24][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:58:24][INFO] Bot Client1 - Prix : 94451.7217422401, Bandes (M: 96653.2941303688, U: 99092.2587900054, L: 94214.3294707322)
[2025-05-02 20:58:24][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:58:24][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:58:24][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 20:58:25][INFO] Global Nouveau prix SRD-BTC simulé : 98980.0758899386
[2025-05-02 20:58:27][DEBUG] OpenSSL Callback: SSL3 alert write:fatal:decode error
[2025-05-02 20:58:27][WARNING] ServerConnection::receive WARNING : SSL_read retourné 0. Erreur code: 1. Socket FD: 8
[2025-05-02 20:58:27][DEBUG] ServerConnection::markForClose DEBUG : Connexion marquée pour fermeture. Socket FD: 8
[2025-05-02 20:58:27][INFO] ClientSession INFO : Déconnexion propre détectée pour client Client1. Socket FD: 8
[2025-05-02 20:58:27][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=0
[2025-05-02 20:58:29][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 20:58:29][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 20:58:29][INFO] Bot Client1 - Prix : 98980.0758899386, Bandes (M: 96777.2398401894, U: 99416.4162781507, L: 94138.0634022282)
[2025-05-02 20:58:29][INFO] Bot Client1 - Action décidée: HOLD
[2025-05-02 20:58:29][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 20:58:29][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
--- Début du log : 1746212527 ---
[2025-05-02 21:02:07][DEBUG] TransactionQueue créée.
[2025-05-02 21:02:07][INFO] Main_Serv INFO : Démarrage du programme serveur (config hardcodée).
[2025-05-02 21:02:07][INFO] Main_Serv INFO : Configuration chargée (hardcodée). Port: 4433, Cert: ../server.crt, Key: ../server.key, Users: users.txt, Counter: counter.txt, History: ../src/data/global_transactions.csv, Wallets Dir: ../src/data/wallets/
[2025-05-02 21:02:07][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL...
[2025-05-02 21:02:07][DEBUG] Main_Serv DEBUG : Initialisation globale OpenSSL terminée.
[2025-05-02 21:02:07][INFO] Server::Server INFO : Objet Server créé avec port 4433 et chemins de configuration.
[2025-05-02 21:02:07][INFO] Main_Serv INFO : Objet Server créé. Démarrage...
[2025-05-02 21:02:07][INFO] Server::StartServer INFO : Démarrage du serveur sur le port 4433...
[2025-05-02 21:02:07][DEBUG] Server::InitServerCTX DEBUG : Initialisation du contexte SSL serveur...
[2025-05-02 21:02:07][DEBUG] Server::InitServerCTX DEBUG : Contexte SSL serveur créé.
[2025-05-02 21:02:07][DEBUG] Server::InitServerCTX DEBUG : Certificat serveur chargé : ../server.crt
[2025-05-02 21:02:07][DEBUG] Server::InitServerCTX DEBUG : Clé privée serveur chargée : ../server.key
[2025-05-02 21:02:07][INFO] Server::InitServerCTX INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 21:02:07][INFO] Server::StartServer INFO : Contexte SSL serveur initialisé avec succès.
[2025-05-02 21:02:07][INFO] Server::LoadUsersInternal INFO : Chargement utilisateurs terminé. 3 entrées chargées depuis users.txt
[2025-05-02 21:02:07][INFO] Server::StartServer INFO : Chargement des utilisateurs terminé (ou fichier non trouvé).
[2025-05-02 21:02:07][INFO] Transaction::loadCounter Fichier compteur vide ou contenant 0. Compteur démarrera à 0.
[2025-05-02 21:02:07][INFO] Server::StartServer INFO : Chargement du compteur de transactions terminé.
[2025-05-02 21:02:07][INFO] Global Demande de démarrage du thread de génération de prix.
[2025-05-02 21:02:07][INFO] Global Thread de génération de prix initié.
[2025-05-02 21:02:07][INFO] Server::StartServer INFO : Thread de génération des prix SRD-BTC démarré (module Global).
[2025-05-02 21:02:07][INFO] TransactionQueue::start Thread de traitement démarré.
[2025-05-02 21:02:07][INFO] Server::StartServer INFO : Thread de traitement de la TransactionQueue démarré.
[2025-05-02 21:02:07][INFO] Global Thread de génération de prix démarré.
[2025-05-02 21:02:07][DEBUG] Server::StartServer DEBUG : Socket serveur créé avec FD: 4
[2025-05-02 21:02:07][INFO] TransactionQueue::process Thread de traitement en cours...
[2025-05-02 21:02:07][INFO] Server::StartServer INFO : Socket serveur lié à l'adresse et au port 4433
[2025-05-02 21:02:07][INFO] Server::StartServer INFO : Serveur en écoute sur le port 4433
[2025-05-02 21:02:07][INFO] Global Fichier de log des prix '../src/data/srd_btc_values.csv' ouvert en mode append.
[2025-05-02 21:02:07][INFO] Server::StartServer INFO : Thread d'acceptation des connexions démarré.
[2025-05-02 21:02:07][DEBUG] Server::StartServer DEBUG : Attente de la fin du thread d'acceptation...
[2025-05-02 21:02:07][INFO] Server::AcceptLoop INFO : Thread démarré. En attente de connexions...
[2025-05-02 21:02:07][INFO] Global Nouveau prix SRD-BTC simulé : 96275.6421008372
[2025-05-02 21:02:10][INFO] Server::AcceptLoop INFO : Nouvelle connexion acceptée. Socket FD: 6, IP: 10.188.240.101
[2025-05-02 21:02:10][DEBUG] Server::AcceptSSLConnection DEBUG : Tentative handshake SSL pour socket FD: 6
[2025-05-02 21:02:10][DEBUG] Server::AcceptSSLConnection DEBUG : Objet SSL créé pour socket FD: 6
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: Handshake before SSL initialization START
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:before SSL initialization
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read client hello
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write server hello
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write change cipher spec
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write encrypted extensions
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write certificate
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:TLSv1.3 write server certificate verify
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write finished
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:TLSv1.3 early data
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS read finished
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: Handshake SSLv3/TLS write session ticket DONE
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 21:02:10][DEBUG] OpenSSL Callback: undefined:SSLv3/TLS write session ticket
[2025-05-02 21:02:10][ERROR] OpenSSL Callback: SSL_CB_ERROR - SSL negotiation finished successfully
[2025-05-02 21:02:10][INFO] Server::AcceptSSLConnection INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 21:02:10][INFO] Server::AcceptLoop INFO : Handshake SSL réussi pour socket FD: 6
[2025-05-02 21:02:10][INFO] Server::AcceptLoop INFO : Thread gestion client détaché pour socket FD: 6
[2025-05-02 21:02:10][INFO] Server::HandleClient INFO : Thread démarré pour socket FD: 6
[2025-05-02 21:02:10][DEBUG] Server::HandleClient DEBUG : Création de l'objet ServerConnection pour socket FD: 6
[2025-05-02 21:02:10][INFO] ServerConnection::ServerConnection INFO : Objet créé avec socket (6) et SSL existants.
[2025-05-02 21:02:10][INFO] Server::HandleClient INFO : Objet ServerConnection créé et connecté pour socket FD: 6
[2025-05-02 21:02:10][DEBUG] ClientAuthenticator::ClientAuthenticator DEBUG : Objet ClientAuthenticator créé.
[2025-05-02 21:02:10][DEBUG] Server::HandleClient DEBUG : Lancement du processus AuthenticateClient...
[2025-05-02 21:02:10][INFO] ClientAuthenticator::AuthenticateClient INFO : Démarrage authentification pour socket FD: 6
[2025-05-02 21:02:10][DEBUG] ServerConnection DEBUG : Reçu 24 octets pour receiveLine sur socket FD: 6. Buffer accumulation size: 24
[2025-05-02 21:02:10][DEBUG] ServerConnection DEBUG : Ligne complète lue pour socket FD: 6. Ligne: 'ID:Client1,TOKEN:Token1'
[2025-05-02 21:02:10][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Reçu message d'auth de socket FD 6 : 'ID:Client1,TOKEN:Token1'
[2025-05-02 21:02:10][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Parsing réussi. ID: 'Client1', Mot de passe: '[CACHÉ]'. Socket FD: 6
[2025-05-02 21:02:10][DEBUG] ClientAuthenticator::AuthenticateClient DEBUG : Demande au Server de traiter la requête d'auth pour ID: Client1...
[2025-05-02 21:02:10][INFO] Server::processAuthRequest INFO : Tentative auth/enregistrement pour ID: 'Client1'...
[2025-05-02 21:02:10][DEBUG] Server::processAuthRequest DEBUG : ID existant trouvé : 'Client1'. Vérification du mot de passe...
[2025-05-02 21:02:10][WARNING] SecurityUtils WARNING : VerifyPasswordSecure est un placeholder. REMPLACER PAR UNE VRAIE VÉRIFICATION DE HASH SÉCURISÉ !
[2025-05-02 21:02:10][INFO] Server::processAuthRequest INFO : Authentification réussie pour ID existant : 'Client1'.
[2025-05-02 21:02:10][INFO] ClientAuthenticator::AuthenticateClient INFO : Authentification terminée avec succès pour ID: 'Client1'. Résultat: SUCCESS. Socket FD: 6
[2025-05-02 21:02:10][INFO] Server::HandleClient INFO : Authentification/enregistrement réussi pour client ID: 'Client1' (SUCCESS). Socket FD: 6
[2025-05-02 21:02:10][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 21:02:10][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 21:02:10][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 21:02:10][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 21:02:10][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 21:02:10][DEBUG] Wallet Lecture du fichier portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 21:02:10][INFO] Wallet Portefeuille (Client1) chargé avec succès : USD=8970.6334085844, SRD-BTC=0.0105529905, Transactions=0
[2025-05-02 21:02:10][INFO] Wallet Portefeuille chargé avec succès pour client ID: Client1 depuis ../src/data/wallets/Client1.wallet
[2025-05-02 21:02:10][DEBUG] Wallet Objet Wallet créé pour client ID: Client1. Chemin du fichier: ../src/data/wallets/Client1.wallet
[2025-05-02 21:02:10][INFO] ClientSession INFO : Initialisation pour client Client1
[2025-05-02 21:02:10][INFO] Server::HandleClient INFO : Session enregistrée pour client ID: Client1. Total sessions actives: 1 (sous lock).
[2025-05-02 21:02:10][INFO] Server::HandleClient INFO : Authentification réussie pour client ID: 'Client1'. Envoi réponse AUTH SUCCESS.
[2025-05-02 21:02:10][DEBUG] Server::HandleClient DEBUG : Enregistrement de la session auprès de la TransactionQueue...
[2025-05-02 21:02:10][INFO] TransactionQueue::registerSession Session enregistrée pour client ID: Client1
[2025-05-02 21:02:10][INFO] Server::HandleClient INFO : ClientSession pour client ID: Client1 enregistrée auprès de la TransactionQueue.
[2025-05-02 21:02:10][DEBUG] Server::HandleClient DEBUG : Démarrage du thread ClientSession...
[2025-05-02 21:02:10][INFO] ClientSession INFO : Démarrage du thread de session pour client Client1
[2025-05-02 21:02:10][INFO] ClientSession INFO : Thread de session démarré et joignable pour client Client1
[2025-05-02 21:02:10][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 21:02:10][INFO] Server::HandleClient INFO : Thread ClientSession démarré pour client ID: Client1. Le thread HandleClient va se terminer normalement.
[2025-05-02 21:02:10][INFO] ClientSession INFO : Thread de session démarré pour client Client1
[2025-05-02 21:02:17][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 21:02:17][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 21:02:17][INFO] Bot créé pour client ID : Client1 avec période Bollinger = 20 et K = 2.000000. ClientSessionPtr reçu (pas encore validé).
[2025-05-02 21:02:17][INFO] Bot Client1 - Démarrage du thread du bot...
[2025-05-02 21:02:17][INFO] Bot Client1 - Thread du bot lancé.
[2025-05-02 21:02:17][INFO] ClientSession INFO : Bot créé et démarré pour client Client1 avec P=20, K=2.000000
[2025-05-02 21:02:17][INFO] Bot Client1 - Thread de logique de trading démarré.
[2025-05-02 21:02:17][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 21:02:17][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 21:02:17][INFO] Bot Client1 - Pas assez de données pour Bandes (1/20). HOLD.
[2025-05-02 21:02:17][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 21:02:17][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 21:02:17][INFO] Server INFO : Commande START BOT reçue et parsée avec K=2.000000 pour client Client1
[2025-05-02 21:02:17][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'START BOT 2'
[2025-05-02 21:02:22][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 21:02:22][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 21:02:22][INFO] Bot Client1 - Pas assez de données pour Bandes (2/20). HOLD.
[2025-05-02 21:02:22][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 21:02:22][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 21:02:22][INFO] Global Nouveau prix SRD-BTC simulé : 95421.2532574723
[2025-05-02 21:02:23][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 21:02:23][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 21:02:23][WARNING] ClientSession WARNING : Refus commande manuelle BUY de client Client1 : Bot actif.
[2025-05-02 21:02:23][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'ERROR: Manual trading (BUY) is disabled while the bot is active. Please stop the bot first.
'
[2025-05-02 21:02:23][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 21:02:27][DEBUG] Bot Client1 - Boucle de trading : Début itération.
[2025-05-02 21:02:27][INFO] Bot Client1 - Traitement du dernier prix...
[2025-05-02 21:02:27][INFO] Bot Client1 - Pas assez de données pour Bandes (3/20). HOLD.
[2025-05-02 21:02:27][DEBUG] Bot Client1 - Boucle de trading : Action HOLD ou non soumise (HOLD).
[2025-05-02 21:02:27][DEBUG] Bot Client1 - Boucle de trading : Fin itération. Avant pause.
[2025-05-02 21:02:29][DEBUG] ClientSession DEBUG : Reçu 9 octets. Buffer d'accumulation: 9 octets.
[2025-05-02 21:02:29][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'STOP BOT'
[2025-05-02 21:02:29][INFO] Bot Client1 - Signal d'arrêt envoyé au thread du bot.
[2025-05-02 21:02:29][INFO] Bot Client1 - Thread de logique de trading arrêté proprement.
[2025-05-02 21:02:29][INFO] Bot Client1 - Thread du bot arrêté proprement.
[2025-05-02 21:02:29][WARNING] Bot Client1 - Avertissement : Le thread du bot ne semble pas démarré (ou déjà terminé et joint). stop() n'a rien fait.
[2025-05-02 21:02:29][INFO] Bot détruit pour client ID : Client1
[2025-05-02 21:02:29][INFO] ClientSession INFO : Bot arrêté pour client Client1
[2025-05-02 21:02:29][INFO] Server INFO : Commande STOP BOT reçue et parsée pour client Client1
[2025-05-02 21:02:29][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'STOP BOT'
[2025-05-02 21:02:34][DEBUG] ClientSession DEBUG : Reçu 15 octets. Buffer d'accumulation: 15 octets.
[2025-05-02 21:02:34][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 21:02:34][DEBUG] ClientSession DEBUG : BUY (pourcentage) calculé (basé sur prix actuel 95421.253257): utiliser 897.063341 USD (10.000000%) pour une quantité visée de 0.009401 SRD-BTC.
[2025-05-02 21:02:34][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: BUY, Quantité: 0.0094010853. Taille de la queue: 1
[2025-05-02 21:02:34][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1 (manuel, pourcentage) : Client=Client1, Type=BUY, Qty Visée=0.009401 SRD-BTC (basé sur 10.000000% de solde USD)
[2025-05-02 21:02:34][INFO] ClientSession INFO : Requête de trading manuelle (BUY SRD-BTC 10.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 21:02:34][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your BUY request has been submitted for processing.
'
[2025-05-02 21:02:34][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: BUY, Quantité: 0.009401
[2025-05-02 21:02:34][INFO] TransactionQueue::processRequest INFO : Début traitement requête ID client: Client1, Type: BUY, Quantité: 0.009401
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : ID (T1746212554320900575_1) et Timestamp générés pour requête client Client1
[2025-05-02 21:02:34][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'BUY SRD-BTC 10'
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Prix SRD-BTC obtenu: 95421.253257 pour client Client1
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet obtenu pour client Client1
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Vérification validité prix 95421.253257
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Prix valide. Avant calculs et vérif fonds.
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Traitement BUY. Avant calculs montants.
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après calculs BUY. Avant vérif solde USD.
[2025-05-02 21:02:34][INFO] TransactionQueue::processRequest INFO : Client Client1: BUY validé sous verrou. Fonds USD suffisants.
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après vérifs fonds/calculs. Statut actuel: COMPLETED
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Statut COMPLETED. Avant mise à jour soldes.
[2025-05-02 21:02:34][DEBUG] Wallet DEBUG : Client Client1 balance USD mise à jour de -897.153047. Nouveau solde: 8073.480361
[2025-05-02 21:02:34][DEBUG] Wallet DEBUG : Client Client1 balance SRD-BTC mise à jour de 0.009401. Nouveau solde: 0.019954
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Soldes mis à jour BUY.
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Avant sauvegarde Wallet.
[2025-05-02 21:02:34][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 21:02:34][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 21:02:34][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 21:02:34][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 21:02:34][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 21:02:34][DEBUG] Wallet Sauvegarde du portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 21:02:34][INFO] Wallet Portefeuille (Client1) sauvegardé : USD=8073.4803613919, SRD-BTC=0.0199540758.
[2025-05-02 21:02:34][INFO] TransactionQueue::processRequest INFO : Client Client1: Wallet sauvegardé après Tx COMPLETED.
[2025-05-02 21:02:34][DEBUG] Transaction créée/chargée : ID=T1746212554320900575_1, Client=Client1, Type=BUY, Statut=COMPLETED
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Transaction finale (via shared_ptr) construite SOUS VERROU pour client Client1
[2025-05-02 21:02:34][INFO] Wallet Portefeuille (Client1) : Transaction ajoutée à l'historique. ID: T1746212554320900575_1, Type: BUY, Statut: COMPLETED
[2025-05-02 21:02:34][INFO] TransactionQueue::processRequest INFO : Transaction T1746212554320900575_1 ajoutée à l'historique du Wallet sous verrou pour client Client1. Statut: COMPLETED
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet libéré pour client Client1
[2025-05-02 21:02:34][INFO] TransactionQueue::processRequest INFO : Transaction ID: T1746212554320900575_1 logguée globalement pour client Client1 avec statut: COMPLETED
[2025-05-02 21:02:34][INFO] ClientSession INFO : Notification de TQ reçue pour transaction client Client1, ID: T1746212554320900575_1, Statut: COMPLETED
[2025-05-02 21:02:34][DEBUG] ClientSession DEBUG : Bot non actif pour client Client1. Notification de Tx T1746212554320900575_1 non passée au bot.
[2025-05-02 21:02:34][DEBUG] ClientSession DEBUG : Message TRANSACTION_RESULT formaté pour Client1 Tx T1746212554320900575_1: 'TRANSACTION_RESULT ID=T1746212554320900575_1 STATUS=COMPLETED'
[2025-05-02 21:02:34][DEBUG] ClientSession DEBUG : applyTransactionRequest: Tentative d'envoi de la réponse TRANSACTION_RESULT au client Client1...
[2025-05-02 21:02:34][DEBUG] ClientSession DEBUG : applyTransactionRequest: Réponse TRANSACTION_RESULT envoyée (ou appel send terminé sans exception) à Client1.
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : applyTransactionRequest appelé pour client Client1, Transaction ID: T1746212554320900575_1, Statut: COMPLETED
[2025-05-02 21:02:34][DEBUG] TransactionQueue::processRequest DEBUG : Après notification ClientSession pour client Client1
[2025-05-02 21:02:34][INFO] TransactionQueue::processRequest INFO : --- Fin traitement requête ID: T1746212554320900575_1 pour client Client1 avec statut final: COMPLETED ---
[2025-05-02 21:02:37][INFO] Global Nouveau prix SRD-BTC simulé : 97738.8512132246
[2025-05-02 21:02:48][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 21:02:48][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 21:02:48][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 21:02:48][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'BALANCE USD: 8073.4803613919, SRD-BTC: 0.0199540758
'
[2025-05-02 21:02:48][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 21:02:52][INFO] Global Nouveau prix SRD-BTC simulé : 95372.6340091637
[2025-05-02 21:03:03][DEBUG] ClientSession DEBUG : Reçu 17 octets. Buffer d'accumulation: 17 octets.
[2025-05-02 21:03:03][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SELL SRD-BTC 100'
[2025-05-02 21:03:03][DEBUG] ClientSession DEBUG : SELL (pourcentage) calculé : vendre 0.019954 SRD-BTC (basé sur 100.000000% de solde).
[2025-05-02 21:03:03][DEBUG] TransactionQueue::addRequest Requête ajoutée pour client ID: Client1, Type: SELL, Quantité: 0.0199540758. Taille de la queue: 1
[2025-05-02 21:03:03][INFO] ClientSession INFO : Requête de transaction soumise à la TQ par client Client1 (manuel, pourcentage) : Client=Client1, Type=SELL, Qty Visée=0.019954 SRD-BTC (basé sur 100.000000% de solde SRD-BTC)
[2025-05-02 21:03:03][INFO] TransactionQueue::process Traitement requête pour client ID: Client1, Type: SELL, Quantité: 0.019954
[2025-05-02 21:03:03][INFO] TransactionQueue::processRequest INFO : Début traitement requête ID client: Client1, Type: SELL, Quantité: 0.019954
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : ID (T1746212583538258355_2) et Timestamp générés pour requête client Client1
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Prix SRD-BTC obtenu: 95372.634009 pour client Client1
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet obtenu pour client Client1
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Vérification validité prix 95372.634009
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Prix valide. Avant calculs et vérif fonds.
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Traitement SELL. Avant calculs montants.
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après calculs SELL. Avant vérif solde SRD-BTC.
[2025-05-02 21:03:03][INFO] TransactionQueue::processRequest INFO : Client Client1: SELL validé sous verrou. Fonds SRD-BTC suffisants.
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Après vérifs fonds/calculs. Statut actuel: COMPLETED
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Statut COMPLETED. Avant mise à jour soldes.
[2025-05-02 21:03:03][INFO] ClientSession INFO : Requête de trading manuelle (SELL SRD-BTC 100.000000%) reçue pour client Client1. Soumission à la TQ via handleClientTradeRequest.
[2025-05-02 21:03:03][DEBUG] Wallet DEBUG : Client Client1 balance SRD-BTC mise à jour de -0.019954. Nouveau solde: 0.000000
[2025-05-02 21:03:03][DEBUG] Wallet DEBUG : Client Client1 balance USD mise à jour de 1902.882461. Nouveau solde: 9976.362822
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Soldes mis à jour SELL.
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Sous verrou Wallet: Avant sauvegarde Wallet.
[2025-05-02 21:03:03][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Chemin répertoire à vérifier/créer : ../src/data/wallets
[2025-05-02 21:03:03][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: create_directories retour : 0, ec.value : 0, ec.message : 'Success', errno : 0, strerror(errno) : 'Success'
[2025-05-02 21:03:03][WARNING] Wallet::ensureWalletsDirectoryExists WARNING: create_directories retourné false MAIS ec vide. Comportement inhabituel. Chemin: '../src/data/wallets'.
[2025-05-02 21:03:03][DEBUG] Wallet::ensureWalletsDirectoryExists DEBUG: Vérification manuelle après échec create_directories: exists() retour 1, ec_check.message : 'Success'
[2025-05-02 21:03:03][INFO] Wallet::ensureWalletsDirectoryExists INFO: Répertoire '../src/data/wallets' existe bien malgré l'échec bizarre de create_directories. Considéré comme succès pour la suite.
[2025-05-02 21:03:03][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Your SELL request has been submitted for processing.
'
[2025-05-02 21:03:03][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SELL SRD-BTC 100'
[2025-05-02 21:03:03][DEBUG] Wallet Sauvegarde du portefeuille : ../src/data/wallets/Client1.wallet
[2025-05-02 21:03:03][INFO] Wallet Portefeuille (Client1) sauvegardé : USD=9976.3628219319, SRD-BTC=0.0000000000.
[2025-05-02 21:03:03][INFO] TransactionQueue::processRequest INFO : Client Client1: Wallet sauvegardé après Tx COMPLETED.
[2025-05-02 21:03:03][DEBUG] Transaction créée/chargée : ID=T1746212583538258355_2, Client=Client1, Type=SELL, Statut=COMPLETED
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Transaction finale (via shared_ptr) construite SOUS VERROU pour client Client1
[2025-05-02 21:03:03][INFO] Wallet Portefeuille (Client1) : Transaction ajoutée à l'historique. ID: T1746212583538258355_2, Type: SELL, Statut: COMPLETED
[2025-05-02 21:03:03][INFO] TransactionQueue::processRequest INFO : Transaction T1746212583538258355_2 ajoutée à l'historique du Wallet sous verrou pour client Client1. Statut: COMPLETED
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Verrou Wallet libéré pour client Client1
[2025-05-02 21:03:03][INFO] TransactionQueue::processRequest INFO : Transaction ID: T1746212583538258355_2 logguée globalement pour client Client1 avec statut: COMPLETED
[2025-05-02 21:03:03][INFO] ClientSession INFO : Notification de TQ reçue pour transaction client Client1, ID: T1746212583538258355_2, Statut: COMPLETED
[2025-05-02 21:03:03][DEBUG] ClientSession DEBUG : Bot non actif pour client Client1. Notification de Tx T1746212583538258355_2 non passée au bot.
[2025-05-02 21:03:03][DEBUG] ClientSession DEBUG : Message TRANSACTION_RESULT formaté pour Client1 Tx T1746212583538258355_2: 'TRANSACTION_RESULT ID=T1746212583538258355_2 STATUS=COMPLETED'
[2025-05-02 21:03:03][DEBUG] ClientSession DEBUG : applyTransactionRequest: Tentative d'envoi de la réponse TRANSACTION_RESULT au client Client1...
[2025-05-02 21:03:03][DEBUG] ClientSession DEBUG : applyTransactionRequest: Réponse TRANSACTION_RESULT envoyée (ou appel send terminé sans exception) à Client1.
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : applyTransactionRequest appelé pour client Client1, Transaction ID: T1746212583538258355_2, Statut: COMPLETED
[2025-05-02 21:03:03][DEBUG] TransactionQueue::processRequest DEBUG : Après notification ClientSession pour client Client1
[2025-05-02 21:03:03][INFO] TransactionQueue::processRequest INFO : --- Fin traitement requête ID: T1746212583538258355_2 pour client Client1 avec statut final: COMPLETED ---
[2025-05-02 21:03:07][INFO] Global Nouveau prix SRD-BTC simulé : 96980.6222587106
[2025-05-02 21:03:07][DEBUG] ClientSession DEBUG : Reçu 12 octets. Buffer d'accumulation: 12 octets.
[2025-05-02 21:03:07][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 21:03:07][INFO] ClientSession INFO : Commande SHOW WALLET reçue pour client Client1
[2025-05-02 21:03:07][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'BALANCE USD: 9976.3628219319, SRD-BTC: 0.0000000000
'
[2025-05-02 21:03:07][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'SHOW WALLET'
[2025-05-02 21:03:10][DEBUG] ClientSession DEBUG : Reçu 5 octets. Buffer d'accumulation: 5 octets.
[2025-05-02 21:03:10][INFO] ClientSession INFO : Début traitement commande pour client Client1 : 'QUIT'
[2025-05-02 21:03:10][INFO] ClientSession INFO : Commande QUIT reçue pour client Client1. Signalement de l'arrêt de la session.
[2025-05-02 21:03:10][DEBUG] ClientSession DEBUG : Réponse envoyée à Client1: 'OK: Disconnecting.
'
[2025-05-02 21:03:10][INFO] ClientSession INFO : Fin traitement commande pour client Client1 : 'QUIT'
[2025-05-02 21:03:10][INFO] ClientSession INFO : Sortie de la boucle de session pour client Client1. Raison: running=0, client_connected=1
